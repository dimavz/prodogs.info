!function(){var o,t,e,s,n,p,i,a,u,c,r,m,l,d,j,f,v,b,h,g,w,k,y,x,C,M,T,S,L,O,I,U,E,A,R,N,H,P,$,Y,Q,F,B,D,q,z,G,V,W,K,J,X,Z,oo,to,eo,so,no,po,io,ao,uo,co,ro,mo,lo,jo,fo,vo,bo,ho,_o,go,wo,ko,yo,xo,Co,Mo,To,So,Lo,Oo,Io,Uo,Eo,Ao,Ro,No,Ho,Po,$o,Yo,Qo,Fo,Bo,Do,qo,zo,Go,Vo,Wo,Ko,Jo,Xo,Zo,ot,tt,et,st,nt,pt,it,at,ut,ct,rt,mt,lt,dt,jt,ft,vt,bt,ht,_t,gt,wt,kt,yt,xt,Ct,Mt,Tt,St,Lt,Ot,It,Ut,Et,At,Rt,Nt,Ht,Pt,$t,Yt,Qt,Ft,Bt,Dt,qt,zt,Gt,Vt,Wt,Kt,Jt,Xt,Zt,oe,te,ee,se,ne,pe,ie,ae,ue,ce,re,me,le,de,je,fe,ve,be,he,_e,ge,we,ke,ye,xe,Ce,Me,Te,Se,Le,Oe,Ie,Ue,Ee,Ae,Re,Ne,He,Pe,$e,Ye,Qe,Fe,Be,De,qe,ze,Ge,Ve,We,Ke,Je;!function(s){var n,p,i,a,u={},c={},r={},m={},l=Object.prototype.hasOwnProperty,d=[].slice,j=/\.js$/;function f(o,t){return l.call(o,t)}function v(o,t){var e,s,n,p,i,a,u,c,m,l,d,f=t&&t.split("/"),v=r.map,b=v&&v["*"]||{};if(o&&"."===o.charAt(0))if(t){for(f=f.slice(0,f.length-1),i=(o=o.split("/")).length-1,r.nodeIdCompat&&j.test(o[i])&&(o[i]=o[i].replace(j,"")),o=f.concat(o),m=0;m<o.length;m+=1)if("."===(d=o[m]))o.splice(m,1),m-=1;else if(".."===d){if(1===m&&(".."===o[2]||".."===o[0]))break;m>0&&(o.splice(m-1,2),m-=2)}o=o.join("/")}else 0===o.indexOf("./")&&(o=o.substring(2));if((f||b)&&v){for(m=(e=o.split("/")).length;m>0;m-=1){if(s=e.slice(0,m).join("/"),f)for(l=f.length;l>0;l-=1)if((n=v[f.slice(0,l).join("/")])&&(n=n[s])){p=n,a=m;break}if(p)break;!u&&b&&b[s]&&(u=b[s],c=m)}!p&&u&&(p=u,a=c),p&&(e.splice(0,a,p),o=e.join("/"))}return o}function b(o,t){return function(){return p.apply(s,d.call(arguments,0).concat([o,t]))}}function h(o){return function(t){u[o]=t}}function _(o){if(f(c,o)){var t=c[o];delete c[o],m[o]=!0,n.apply(s,t)}if(!f(u,o)&&!f(m,o))throw new Error("No "+o);return u[o]}function g(o){var t,e=o?o.indexOf("!"):-1;return e>-1&&(t=o.substring(0,e),o=o.substring(e+1,o.length)),[t,o]}i=function(o,t){var e,s,n=g(o),p=n[0];return o=n[1],p&&(e=_(p=v(p,t))),p?o=e&&e.normalize?e.normalize(o,(s=t,function(o){return v(o,s)})):v(o,t):(p=(n=g(o=v(o,t)))[0],o=n[1],p&&(e=_(p))),{f:p?p+"!"+o:o,n:o,pr:p,p:e}},a={require:function(o){return b(o)},exports:function(o){var t=u[o];return void 0!==t?t:u[o]={}},module:function(o){return{id:o,uri:"",exports:u[o],config:(t=o,function(){return r&&r.config&&r.config[t]||{}})};var t}},n=function(o,t,e,n){var p,r,l,d,j,v,g=[],w=typeof e;if(n=n||o,"undefined"===w||"function"===w){for(t=!t.length&&e.length?["require","exports","module"]:t,j=0;j<t.length;j+=1)if("require"===(r=(d=i(t[j],n)).f))g[j]=a.require(o);else if("exports"===r)g[j]=a.exports(o),v=!0;else if("module"===r)p=g[j]=a.module(o);else if(f(u,r)||f(c,r)||f(m,r))g[j]=_(r);else{if(!d.p)throw new Error(o+" missing "+r);d.p.load(d.n,b(n,!0),h(r),{}),g[j]=u[r]}l=e?e.apply(u[o],g):void 0,o&&(p&&p.exports!==s&&p.exports!==u[o]?u[o]=p.exports:l===s&&v||(u[o]=l))}else o&&(u[o]=e)},o=t=p=function(o,t,e,u,c){if("string"==typeof o)return a[o]?a[o](t):_(i(o,t).f);if(!o.splice){if((r=o).deps&&p(r.deps,r.callback),!t)return;t.splice?(o=t,t=e,e=null):o=s}return t=t||function(){},"function"==typeof e&&(e=u,u=c),u?n(s,o,t,e):setTimeout(function(){n(s,o,t,e)},4),p},p.config=function(o){return p(o)},o._defined=u,(e=function(o,t,e){t.splice||(e=t,t=[]),f(u,o)||f(c,o)||(c[o]=[o,t,e])}).amd={jQuery:!0}}(),e("../../vendors/almond",function(){}),function(o){joms.BASE_URL=o.joms_base_url,delete o.joms_base_url;var t=/https?:\/\/[^/]+/,s=joms.BASE_URL.match(t),n=location.href.match(t);s&&n&&s[0]!==n[0]&&joms.BASE_URL.replace(t,n[0]),joms.ASSETS_URL=o.joms_assets_url,delete o.joms_assets_url,joms.mobile=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent),joms.ios=/iphone|ipad|ipod/i.test(navigator.userAgent),joms.screenSize=function(){var o=window.innerWidth;return o<=480?"small":o<=991?"medium":"large"},joms.ajax=function(t){var e,s=o.jax_live_site||"",n=o.jax_token_var||"_no_token_found_",p={};if(t||(t={}),p[n]=1,p.task="azrul_ajax",p.option=t.option||"community",p.func=t.func,p.no_html=1,delete t.option,delete t.func,t.data&&t.data.length)for(var i,a=0;a<t.data.length;a++)"string"==typeof(i=t.data[a])&&(i=i.replace(/"/g,"&quot;")),joms._.isArray(i)||(i=["_d_",encodeURIComponent(i)]),p["arg"+(a+2)]=JSON.stringify(i);return t.url=s,t.type="post",t.dataType="json",t.data=p,t.success=function(o){o&&(e=o)},t.complete=function(){if(e||(e={error:"Undefined error."}),e.noLogin)return joms.api&&joms.api.login(e),void joms.view.misc.fixSVG();var o;if(joms._onAjaxReponseQueue&&joms._onAjaxReponseQueue[p.func]&&joms._onAjaxReponseQueue[p.func].length)for(var s=0;s<joms._onAjaxReponseQueue[p.func].length;s++)"function"==typeof joms._onAjaxReponseQueue[p.func][s]&&!1===joms._onAjaxReponseQueue[p.func][s](e)&&(o=!0);"function"!=typeof t.callback||o||t.callback(e),joms.view.misc.fixSVG()},joms.jQuery.ajax(t)},joms.____=function(){for(var o=joms.jQuery("#community-wrap");o.length&&"body"!==o[0].tagName.toLowerCase();)o.siblings().hide(),(o=o.parent()).css({border:"0 none",padding:0,marginTop:0,marginBottom:0,width:"auto"})},joms._printSVGIcons=function(){for(var o=["home","newspaper","pencil","image","images","camera","play","film","camera2","bullhorn","library","profile","support","envelope","location","clock","bell","calendar","box-add","box-remove","bubble","bubbles","user","users","spinner","search","key","lock","wrench","cog","gift","remove","briefcase","switch","signup","list","menu","earth","link","eye","star","star2","star3","thumbs-up","happy","smiley","tongue","sad","wink","grin","cool","angry","evil","shocked","confused","neutral","wondering","warning","info","blocked","spam","close","checkmark","plus","arrow-right","arrow-left","tab","filter","console","share","facebook","libreoffice","file-zip","arrow-down","redo","tag","search-user"],t=joms.jQuery("<div>"),e=0;e<o.length;e++)t.append('<svg viewBox="0 0 30 30" class="joms-icon" style="width:30px;height:30px"><use xlink:href="#joms-icon-'+o[e]+'"></use></svg>');t.appendTo(document.body)},"function"==typeof e&&e("core",[],function(){return o.joms})}(this),window,s=joms.jQuery,n=!joms.mobile,joms.util||(joms.util={}),joms.util.crop=function(o,t,e){var s,n,p,i,a;function u(o){return u.attach(o)}function c(){var o=n[0],t=n.children("img"),e=s.position();i={imageWidth:t.width(),imageHeight:t.height(),wrapperTop:o.scrollTop,wrapperLeft:o.scrollLeft,wrapperWidth:n.width(),wrapperHeight:n.height(),cropperTop:e.top+o.scrollTop,cropperLeft:e.left+o.scrollLeft,cropperWidth:s.outerWidth(),cropperHeight:s.outerHeight()}}function r(o){var t,n,p,u,r,m,l,d;c(),r=e?15:20,n=(t=o).center.pageX,p=t.center.pageY,u=s.offset(),m={top:p-u.top,left:n-u.left},l=i,d="",m.top<r?d+="n":m.top>l.cropperHeight-r&&(d+="s"),m.left<r?d+="w":m.left>l.cropperWidth-r&&(d+="e"),a=d}u.init=function(){n||(n=t('<div class="joms-cropper__wrapper" />')),s||(s=t('<div class="joms-cropper__box" />'))},u.attach=function(o){return u.init(),u.detach(),s.css({top:"",left:"",right:"",bottom:"",width:"",height:"",webkitTransform:"",mozTransform:"",transform:""}),t(o).wrap(n),n=t(o).parent(),s.insertAfter(o),p||(p=new joms.Hammer(s[0])).on("touch drag release",function(o){var t,n;o.stopPropagation(),o.preventDefault(),o.gesture.stopPropagation(),o.gesture.preventDefault(),"touch"===o.type?(e&&s.off("mousemove.joms-cropper"),r(o.gesture)):"release"!==o.type?m(o.gesture):(o.gesture,t=s.position(),n=i,s.css({top:Math.max(t.top+n.wrapperTop,0),left:Math.max(t.left+n.wrapperLeft,0),right:"",bottom:"",webkitTransform:"",mozTransform:"",transform:""}),c(),l())}),l(),o},u.detach=function(){u.init(),s.detach(),n.children().unwrap(),n.detach()},u.getSelection=function(){var o=i;return{x:o.cropperLeft,y:o.cropperTop,width:o.cropperWidth,height:o.cropperHeight}};var m=joms._.throttle(function(o){var t,e,n,p,u,c,r,m,l;a?(c=o,m=i,l={},(r=a).match(/n/)?(l.top="auto",l.bottom=m.wrapperHeight-m.cropperTop-m.cropperHeight,l.height=m.cropperHeight-c.deltaY):r.match(/s/)&&(l.bottom="auto",l.top=m.cropperTop,l.height=m.cropperHeight+c.deltaY),r.match(/e/)?(l.right="auto",l.left=m.cropperLeft,l.width=m.cropperWidth+c.deltaX):r.match(/w/)&&(l.left="auto",l.right=m.wrapperWidth-m.cropperLeft-m.cropperWidth,l.width=m.cropperWidth-c.deltaX),l.width=l.height=Math.max(l.width||0,l.height||0,64),r.match(/n/)?l.height=Math.min(l.height,m.wrapperHeight-l.bottom):r.match(/s/)?l.height=Math.min(l.height,m.imageHeight-l.top):"auto"!==s[0].style.top?l.height=Math.min(l.height,m.imageHeight-parseInt(s.css("top"))):l.height=Math.min(l.height,m.wrapperHeight-parseInt(s.css("bottom"))),r.match(/e/)?l.width=Math.min(l.width,m.imageWidth-l.left):r.match(/w/)?l.width=Math.min(l.width,m.wrapperWidth-l.right):"auto"!==s[0].style.left?l.width=Math.min(l.width,m.imageWidth-parseInt(s.css("left"))):l.width=Math.min(l.width,m.wrapperWidth-parseInt(s.css("right"))),l.width=l.height=Math.min(l.width,l.height),s.css(l)):(n=i,p=(t=o).deltaY,u=t.deltaX,u=Math.min(u,n.imageWidth-n.cropperWidth-n.cropperLeft),u=Math.max(u,0-n.cropperLeft),p=Math.min(p,n.imageHeight-n.cropperHeight-n.cropperTop),p=Math.max(p,0-n.cropperTop),e="translate3d("+u+"px, "+p+"px, 0)",s.css({webkitTransform:e,mozTransform:e,transform:e}))},e?10:100);function l(){e&&s.on("mousemove.joms-cropper",d)}function d(o){var e,n=t(o.target).parent().offset(),p=o.pageX-n.left,a=o.pageY-n.top,u="";c(),a<(e=i).cropperTop-e.wrapperTop+15?u+="n":a>e.cropperTop-e.wrapperTop+e.cropperHeight-15&&(u+="s"),p<e.cropperLeft-e.wrapperLeft+15?u+="w":p>e.cropperLeft-e.wrapperLeft+e.cropperWidth-15&&(u+="e"),s.css({cursor:u?u+"-resize":""})}return u}(0,s,n),e("utils/crop",function(){}),e("utils/map",["core"],function(){var o,t=window.joms_gmap_key,e=jQuery;function s(){o||(o=this)}s.prototype={search:function(o){var t=this;return e.Deferred(function(e){t.autocompleteService().then(function(s){s.getPlacePredictions({input:o},function(o,s){"OK"===s?e.resolve(t.mapResult(o)):e.reject(s)})})})},mapResult:function(o){var t=[];return _.isArray(o)&&_.each(o,function(o){var e=o.place_id,s=o.description.split(/,\s(.+)?/),n=s[0],p=s[1]||"";t.push({id:e,name:n,description:p})}),t},render:function(o,t){var s,n,p=e(o).show(),i=p.data("joms-map"),a=p.data("joms-map-marker"),u=t.formatted_address||"";t.geometry?(s=t.geometry.location,n=t.geometry.viewport):s=new google.maps.LatLng(t.latitude,t.longitude),i||p.data("joms-map",i=new google.maps.Map(o,{center:s,zoom:15,draggable:!1,scrollwheel:!1,disableDefaultUI:!0})),a||p.data("joms-map-marker",a=new google.maps.Marker({map:i,position:s,title:u})),i.setCenter(s),a.setPosition(s),n?i.fitBounds(n):i.setZoom(15)},loadAPI:function(){var o=this;return e.Deferred(function(e){var s,n;window.google&&window.google.maps&&window.google.maps.places?e.resolve():o.loaded?e.resolve():(o.queue=o.queue||[],o.queue.push(e),o.loading||(o.loading=!0,n=_.uniqueId("jomsCallback"),(s=document.createElement("script")).type="text/javascript",s.src="https://maps.googleapis.com/maps/api/js?libraries=places"+(t?"&key="+t:"")+"&callback="+n,window[n]=function(){for(o.loaded=!0,o.loading=!1;o.queue.length;)o.queue.shift().resolve();delete window[n]},document.body.appendChild(s)))})},autocompleteService:function(){var o=this;return e.Deferred(function(t){o.loadAPI().then(function(){var e="_cacheAutocompleteService";o[e]=o[e]||new google.maps.places.AutocompleteService,t.resolve(o[e])})})},placeService:function(){var o=this;return e.Deferred(function(t){o.loadAPI().then(function(){var e="_cachePlaceService",s=document.createElement("div");document.body.appendChild(s),o[e]=o[e]||new google.maps.places.PlacesService(s),t.resolve(o[e])})})},placeDetail:function(o){var t=this;return e.Deferred(function(e){t.placeService().then(function(s){var n="_cachePlaceDetail";t[n]=t[n]||{},t[n][o]?e.resolve(t[n][o]):s.getDetails({placeId:o},function(s,p){"OK"===p?(t[n][o]=s,e.resolve(s)):e.reject(p)})})})}},joms.util||(joms.util={}),joms.util.map=function(o){"function"==typeof o&&(new s).loadAPI().done(function(){o()})},joms.util.map.search=function(o){return e.Deferred(function(t){(new s).search(o).done(function(o){t.resolve(o)})})},joms.util.map.detail=function(o){return e.Deferred(function(t){(new s).placeDetail(o).done(function(o){t.resolve(o)})})}}),e("utils/popup",["core","utils/map"],function(){function o(){}o.prototype.prepare=function(o){var t,e;if(joms.jQuery.magnificPopup)return t=this.showPopup(),void o(t);e=this,this.loadlib(function(){joms.jQuery.magnificPopup&&(t=e.showPopup(),o(t))})},o.prototype.showPopup=function(){joms.jQuery.magnificPopup.open({type:"inline",items:{src:[]},tClose:window.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,tLoading:window.joms_lang.COM_COMMUNITY_POPUP_LOADING});var o=joms.jQuery.magnificPopup.instance,t="joms-popup__wrapper";return joms.mobile&&(t+=" joms-popup__mobile"),o.container.addClass(t),o.updateStatus("loading"),o.container.off("click.joms-closepopup",".joms-js--button-close").on("click.joms-closepopup",".joms-js--button-close",function(){o.close()}),o},o.prototype.loadlib=function(o){o()},joms.util||(joms.util={}),joms.util.popup=new o}),p=window,i=joms.jQuery,joms.util||(joms.util={}),joms.util.dropdown=function(o,t,e){var s,n,p,i,a="click.dropdown",u="collapse.dropdown",c="[data-ui-object=joms-dropdown-button]",r=".joms-dropdown,.joms-popover";function m(){n&&n.hide(),s&&d(s)}function l(o){var e,i,a,u;if(o.stopPropagation(),o.preventDefault(),e=t(o.currentTarget),(i=e.siblings(r)).length)return i.is(":visible")?(i.hide(),void d(e)):"large"===joms.screenSize()?(m(),i.show(),(u=(a=e).parent()).hasClass(".joms-focus__button--options--desktop")?u.addClass("active"):a.addClass("active"),s=e,n=i,void j(i)):void joms.util.popup.prepare(function(o){var t;(p=o).items[0]={type:"inline",src:(t=i,'<div class="joms-popup joms-popup--dropdown">'+t[0].outerHTML+"</div>")},p.updateItemHTML(),j(i),p.contentContainer.on("click","li > a",function(){p.close()})})}function d(o){var t=o.parent();t.hasClass(".joms-focus__button--options--desktop")?t.removeClass("active"):o.removeClass("active")}function j(o){var t=o.attr("class")||"";o.css("left",""),o.offset().left<0&&o.css("left",-25),t.match("joms-popover--toolbar-general")?joms.api.notificationGeneral():t.match("joms-popover--toolbar-friendrequest")?joms.api.notificationFriend():t.match("joms-popover--toolbar-pm")&&joms.api.notificationPm()}var f=joms._.debounce(function(e){var s,n,i,a,u,c,r=e.currentTarget.className||"";r.indexOf("joms-dropdown--privacy")<0||(s=t(e.currentTarget),(n=t(e.target).closest("li")).length&&(i=t(".joms-button--privacy").filter('[data-name="'+s.data("name")+'"]'),a=i.children("[data-ui-object=joms-dropdown-value]"),u=i.children("span"),c=i.find("use"),a.val(n.data("value")),u.html(n.children("span").html()),c.attr("xlink:href",o.location.href.replace(/#.*$/,"")+"#"+n.data("classname"))),m(),p&&p.close())},100);function v(){i&&(i.off(a),i.off(a,c),i.off(u,c),i.off(a,r))}return{start:function(){v(),i||(i=t(document.body)),i.on(a,m),i.on(a,c,l),i.on(u,c,m),i.on(a,r,function(o){var e=t(o.target).data("propagate")||t(o.currentTarget).data("propagate");e||o.stopPropagation(),f(o)})},stop:v}}(p,i),e("utils/dropdown",["utils/popup"],function(){return joms.util.dropdown}),a=window,u=joms.jQuery,joms.util||(joms.util={}),joms.util.hovercard=function(o,t){var e,s,n,p={},i="mouseover.joms-hcard",a="mouseout.joms-hcard",u="img[data-author]";function c(o){var u=t(o.target),c=u.data("author");if(u.removeAttr("title"),e||((e=t("<div>Loading...</div>")).css({position:"absolute",zIndex:2e3}),e.appendTo(document.body),e.on(i,function(){clearTimeout(n)}),e.on(a,r)),clearTimeout(n),p[c])return clearTimeout(s),void(s=setTimeout(function(){m(p[c],u)},400));joms.ajax({func:"profile,ajaxFetchCard",data:[c],callback:function(o){o.html&&(p[c]=o.html,clearTimeout(s),m(o.html,u))}})}function r(){clearTimeout(s),n=setTimeout(function(){e&&e.hide()},400)}function m(s,n){var p=t(document),i=n.offset(),a=n.width(),u=n.height(),c=o.innerWidth,r=o.innerHeight+p.scrollTop(),m=140,l=i.left+320<c,d=i.top+u+10;e.html(s),e.css({top:-1e4,left:l?i.left:"",right:l?"":c-i.left-a}),e.show(),m=e.height(),d+m>r&&(d=i.top-m-4),e.css({top:d})}return{initialize:function(){joms.mobile||t(document.body).off(i).off(a).on(i,u,c).on(a,u,r)}}}(a,u),e("utils/hovercard",function(){}),c=window,joms.util||(joms.util={}),joms.util.loadLib=(r=c,function(o,t){return"gmap"===o?t():"mediaelement"===o?function(o){if(r.MediaElement)return o();joms.$LAB.script(joms.ASSETS_URL+"vendors/mediaelement/mediaelement-and-player.min.js").wait(function(){o()})}(t):"flowplayer"===o?function(o){if(r.flowplayer)return o();joms.$LAB.script(joms.ASSETS_URL+"flowplayer/flowplayer-3.2.6.min.js").wait(function(){o()})}(t):"plupload"===o?function(o){if(r.plupload)return o();joms.$LAB.script(joms.ASSETS_URL+"vendors/plupload.min.js").wait(function(){o()})}(t):"trumbowyg"===o?(e=t,!!joms.jQuery&&(joms.jQuery.trumbowyg?e():(joms.loadCSS(joms.ASSETS_URL+"vendors/trumbowyg/ui/trumbowyg.min.css"),void joms.$LAB.script(joms.ASSETS_URL+"vendors/trumbowyg/trumbowyg.min.js").wait().script(joms.ASSETS_URL+"vendors/trumbowyg/plugins/base64/trumbowyg.base64.min.js").wait().script(joms.ASSETS_URL+"vendors/trumbowyg/plugins/upload/trumbowyg.upload.js").wait(function(){e()})))):"dragsort"===o?function(o){if(r.Sortable)return o();joms.$LAB.script(joms.ASSETS_URL+"dragsort/jquery.dragsort-0.5.1.min.js").wait(function(){o()})}(t):void t();var e}),e("utils/loadlib",function(){}),m=window,l=joms.jQuery,d=window._,j=function(o,t,e){function s(o){this.$input=t(o),this.$wrapper=this.$input.parent(".joms-location__wrapper"),this.$inputDesc=this.$input.siblings(".js-desc"),this.$inputLat=this.$input.siblings(".js-lat"),this.$inputLng=this.$input.siblings(".js-lng"),this.$description=this.$input.siblings(".joms-location__description"),this.$dropdown=this.$input.siblings(".joms-location__dropdown"),this.$loading=this.$dropdown.find(".joms-location__loading"),this.$result=this.$dropdown.find(".joms-location__result"),this.$header=this.$dropdown.find(".joms-location__header"),this.$map=this.$dropdown.find(".joms-location__map"),this.$list=this.$dropdown.find(".joms-location__list"),this.$input.on("focus.joms-location",t.proxy(this.focus,this)),this.$input.on("blur.joms-location",t.proxy(this.hide,this)),this.$input.on("input.joms-location",t.proxy(this.search,this)),this.$dropdown.on("mousedown",".joms-location__list a",t.proxy(this.select,this)),this.$dropdown.on("click",".joms-location__close",t.proxy(this.hide,this))}return s.prototype.show=function(){this.$dropdown.show()},s.prototype.hide=function(){this.$dropdown&&this.$dropdown.hide()},s.prototype.focus=function(){this._search_success&&this.show()},s.prototype.search=function(){var o=t.trim(this.$input.val());this.$wrapper.css("display","inline-block"),this.$description.html(this.$description.data("tips")),o&&(this.$result.hide(),this.$loading.show(),this.$dropdown.show(),this._search(o)),setTimeout(t.proxy(function(){this.$wrapper.css("display","")},this),0)},s.prototype._search=e.debounce(function(o){this._get_autocomplete_service().done(function(e){e.getPlacePredictions({input:o},t.proxy(function(o,e){this.$loading.hide(),this.$result.show(),"OK"===e&&this._format_result(o).done(t.proxy(function(o){this.$list.html(o),this._search_success=!0},this))},this))})},1e3),s.prototype.select=function(o){var e=t(o.currentTarget),s=e.find(".js-name").text(),n=e.find(".js-desc").text(),p=e.data("place-id");o.preventDefault(),o.stopPropagation(),p&&(this.$input.val(s),this.$inputDesc.val(n),this.$description.html(n),this._get_location_detail(p).done(function(o){var t=o.geometry.location;this.$inputLat.val(t.lat()),this.$inputLng.val(t.lng()),this._render_map(this.$map[0],o)}))},s.prototype._load_library=function(){return t.Deferred(t.proxy(function(e){joms.util.map(t.proxy(function(){e.resolveWith(this,[o.google])},this))},this))},s.prototype._get_autocomplete_service=function(){return t.Deferred(t.proxy(function(o){this._autocomplete_service?o.resolveWith(this,[this._autocomplete_service]):this._load_library().done(function(t){this._autocomplete_service=new t.maps.places.AutocompleteService,o.resolveWith(this,[this._autocomplete_service])})},this))},s.prototype._get_location_service=function(){return t.Deferred(t.proxy(function(o){this._location_service?o.resolveWith(this,[this._location_service]):this._load_library().done(function(t){var e=document.createElement("div");document.body.appendChild(e),this._location_service=new t.maps.places.PlacesService(e),o.resolveWith(this,[this._location_service])})},this))},s.prototype._get_location_detail=function(o){return t.Deferred(t.proxy(function(e){this._location_cache&&this._location_cache[o]?e.resolveWith(this,[this._location_cache[o]]):this._get_location_service().done(function(s){s.getDetails({placeId:o},t.proxy(function(t,s){"OK"===s?(this._location_cache||(this._location_cache={}),this._location_cache[o]=t,e.resolveWith(this,[t])):e.rejectWith(this,[s])},this))})},this))},s.prototype._render_map=function(e,s){var n,p,i=s.geometry.location,a=s.geometry.viewport;n=(e=t(e).show()).data("joms-map"),p=e.data("joms-map-marker"),n||(n=new o.google.maps.Map(e[0],{center:i,zoom:15,draggable:!1,scrollwheel:!1,disableDefaultUI:!0}),e.data("joms-map",n)),p||(p=new o.google.maps.Marker({position:i,map:n,title:"You are here (more or less)"}),e.data("joms-map-marker",p)),n.setCenter(i),p.setPosition(i),a?n.fitBounds(a):n.setZoom(15)},s.prototype._format_result=function(o){return t.Deferred(t.proxy(function(s){var n,p=[];n=['<a href="javascript:" data-place-id="{place_id}">','<span class="joms-location__name js-name">{name}</span>','<span class="joms-location__desc js-desc">{description}</span>',"</a>"].join(""),e.each(o,function(o){p.push(this._get_location_detail(o.place_id))},this),t.when.apply(t,p).then(t.proxy(function(){var o=e.map(arguments,function(o){return n.replace("{place_id}",o.place_id).replace("{name}",o.name).replace("{description}",o.formatted_address||"&nbsp;")});s.resolveWith(this,[o.join("")])},this))},this))},s}(m,l,d),e("utils/location-autocomplete",["utils/map"],function(){return j}),l.fn.locationAutocomplete=function(){return this.each(function(){var o="location-autocomplete",t=l(this);t.data(o)||t.data(o,new j(this))})},l(function(){l(".joms-input--location").locationAutocomplete()}),window,joms.util||(joms.util={}),joms.util.tab=function(){function o(){var o,t=".joms-tab__bar",e=".joms-tab__content";function s(o){var s,n,p=joms.jQuery(o.currentTarget),i=p.parent(t),a=p.attr("href");return p.find(".joms-tab__bar--button").length&&((n=joms.jQuery(o.target)).hasClass("add")||n[0].tagName.match(/use|svg/i))?(o.preventDefault(),o.stopPropagation(),!1):0===a.indexOf("#")?(p.closest(t).siblings(a).show().siblings(e).hide(),p.addClass("active").siblings("a").removeClass("active"),(s=i.data("id"))&&(s="#tab:"+s+"/"+p.data("id"),window.location=s),!1):void 0}o&&o.off("click.joms-tab"),o||(o=joms.jQuery(document.body)),o.on("click.joms-tab",t+" a",s)}return{start:function(){o(),joms.jQuery(".cTabsBar").on("click","li",function(o){var t,e,s=joms.jQuery(o.currentTarget),n=s.closest(".cTabsBar").siblings(".cTabsContentWrap");n.length&&(t=s.prevAll().length,(e=n.children(".cTabsContent").eq(t)).length&&(s.addClass("cTabCurrent").siblings(".cTabCurrent").removeClass("cTabCurrent"),e.siblings(".cTabsContent").hide(),e.show()))})}}}(),e("utils/tab",function(){}),f=window,v=joms.jQuery,joms.util||(joms.util={}),joms.util.tagging=function(o,t){var e=13,s=27,n=38,p=40,i="joms-tagging",a=".joms-textarea",u=a+"__wrapper",c=a+"__beautifier",r=a+"__hidden",m=a+"__tag-ct",l=a+"__tag-item",d=l+"--active",j=/@\[\[(\d+):contact:([^\]]+)\]\]/g,f=/@\[\[(\d+):contact:([^\]]+)\]\]/,v=/(^|#|\s)(#[^#\s]+)/g,b=/\n/g;function h(o,e){return this.textarea=o,this.fetcher=e||!1,this.$textarea=t(o),this.$textarea.data("initialValue",o.value),this.$textarea.data(i,this),this.$textarea.on("focus."+i,t.proxy(this.initialize,this)),this}return h.prototype.initialize=function(){var o,e,s,n,p;if(this.dropdownIsOpened=!1,this.dropdownIsClicked=!1,this.dropdownSelectedItem=!1,this.domPrepare(),this.tagsAdded=[],o="",this.$textarea.data("initialValue")&&(e=(o=this.textarea.value).match(j),this.textarea.value=o.replace(j,"$2"),e&&e.length))for(p=0;p<e.length;p++)s=e[p].match(f),n=o.indexOf(e[p]),o=o.replace(e[p],s[2]),this.tagsAdded.push({id:s[1],name:s[2],start:n,length:s[2].length});this.beautifierUpdate(o,this.tagsAdded),this.hiddenUpdate(o,this.tagsAdded),this.inputAutogrow(),this.$textarea.off("focus."+i).on("focus."+i,t.proxy(this.inputOnKeydown,this)).off("click."+i).on("click."+i,t.proxy(this.inputOnKeydown,this)).off("keydown."+i).on("keydown."+i,t.proxy(this.inputOnKeydown,this)).off("keyup."+i).on("keyup."+i,t.proxy(this.inputOnKeyup,this)).off("input."+i).on("input."+i,t.proxy(this.inputOnInput,this)).off("blur."+i).on("blur."+i,t.proxy(this.inputOnBlur,this)),this.$dropdown.off("mouseenter."+i).on("mouseenter."+i,l,t.proxy(this.dropdownOnMouseEnter,this)).off("mousedown."+i).on("mousedown."+i,l,t.proxy(this.dropdownOnMouseDown,this)).off("mouseup."+i).on("mouseup."+i,l,t.proxy(this.dropdownOnMouseUp,this)),this.textarea.joms_beautifier=this.$beautifier,this.textarea.joms_hidden=this.$hidden;var a=this;this.textarea.joms_reset=function(){a.inputReset()}},h.prototype.domPrepare=function(){this.$wrapper=this.$textarea.parent(u),this.$wrapper.length||(this.$textarea.wrap('<div class="'+u.substr(1)+'"></div>'),this.$wrapper=this.$textarea.parent()),this.$beautifier=this.$wrapper.children(c),this.$beautifier.length||(this.$beautifier=t('<div class="'+a.substr(1)+" "+c.substr(1)+'"></div>'),this.$beautifier.prependTo(this.$wrapper)),this.$hidden=this.$wrapper.children(r),this.$hidden.length||(this.$hidden=t('<input type="hidden" class="'+r.substr(1)+'">'),this.$hidden.appendTo(this.$wrapper)),this.$dropdown=this.$wrapper.children(m),this.$dropdown.length||(this.$dropdown=t('<div class="'+m.substr(1)+'"></div>'),this.$dropdown.appendTo(this.$wrapper))},h.prototype.inputPrepare=function(){},h.prototype.inputReset=function(){this.tagsAdded&&(this.tagsAdded=[])},h.prototype.inputAutogrow=function(){var o,t=+this.$textarea.data(i+"-prevHeight");this.$wrapper.css({height:t}),this.$textarea.css({height:""}),o=this.textarea.scrollHeight+2,this.$textarea.css({height:o}),o!==+t&&this.$textarea.data(i+"-prevHeight",o),this.$wrapper.css({height:""})},h.prototype.inputOnKeydown=function(o){return!(this.dropdownIsOpened&&[e,s,n,p].indexOf(o.keyCode)>=0)&&(o.keyCode===s?(this.inputReset(),!1):(this.prevSelStart=this.textarea.selectionStart,void(this.prevSelEnd=this.textarea.selectionEnd)))},h.prototype.inputOnKeyup=function(o){if(this.dropdownIsOpened){if(o.keyCode===n||o.keyCode===p)return this.dropdownChangeItem(o.keyCode),!1;if(o.keyCode===e)return this.dropdownSelectItem(),!1;if(o.keyCode===s)return this.dropdownHide(),!1}},h.prototype.inputOnInput=function(){var o,t,e,s,n,p,i,a,u,c,r,m=this.textarea.value;if(this.tagsAdded){if(this.prevSelStart!==this.prevSelEnd)for(c=0;c<this.tagsAdded.length;c++)e=(t=this.tagsAdded[c]).start+t.length,(this.prevSelStart>t.start&&this.prevSelStart<e||this.prevSelEnd>t.start&&this.prevSelEnd<e||t.start>=this.prevSelStart&&e<=this.prevSelEnd)&&this.tagsAdded.splice(c--,1);for(o=this.textarea.selectionStart-this.prevSelStart-(this.prevSelEnd-this.prevSelStart),c=0;c<this.tagsAdded.length;c++)if((t=this.tagsAdded[c]).start>=this.prevSelStart)t.start+=o;else if((e=t.start+t.length)<this.prevSelStart);else if(e>this.prevSelStart){if(o>0)this.tagsAdded.splice(c--,1);else if(o<0){for(p=(s=m.substring(t.start,this.prevSelStart+o)).split(" ").length-1,(s=t.name.split(" ")).splice(p,1),s=s.join(" "),n=(n=(n=t.name.split(" ")).slice(0,p)).join(" "),i=new RegExp("^([\\s\\S]{"+t.start+"})([\\s\\S]{"+(t.length+o)+"})"),a="$1"+s,this.textarea.value=this.textarea.value.replace(i,a),this.textarea.setSelectionRange(t.start+n.length,t.start+n.length),m=this.textarea.value,u=t.length-s.length,t.name=s,t.length=s.length,r=c+1;r<this.tagsAdded.length;r++)this.tagsAdded[r].start-=u;s.length||this.tagsAdded.splice(c--,1),c=this.tagsAdded.length}}else if(o<0){for((s=t.name.split(" ")).pop(),s=s.join(" "),i=new RegExp("^([\\s\\S]{"+t.start+"})([\\s\\S]{"+(t.length+o)+"})"),a="$1"+s,this.textarea.value=this.textarea.value.replace(i,a),this.textarea.setSelectionRange(t.start+s.length,t.start+s.length),m=this.textarea.value,u=t.length-s.length,t.name=s,t.length=s.length,r=c+1;r<this.tagsAdded.length;r++)this.tagsAdded[r].start-=u;s.length||this.tagsAdded.splice(c--,1),c=this.tagsAdded.length}}this.inputAutogrow(),this.beautifierUpdate(m,this.tagsAdded||[]),this.hiddenUpdate(m,this.tagsAdded||[]),this.dropdownToggle()},h.prototype.inputOnBlur=function(){this.dropdownIsClicked||this.dropdownHide()},h.prototype.beautifierUpdate=joms._.debounce(function(o,t){var e,s,n,p,i;if(t.length){for(e="^",s="",n=0,i=0;i<t.length;i++)e+="([\\s\\S]{"+((p=t[i]).start-n)+"})([\\s\\S]{"+p.length+"})",s+="$"+(2*i+1)+"[b]"+p.name+"[/b]",n=p.start+p.length;e=new RegExp(e),o=o.replace(e,s)}o=(o=(o=(o=o.replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/\[(\/?b)\]/g,"<$1>")).replace(v,"$1<b>$2</b>")).replace(b,"<br>"),this.$beautifier.html(o)},joms.mobile?100:1),h.prototype.hiddenUpdate=joms._.debounce(function(o,t){var e,s,n,p,i;if(t.length){for(e="^",s="",n=0,i=0;i<t.length;i++)e+="([\\s\\S]{"+((p=t[i]).start-n)+"})([\\s\\S]{"+p.length+"})",s+="$"+(2*i+1)+"@[["+p.id+":contact:"+p.name+"]]",n=p.start+p.length;e=new RegExp(e),o=o.replace(e,s)}this.$hidden.val(o)},joms.mobile?500:50),h.prototype.dropdownToggle=joms._.debounce(function(){var o=this.textarea.selectionStart,t=this.textarea.value.substr(0,o),e=t.lastIndexOf("@");e<0||++e>=o?this.dropdownHide():(t=t.substring(e,o),this.dropdownFetch(t,joms._.bind(this.dropdownUpdate,this)))},joms.mobile?1e3:200),h.prototype.dropdownFetch=function(t,e,s){var n,p,i,a,u,c=(o.joms_friends||[]).concat(s||[]),r=this.tagsAdded||[],m=[],l=[];if(c&&c.length)for(t=t.toLowerCase(),a=0;a<c.length&&m.length<20;a++)if(((n=c[a]).name||"").toLowerCase().indexOf(t)>=0){for(p=!1,u=0;u<r.length;u++)if(+n.id==+r[u].id){p=!0;break}!p&&l.indexOf(+n.id)<0&&(l.push(+n.id),m.push({id:n.id,name:n.name,img:n.avatar}))}m.sort(function(o,t){return o.name<t.name?-1:o.name>t.name?1:0}),e(m),"function"!=typeof this.fetcher||s||(i=this,this.fetcher(function(o){o||(o=[]),i.dropdownFetch(t,joms._.bind(i.dropdownUpdate,i),o)}))},h.prototype.dropdownUpdate=function(o){var t,e,s,n,p;if(o&&o.length){for(t="",s=l.substr(1),p=Math.min(10,o.length),n=0;n<p;n++)t+='<a href="javascript:" class='+s+' data-id="'+(e=o[n]).id+'" data-name="'+e.name+'">',t+='<img src="'+e.img+'">'+e.name+"</a>";this.dropdownShow(t)}else this.dropdownHide()},h.prototype.dropdownShow=function(o){this.$dropdown.html(o).show(),this.dropdownIsOpened=!0,this.dropdownSelectedItem=!1},h.prototype.dropdownHide=function(){this.$dropdown.hide(),this.dropdownIsOpened=!1},h.prototype.dropdownOnMouseEnter=function(o){this.dropdownChangeItem(o)},h.prototype.dropdownOnMouseDown=function(){this.dropdownIsClicked=!0},h.prototype.dropdownOnMouseUp=function(o){this.dropdownSelectItem(o),this.dropdownIsClicked=!1,this.dropdownHide()},h.prototype.dropdownChangeItem=function(o){var e,s,p,i=d.substr(1);if("number"!=typeof o)return s=(e=this.dropdownSelectedItem=t(o.target)).siblings(d),e.addClass(i),void s.removeClass(i);(e=this.$dropdown.children(d)).length?(p=e[o===n?"prev":"next"](),e.removeClass(i),p.length?(this.dropdownSelectedItem=p,p.addClass(i)):this.dropdownSelectedItem=!1):(e=this.dropdownSelectedItem=this.$dropdown.children()[o===n?"last":"first"]()).addClass(i)},h.prototype.dropdownSelectItem=function(o){var e,s,n=o?t(o.currentTarget):this.dropdownSelectedItem,p=n.data("id"),i=n.data("name"),a=this.textarea.selectionStart,u=this.textarea.value.substr(0,a).lastIndexOf("@");this.tagsAdded||(this.tagsAdded=[]),this.tagsAdded.push({id:p,name:i,start:u,length:i.length}),e=new RegExp("^([\\s\\S]{"+u+"})[\\s\\S]{"+(a-u)+"}"),s=this.textarea.value.replace(e,"$1"+i),this.textarea.value=s,this.inputAutogrow(),this.beautifierUpdate(s,this.tagsAdded),this.hiddenUpdate(s,this.tagsAdded),this.dropdownHide()},h.prototype.clear=function(){this.tagsAdded=[],this.$textarea&&this.$textarea.val(""),this.$hidden&&this.$hidden.val(""),this.$beautifier&&this.$beautifier.empty()},function(o,e){var s=t(o).data(i);return s||new h(o,e)}}(f,v),v.fn.jomsTagging=function(o){return this.each(function(){joms.util.tagging(this,o)})},e("utils/tagging",function(){}),window,b=joms.jQuery,joms.util||(joms.util={}),joms.util.validation=function(o,t){var e="valid",s="invalid";function n(o){var e,s;return o=t(o),e=o.parents(".joms-select--wrapper, .joms-textarea__wrapper, .joms-location__wrapper, .joms-checkbox--wrapper, .joms-radio--wrapper"),(s=e.length?e.next("p.joms-help"):o.next("p.joms-help")).length||(s=t('<p class="joms-help" style="color:red">')).hide().insertAfter(e.length?e:o),s}function p(){var o="joms-validation",p="focus."+o,a="blur."+o,u="change."+o,c="validate."+o,r=t(".joms-form__group"),m=r.find("[required]").add(r.find("[data-required]"));m.off(u).on(u,function(o,e){var s=t(this);"checkbox"!==s.attr("type")&&"radio"!==s.attr("type")||s.trigger(c,e)}).off(p).on(p,function(){var o=t(this);o.data("currentValue",o.val())}).off(a).on(a,function(o,e){var s=t(this),n=s.data("currentValue");void 0!==n&&s.val()!==n&&s.trigger(c,e)}).off(c).on(c,function(o,p){var a,u,r,m,l,d,j,f,v,b,h,_,g,w,k,y,x,C,M,T,S=t(this),L=n(S),O=S.closest(".joms-form__group").children().first(),I=S.attr("name"),U=(S.attr("type")||"").toLowerCase(),E=S.prop("tagName").toLowerCase(),A=t.trim(O.text().replace(/\*/g,"")),R=t.trim(S.val());if("function"!=typeof p&&(p=function(){var o,e=S.data("verify");e&&(o=t(e)).length&&t.trim(o.val())&&o.trigger(c)}),U.match(/^(text|password)$/)||E.match(/^(select|textarea)$/))R?"username"===(a=S.data("validation")||"")?(l=S,d=R,j=p,f=S.data("current")||"",joms.ajax({func:"register,ajaxCheckUserName",data:[d,f],callback:function(o){var t=n(l);o.error?(t.html(o.error),t.show(),j(s)):(t.fadeOut(),j(e))}})):"email"===a?function(o,t,p){if(!/^([*+!.&#$¦\'\\%\/0-9a-z^_`{}=?~:-]+)@(([0-9a-z-]+\.)+[0-9a-z]{2,8})$/i.test(t))return i(o,["","","COM_COMMUNITY_INVALID_EMAIL"]),void p(s);joms.ajax({func:"register,ajaxCheckEmail",data:[t],callback:function(t){var i=n(o);t.error?(i.html(t.error),i.show(),p(s)):(i.fadeOut(),p(e))}})}(S,R,p):a.match(/^email:/)?(y=R,x=p,C=(k=S).data("validation").split(":"),M=t(C[1]),T=n(k),M.length&&y!==M.val()?(i(k,["","","COM_COMMUNITY_REGISTER_EMAIL_NOT_SAME"]),x(s)):(T.fadeOut(),x(e))):"password"===a?(u=S,r=R,m=p,joms.ajax({func:"register,ajaxCheckPass",data:[r],callback:function(o){var t=n(u);o.error?(t.html(o.error.replace(/\n/g,"<br/>")),t.show(),m(s)):(t.fadeOut(),m(e))}})):a.match(/^password:/)?(b=R,h=p,_=(v=S).data("validation").split(":"),g=t(_[1]),w=n(v),g.length&&b!==g.val()?(i(v,["","","COM_COMMUNITY_REGISTER_PASSWORD_NOT_SAME"]),h(s)):(w.fadeOut(),h(e))):(L.fadeOut(),p(e)):(i(S,[I,A,"COM_COMMUNITY_REGISTER_INVALID_VALUE"]),p(s));else if(U.match(/^(radio|checkbox)$/)){var N=t('[name="'+I+'"]:checked').length;N?(L.fadeOut(),p(e)):(i(S,[I,A,"COM_COMMUNITY_REGISTER_INVALID_VALUE"]),p(s))}})}function i(o,t){joms.ajax({func:"register,ajaxSetMessage",data:t,callback:function(t){var e=n(o);e.html(t.message),e.show()}})}return{start:function(){var o,e,s,n;t(".joms-form__group").find("[required]").add(t(".joms-form__group").find("[data-required]")).each(function(){var o=t(this),e=o.closest(".joms-form__group"),s=e.children().first();s.find(".joms-required").length||s.append(' <span class="joms-required">*</span>')}),(n=t(".joms-form__group").find("textarea[data-maxchars]")).css("display","inline"),n.wrap('<div style="position:relative"></div>'),n.parent().append('<div class="joms-js--textarea-counter" style="position:absolute;bottom:2px;right:5px"></div>'),n.each(function(){var o=t(this);o.siblings(".joms-js--textarea-counter").html(o.data("maxchars"))}),n.off("input").on("input",function(){var o,e=t(this),s=e.siblings(".joms-js--textarea-counter"),n=e.data("maxchars")||0;n&&((o=e.val()).length>n&&(o=o.substr(0,n),e.val(o)),s.html(n-o.length))}),o=t(".joms-textarea__wrapper").find(".joms-textarea--limit"),e="joms-textarea--error",s="input.joms-textarea-limit",o.off(s).on(s,function(){var o=t(this),s=o.parent(".joms-textarea__wrapper"),n=s.find(".joms-textarea__limit > span > span"),p=o.data("min-char"),i=o.data("max-char"),a=o.val(),u=a.length;s.length||(s=o),p=isNaN(p)?0:Math.max(0,+p),i=!isNaN(i)&&Math.max(p,+i),u<p?s.hasClass(e)||s.addClass(e):(s.hasClass(e)&&s.removeClass(e),!1!==i&&u>i&&(a=a.substr(0,i),o.val(a))),s.css("display","inline-block"),n.html(a.length),setTimeout(function(){s.css("display","")},0)}),p()},stop:function(){},validate:function(o,e){var n,p,i,a=0,u=0;return n=t(o),p=n.find("[required]").add(n.find("[data-required]")),i=p.length,p.length||e(a),p.each(function(){t(this).trigger("validate.joms-validation",function(o){o===s&&a++,++u>=i&&e(a)})}),!1}}}(0,b),e("utils/validation",function(){}),h=window,g=joms.jQuery,joms.util||(joms.util={}),joms.util.video=function(o,t){function e(e,s,n){"file"===s&&"flv"===n.fileType?joms.util.loadLib("flowplayer",function(){o.flowplayer(e,{src:joms.ASSETS_URL+"flowplayer/flowplayer-3.2.7.swf",wmode:"opaque"},{streamingServer:"lighttpd",playlist:[{url:n.filePath,autoPlay:!1,autoBuffering:!0,provider:"lighttpd",scaling:"scale"}],plugins:{lighttpd:{url:joms.ASSETS_URL+"flowplayer/flowplayer.pseudostreaming-3.2.7.swf",queryString:o.escape("?target=${start}")},controls:{url:joms.ASSETS_URL+"flowplayer/flowplayer.controls-3.2.5.swf"}}})}):joms.util.loadLib("mediaelement",function(){var o=t("#"+e).css({visibility:""}),n={iPadUseNativeControls:"file"===s,iPhoneUseNativeControls:"file"===s,success:function(o,t,e){setTimeout(function(){e.disableControls(),e.enableControls()},1),"flash"===o.pluginType?o.addEventListener("canplay",function(){o.play()},!1):(!joms.mobile||"youtube"!==o.pluginType&&"vimeo"!==o.pluginType)&&o.play()}};"youtube"===s&&(n.defaultVideoWidth=o.width(),n.defaultVideoHeight=o.height()),o.mediaelementplayer(n)})}return{play:function(s,n){var p,i,a,u,c,r,m,l,d,j,f,v,b,h,_,g,w,k,y,x,C,M,T,S,L,O,I,U,E,A,R,N,H,P,$,Y,Q,F,B,D,q,z,G;"file"===n.type?(f=n,_=(j=s).find(".joms-media__thumbnail"),b=joms._.uniqueId("joms-js--video-"),v="flv"==(h=f.path.match(/\.flv$/)?"flv":"mp4")?t('<div class="flowplayer" id="'+b+'" style="width:100%;height:281px;"></div>'):t('<video id="'+b+'" width="480" height="360" preload="metadata" autoplay="autoplay"><source src="'+f.path+'" type="video/mp4" /></video>'),j.addClass("being-played"),_.html(v),e(b,f.type,{fileType:h,filePath:f.path})):"youtube"===n.type?o.joms_videoplayer_native?(l=n,(d=(m=s).find(".joms-media__thumbnail")).length||(d=m),m.addClass("being-played joms-media--video-native"),d.html('<iframe src="//www.youtube.com/embed/'+l.id+'?autoplay=1&rel=0" width="500" height="281" frameborder="0" allowfullscreen></iframe>')):(p=s,i=n,a=joms._.uniqueId("joms-js--video-"),u=i.path,joms.ios&&(u=(u=u.replace(/#.*$/,"")).replace(/&t=\d+/,"")),(c=t('<video id="'+a+'" controls="control" preload="none"><source src="'+u+'" type="video/youtube" /></video>')).css({visibility:"hidden"}),(r=p.find(".joms-media__thumbnail")).length||(r=p),p.addClass("being-played"),r.html(c),e(a,i.type)):"vimeo"===n.type?(z=n,G=(q=s).find(".joms-media__thumbnail"),q.addClass("being-played"),G.html('<iframe src="//player.vimeo.com/video/'+z.id+'?autoplay=1" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')):"myspace"===n.type?(F=n,B=(Q=s).find(".joms-media__thumbnail"),D=(D=(D=(D=F.path).replace(/^https?:/,"")).replace(/myspace.com\/myspace\//,"myspace.com/play/")).replace(/\/(\d+)$/,"-$1"),Q.addClass("being-played"),B.html('<iframe src="'+D+'" width="500" height="281" frameborder="0" allowtransparency="true" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')):"blip"===n.type?(P=n,$=(H=s).find(".joms-media__thumbnail"),Y="//blip.tv/play/"+P.id,H.addClass("being-played"),$.html('<iframe src="'+Y+'" width="500" height="281" frameborder="0" allowfullscreen></iframe>')):"dailymotion"===n.type?(A=n,R=(E=s).find(".joms-media__thumbnail"),N=(N=(N=A.path).replace(/^https?:/,"")).replace(/\/video\/([^_]+)_.+$/,"/embed/video/$1"),E.addClass("being-played"),R.html('<iframe src="'+N+'" width="500" height="281" frameborder="0" allowfullscreen></iframe>')):"liveleak"===n.type?(O=n,I=(L=s).find(".joms-media__thumbnail"),U="//www.liveleak.com/ll_embed?i="+O.id,L.addClass("being-played"),I.html('<iframe src="'+U+'" width="500" height="281" frameborder="0" allowfullscreen></iframe>')):"yahoo"===n.type?(M=n,T=(C=s).find(".joms-media__thumbnail"),S=(S=(S=M.path).replace("www.yahoo.com/movies/v","movies.yahoo.com/video"))+"?format=embed&player_autoplay=true",C.addClass("being-played"),T.html('<iframe src="'+S+'" width="500" height="281" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>')):"metacafe"===n.type?(k=n,y=(w=s).find(".joms-media__thumbnail"),x="http://www.metacafe.com/embed/"+k.id+"/",w.addClass("being-played"),y.html('<iframe src="'+x+'" width="500" height="281" frameborder="0" allowfullscreen></iframe>')):(g=n,o.open(g.path))}}}(h,g),e("utils/video",["utils/loadlib"],function(){return joms.util.video}),w=window,k=joms.jQuery,joms.util||(joms.util={}),joms.util.wysiwyg=function(o,t){function e(o,e){return t("<button/>",{class:"joms-button--full-small joms-button--"+("submit"===o?"primary":"neutral"),type:o,text:this.lang[o]||o}).appendTo(e.find("form"))}return{start:function(){var s=t("textarea").filter("[data-wysiwyg=trumbowyg]");s.length&&joms.util.loadLib("trumbowyg",function(){t.extend(jQuery.trumbowyg.langs.en,o.joms_lang.wysiwyg||{});var n=!1;"rtl"===t("html").attr("dir")&&(n=!0),t.extend(jQuery.trumbowyg,{upload:{serverPath:joms.BASE_URL+"index.php?option=com_community&view=photos&task=ajaxPreviewComment&isEditor=1"}}),s.each(function(){var o,s,p;o=(o=(o=t(this).data("btns"))||"viewHTML,|,bold,italic,underline,|,unorderedList,orderedList,|,link,image").split(","),s={btnsDef:{image:{dropdown:["insertImage","upload"],ico:"insertImage"}},btns:o,fullscreenable:!1,mobile:!1,tablet:!1,removeformatPasted:!0,autogrow:!0},n&&(s.dir="rtl"),(p=t(this).trumbowyg(s).on("tbwblur",function(){var o=t(this).data("trumbowyg");o.syncCode()}).data("trumbowyg")).buildModalBtn=e,p._openModalInsert=p.openModalInsert,p.openModalInsert=function(o,e,s){var n=p._openModalInsert(o,e,s);return n.find("label").each(function(){var o,e=t(this),s=e.find("input"),n=s.attr("name"),p=s.attr("type");["url","file","title","text","target","alt"].indexOf(n)>=0&&(o='<div class="joms-form__group" style="text-align:left">',o+='<span style="width:90px;text-align:center">'+e.find(".trumbowyg-input-infos").text()+"</span>","file"===p?(o+='<input name="'+n+'" class="joms-input" value="'+(s.val()||"")+'" type="file"',o+=' accept="image/png,image/jpeg,image/gif,image/bmp">'):o+='<input name="'+n+'" class="joms-input" value="'+(s.val()||"")+'" type="'+(p||"text")+'">',o+="</div>",e.replaceWith(t(o)))}),n}})})}}}(w,k),e("utils/wysiwyg",["utils/loadlib"],function(){return joms.util.wysiwyg}),y=window,x=joms.jQuery,joms.fn||(joms.fn={}),joms.fn.tagging=function(o,t){var e={},s={},n={},p={},i={},a={};function u(e){var s,n=this,p=this.textarea.joms_data,i=p.tagId||p.id,a=(p.tagFunc||p.func||"").toLowerCase(),u=p.type||"",r=[];this.textarea.joms_friends?e(this.textarea.joms_friends):(a?(s="index.php?option=com_community&view=friends&task=ajaxAutocomplete",a.indexOf("album")>-1?s+="&albumid="+i:a.indexOf("photo")>-1?s+="&photoid="+i+"&rule=photo-comment":a.indexOf("video")>-1?s+="&videoid="+i:a.indexOf("discussion")>-1?s+="&discussionid="+i:a.indexOf("inbox")>-1?s+="&msgid="+i:u.match(/service\.comment\.joomla\.article/)&&(s+="&type=comment&streamid="+i)):(s="index.php?option=com_community&view=friends&task=ajaxAutocomplete&type=comment&streamid="+i,o.joms_group_id?s+="&groupid="+o.joms_group_id:o.joms_event_id&&(s+="&eventid="+o.joms_event_id)),this.fetchXHR&&this.fetchXHR.abort(),this.fetchXHR=t.ajax({url:joms.BASE_URL+s,dataType:"json",success:function(o){n.textarea.joms_friends=r=c(o)},complete:function(){var t,s,p,i;if(r.length&&o.joms_friends.length)for(t=0,p=Math.min(r.length,30);t<p;t++)for(s=0,i=Math.min(o.joms_friends.length,30);s<i;s++)+r[t].id==+o.joms_friends[s].id&&(o.joms_friends[s].avatar=r[t].avatar,o.joms_friends[s].name=r[t].name);n.fetchXHR=!1,e(r)}}))}function c(o){var t,e,s=[],n=[];if(o&&o.suggestions&&o.suggestions.length)for(e=0;e<o.suggestions.length;e++)t=""+o.data[e],s.indexOf(t)>=0||(s.push(t),n.push({id:t,name:o.suggestions[e],avatar:o.img[e].replace(/^.+src="([^"]+)".+$/,"$1"),type:"contact"}));return n}return{initInputbox:function(){t(document.body).find(".joms-js--newcomment").find("textarea.joms-textarea").each(function(){var o=t(this);o[0].joms_beautifier||(o[0].joms_data=o.data(),o.jomsTagging(u))})},fetchInputbox:u,fetchFriendsInContext:function(){var t="index.php?option=com_community&view=friends&task=ajaxAutocomplete",e=[];o.joms_group_id?t+="&groupid="+o.joms_group_id:o.joms_event_id?t+="&eventid="+o.joms_event_id:t+="&allfriends=1",joms.jQuery.ajax({url:joms.BASE_URL+t,dataType:"json",success:function(o){e=c(o)},complete:function(){o.joms_friends=e}})},fetchGroupMembers:function(o,t){var s="index.php?option=com_community&view=friends&task=ajaxAutocomplete&groupid="+o;i[o]||(i[o]=[]),n[o]?i[o].push(t):e[o]?t(e[o]):(n[o]=!0,joms.jQuery.ajax({url:joms.BASE_URL+s,dataType:"json",success:function(t){e[o]=c(t)},complete:function(){for(t(e[o]);i[o].length;)try{i[o].shift()(e[o])}catch(o){}n[o]=!1}}))},fetchEventMembers:function(o,t){var e="index.php?option=com_community&view=friends&task=ajaxAutocomplete&eventid="+o;a[o]||(a[o]=[]),p[o]?a[o].push(t):s[o]?t(s[o]):(p[o]=!0,joms.jQuery.ajax({url:joms.BASE_URL+e,dataType:"json",success:function(t){s[o]=c(t)},complete:function(){for(t(s[o]);a[o].length;)try{a[o].shift()(s[o])}catch(o){}p[o]=!1}}))}}}(y,x),e("functions/tagging",["utils/tagging"],function(){return joms.fn.tagging}),C=window,M=joms.jQuery,joms.view||(joms.view={}),joms.view.comment=function(o,t){var e,s,n,p,i,a,u,c;function r(){e&&(e.off("keydown.joms-comment",".joms-comment__reply textarea"),e.off("focus.joms-comment",".joms-comment__reply textarea"),e.off("focus.joms-comment",".joms-js--pm-message textarea"),e.off("click.joms-comment",".joms-comment__reply .joms-js--btn-send"),e.off("click.joms-comment",".joms-js--inbox-reply .joms-js--btn-send"),e.off("click.joms-comment",".joms-comment__more"))}function m(){joms.fn.tagging.initInputbox()}function l(){var o=".joms-js--initialized",e=".joms-js--video",s=t(".joms-comment__body,.joms-js--inbox").find(e).not(o).addClass(o.substr(1));s.length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),s.on("click.joms-video",e+"-play",function(){var o=t(this).closest(e);joms.util.video.play(o,o.data())}),joms.ios&&setTimeout(function(){s.find(e+"-play").click()},2e3))}function d(o){var e=o.keyCode||o.charCode;if(13===e&&!o.shiftKey&&!t(o.target).data("noentersend")&&!joms.mobile)return setTimeout(function(){v(o)},100),!1}function j(o){var e=t(o.target),s=e.closest(".joms-textarea__wrapper"),n=s.find(".joms-textarea__attachment");n.length&&(a=n)}function f(o){var e=t(o.currentTarget),s=e.closest(".joms-comment__reply,.joms-js--inbox-reply").find("textarea");v({currentTarget:s[0]})}function v(e){var s,n,p,i,c,r,m,d,j,f,v,h,_,g,w,k,y,x,C,M,T,S,L,O,I,U,E,A,R,N,H,P,$=t(e.currentTarget),Y=$.val()||"",Q=+$.data("edit");$[0].joms_hidden&&(Y=$[0].joms_hidden.val()||Y),(""!==Y.replace(/^\s+|\s+$/g,"")||(i=$.siblings(".joms-textarea__attachment")).length&&i.is(":visible"))&&(s=+$.data("id"),n=$.data("func")||"",p=$.data("type")||"",Q?(L=s,I=Y,U=function(){l(),b($,"edit")},P=O=n,(S=$).data("saving")||(S.data("saving",1),(E=S.siblings(".joms-textarea__attachment")).is(":visible")?(A=E.find(".joms-textarea__attachment--thumbnail").find("img"),R=A.attr("src"),A=A.data("photo_id")||"0"):A=E.data("no_thumb")?"0":"-1",P?(N=[L,I,O,A],O="system,ajaxUpdateWall"):(O="system,ajaxeditComment",N=[L,I,A]),(H=t(S).siblings(".joms-textarea__loading")).show(),joms.ajax({func:O,data:N,callback:function(o){var e,s,n;H.hide(),o.success&&(e=t(".joms-js--comment-"+L),s=e.find(".joms-js--comment-body"),n=t(".joms-js--newcomment-"+e.data("parent")),e.find(".joms-js--comment-editor").hide().find("textarea").val(o.originalComment||""),e.find(".joms-js--comment-content").html(o.comment||""),e.find(".joms-js--comment-actions").show(),s.show(),n.show(),(+A<0||+A>0)&&(s.children(".joms-js--comment-content").next("div").remove(),+A>0&&R&&s.children(".joms-js--comment-content").after(['<div style="padding:5px 0">','<a href="javascript:" onclick="joms.api.photoZoom(\'',R,"');\">",'<img class="joms-stream-thumb" src="',R,'">',"</a>","</div>"].join("")))),"function"==typeof U&&U(o);try{S.blur()}catch(o){}S.removeData("saving"),u&&u.siblings("svg").removeData("disabled").css("opacity","")}}))):(r=s,d=p,j=Y,f=function(){$.val(""),l(),b($)},w=m=n,k=!1,y=!1,x=!1,C=!1,M=!1,T=!1,(c=$).data("saving")||(c.data("saving",1),w&&((_=m.toLowerCase()).indexOf("album")>-1||_.indexOf("photo")>-1||(_.indexOf("video")>-1?k=!0:_.indexOf("discussion")>-1?y=!0:_.indexOf("inbox")>-1?x=!0:_.indexOf("wall")&&(C=!0))),(h=a)&&h.is(":visible")&&(M=h.find(".joms-textarea__attachment--thumbnail").find("img"),T=M.siblings("b"),M.is(":visible")?(M=M.data("photo_id"),T=""):T.is(":visible")&&(T=T.data("id"),M="")),M=M||"",T=T||"",w?v=k||y?[j,r,M]:x?[r,j,M,T]:C?[d,r,j,M]:[j,r,"",M]:(m="system,ajaxStreamAddComment",v=[r,j,M]),(g=t(c).siblings(".joms-textarea__loading")).show(),joms.ajax({func:m,data:v,callback:function(e){var s;if(g.hide(),e.success){if(x)return function(e){var s,n,p,i,a,u,c,r,m,d;for(s=t(".joms-js--inbox"),n=t(".joms-js--inbox-status"),p=t(".joms-js--inbox-reply"),i=p.find("textarea"),u=p.find(".joms-textarea__attachment"),e=t(t.trim(e)),c=o.location.href.split("#")[0],r=e.find("use"),d=0;d<r.length;d++)m=r.eq(d).attr("xlink:href").split("#")[1],m=c+"#"+m,r.eq(d).attr("xlink:href",m);s.append(e),i.length&&((a=i.data("joms-tagging"))?a.clear():i.val("")),u.length&&u.hide(),n.length&&n.html("<span>"+n.data("lang-notseen")+"</span>"),l()}(e.html),c.removeData("saving"),void(u&&u.siblings("svg").removeData("disabled").css("opacity",""));t(".joms-js--comments-"+r).append(e.html||""),(s=t(".joms-comment__counter--"+r)).html(+s.eq(0).text()+1),s.parents(".joms-comment__status").show()}"function"==typeof f&&f(e),c.removeData("saving"),u&&u.siblings("svg").removeData("disabled").css("opacity",""),e.error&&o.alert(e.error)}}))))}function b(o,t){"edit"!==t&&o.closest(".joms-comment__reply").find(".joms-textarea__attachment").hide(),(o=o[0]).joms_reset&&o.joms_reset(),o.joms_beautifier&&"none"!==o.joms_beautifier&&o.joms_beautifier.html(""),o.joms_hidden&&o.joms_hidden.val(o.value)}function h(e){var s=t(e.currentTarget),n=s.closest(".joms-js--comments"),p=n.data("type")||"",i=+n.data("id"),a=n.children(".joms-js--comment").length,u=o.joms_prev_comment_load;i&&joms.ajax({func:"system,ajaxStreamShowComments",data:[i,p,a,u],callback:function(e){var s,n,a,u,c;e.success&&(s=t(t.trim(e.html)),p&&(s=s.filter(".joms-js--comments").children()),(n=t(".joms-js--comments-"+i)).find(".joms-js--comment").remove(),n.append(s),e.total=+e.total,(a=Math.max(0,e.total-n.children(".joms-js--comment").length))>0?(u=n.find(".joms-js--more-comments a"),(c=u.data("lang")||o.joms_lang.COM_COMMUNITY_SHOW_PREVIOUS_COMMENTS+" (%d)")&&u.text(c.replace("%d",a))):n.find(".joms-js--more-comments").remove())}})}function _(e,n){if("function"!=typeof n&&(n=function(){}),s)return a=e&&e.find(".joms-textarea__attachment"),void n();joms.util.loadLib("plupload",function(){setTimeout(function(){var p;p=t('<div id="joms-js--attachment-uploader" aria-hidden="true" style="width:1px; height:1px; overflow:hidden">').appendTo(document.body),t('<button id="joms-js--attachment-uploader-button">').appendTo(p),(s=new o.plupload.Uploader({url:joms.BASE_URL+"index.php?option=com_community&view=photos&task=ajaxPreviewComment",container:"joms-js--attachment-uploader",browse_button:"joms-js--attachment-uploader-button",runtimes:"html5,html4",multi_selection:!1})).bind("FilesAdded",g),s.bind("BeforeUpload",w),s.bind("Error",k),s.bind("FileUploaded",y),s.init(),a=e&&e.find(".joms-textarea__attachment"),i=p.find("input[type=file]"),n()})})}function g(t){c=!1,o.setTimeout(function(){var o=a,e=o.find(".joms-textarea__attachment--loading"),s=o.find(".joms-textarea__attachment--thumbnail"),n=o.find("button");c||(t.start(),t.refresh(),s.find("img").replaceWith("<img>"),s.hide(),n.hide(),e.show(),o.show(),u.siblings("svg").data("disabled",1).css("opacity",.5))},0)}function w(o){var t,e="";for(t in p)e+="&"+t+"="+p[t];o.settings.url+=e}function k(t,e){c=!0,o.alert(e&&e.message||"Undefined error.")}function y(e,s,p){var i,u,c,r,m,l,d;try{i=JSON.parse(p.response)}catch(o){}return i||(i={}),u=a,i.error||i.msg?(o.alert(i.error||i.msg),void u.hide()):i.thumb_url&&i.photo_id||i.id?(c=u.find(".joms-textarea__attachment--loading"),r=u.find(".joms-textarea__attachment--thumbnail"),l=r.find("img"),m=u.find("button"),"file"===n?(d=t("<b>"+s.name+"</b>").data({id:i.id,path:i.path,name:s.name}),l.removeData("photo_id"),l.hide().siblings("b").remove(),l.after(d)):(l.siblings("b").remove(),l.attr("src",i.thumb_url),l.data("photo_id",i.photo_id).show()),c.hide(),r.show(),m.show(),void u.show()):(o.alert("Undefined error."),void u.hide())}function x(e,s){var n,p,i,a;s?(n=t(".joms-js--inbox-item-"+e),s=t(t.trim(s)),p=o.location.href.split("#")[0],i=s.find("use"),a=i.attr("xlink:href").split("#")[1],a=p+"#"+a,i.attr("xlink:href",a),n.replaceWith(s),l()):C(e)}function C(o){var e;(e=t(".joms-js--inbox-item-"+o)).fadeOut(500,function(){e.remove()})}return{start:function(){r(),(e=t(document.body)).on("keydown.joms-comment",".joms-comment__reply textarea",d),e.on("focus.joms-comment",".joms-comment__reply textarea",j),e.on("focus.joms-comment",".joms-js--pm-message textarea",j),e.on("click.joms-comment",".joms-comment__reply .joms-js--btn-send",f),e.on("click.joms-comment",".joms-js--inbox-reply .joms-js--btn-send",f),e.on("click.joms-comment",".joms-comment__more",h),_(),m(),l()},stop:r,like:function(e){joms.ajax({func:"system,ajaxStreamAddLike",data:[e,"comment"],callback:function(s){var n,p,i;s.success&&(n=t(".joms-js--comment-"+e)).length&&((p=n.find(".joms-comment__actions").find(".joms-button--liked")).attr("onclick","joms.api.commentUnlike('"+e+"');"),p.addClass("liked"),p.find("span").html(p.data("lang-unlike")),p.find("use").attr("xlink:href",o.location+"#joms-icon-thumbs-down"),i=n.find(".joms-comment__actions [data-action=showlike]"),s.html?i.length?i.replaceWith(s.html):p.after(s.html):i.remove())}})},unlike:function(e){joms.ajax({func:"system,ajaxStreamUnlike",data:[e,"comment"],callback:function(s){var n,p,i;s.success&&(n=t(".joms-js--comment-"+e)).length&&((p=n.find(".joms-comment__actions").find(".joms-button--liked")).attr("onclick","joms.api.commentLike('"+e+"');"),p.removeClass("liked"),p.find("span").html(p.data("lang-like")),p.find("use").attr("xlink:href",o.location+"#joms-icon-thumbs-up"),i=n.find(".joms-comment__actions [data-action=showlike]"),s.html?i.length?i.replaceWith(s.html):p.after(s.html):i.remove())}})},edit:function(o,e,s){var n,p,i,a="wall"===s;e=t(e),n=e.closest(".joms-comment__item"),i=n.children(".joms-comment__reply").find("textarea"),(p=a?n.closest(".joms-comment").siblings(".joms-comment__reply"):n.closest(".joms-stream").children(".joms-comment__reply")).hide(),n.children(".joms-comment__body,.joms-comment__actions").hide(),n.children(".joms-comment__reply").show(),i.jomsTagging(),i.off("reset.joms-tagging"),i.on("reset.joms-tagging",function(){n.children(".joms-comment__reply").hide(),n.children(".joms-comment__body,.joms-comment__actions").show(),p.show()}),i[0].focus()},cancel:function(o){var e,s,n;(e=o&&o.nodeType?t(o).closest(".joms-js--comment"):t(".joms-js--comment-"+o)).length&&(n=e.data(),s=t(".joms-js--newcomment-"+n.parent),e.find(".joms-js--comment-editor").hide(),e.find(".joms-js--comment-body").show(),e.find(".joms-js--comment-actions").show(),s.show())},remove:function(e,s){if(confirm(joms_lang.COM_COMMUNITY_ARE_YOU_SURE_YOU_WANT_TO_DELETE_THIS_COMMENT)){var n,p,i="inbox"===s,a="wall"===s;i?(n="inbox,ajaxRemoveMessage",p=[e]):a?(n=o.joms_wall_remove_func,p=[e]):(n="system,ajaxStreamRemoveComment",p=[e]),joms.ajax({func:n,data:p,callback:function(s){var n;if(s.success){if(i)C(e);else if((n=t(".joms-js--comment-"+e)).length){n.fadeOut(300,function(){t(this).remove()});var p=n.data("stream-id")||n.data("parent"),a=t(".joms-comment__counter--"+p);if(a.length){var u=+a.eq(0).text()-1;0===u&&(a.parents(".joms-comment__status").hide(),n.parents(".joms-popup").find(".joms-comment").html(joms_lang.COM_COMMUNITY_NO_COMMENTS_YET)),a.html(u)}}}else o.alert(s.error||"Undefined error.")}})}},removeTag:function(o,e){joms.ajax({func:"activities,ajaxRemoveUserTag",data:[o,e||"comment"],callback:function(s){var n,p,i,a,u;s.success&&("inbox"===e?(n=t(".joms-js--inbox-item-"+o),p=n.find(".joms-button--remove-tag"),(i=n.find(".joms-js--inbox-content")).html(s.data),p.remove()):(n=t(".joms-js--comment-"+o),p=n.find(".joms-button--remove-tag"),i=n.find(".joms-js--comment-content"),a=n.find(".joms-js--comment-editor"),u=a.find("textarea"),i.html(s.data),u.val(s.unparsed),p.remove()))}})},removePreview:function(e,s){var n,p,i="inbox"===s,a="wall"===s;i?(n="inbox,ajaxRemovePreview",p=[e]):a?(n="system,ajaxRemoveWallPreview",p=[e]):(n="system,ajaxRemoveCommentPreview",p=[e]),joms.ajax({func:n,data:p,callback:function(s){s.success?i?x(e,s.html):t(".joms-js--comment-"+e).find(".joms-js--comment-preview").remove():o.alert(s.error||"Undefined error.")}})},removeThumbnail:function(t,e){var s,n,p="inbox"===e;p&&(s="inbox,ajaxRemoveThumbnail",n=[t]),joms.ajax({func:s,data:n,callback:function(e){e.success?p&&x(t,e.html):o.alert(e.error||"Undefined error.")}})},addAttachment:function(e,a,c){var r,m,l;(e=t(e)).data("disabled")||(u=e,(e=e.siblings(".joms-textarea__wrapper")).length&&("file"!==a&&(a="image"),r=+(c=c||{}).max_file_size,m=c.exts,delete c.max_file_size,delete c.exts,n=a,p="file"===a?c:{},l={file:{url:joms.BASE_URL+"index.php?option=com_community&view=files&task=multiUpload",filters:{mime_types:[{title:"Document files",extensions:m}]},max_file_size:r>0?1048576*+r:0},image:{url:joms.BASE_URL+"index.php?option=com_community&view=photos&task=ajaxPreviewComment",filters:{mime_types:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}]},max_file_size:void 0}},_(e,function(){s.refresh(),s.settings.url=l[a].url,s.settings.filters=l[a].filters,s.settings.max_file_size=l[a].max_file_size,s.refresh(),o.joms_webdriver||i.click()})))},removeAttachment:function(o){(o=(o=t(o)).closest(".joms-textarea__attachment"))&&(o.find(".joms-textarea__attachment--thumbnail img").replaceWith('<img src="" alt="attachment">'),o.hide()),u&&u.siblings("svg").removeData("disabled").css("opacity","")},toggleText:function(o){var e=t(".joms-js--comment-text-"+o),s=t(".joms-js--comment-textfull-"+o),n=t(".joms-js--comment-texttoggle-"+o);s.is(":visible")?(s.hide(),e.show(),n.html(n.data("lang-more"))):(e.hide(),s.show(),n.html(n.data("lang-less")))},initInputbox:m}}(C,M),e("views/comment",["utils/video","functions/tagging"],function(){return joms.view.comment}),window,joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.remove=function(){var o,t,e;function s(){t.off(),o.close()}function n(){joms.ajax({func:"activities,ajaxDeleteActivity",data:["",e],callback:function(s){var n;t.off(),o.close(),s.success&&(n=joms.jQuery(".joms-stream").filter("[data-stream-id="+e+"]")).fadeOut(500,function(){n.remove()})}})}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"activities,ajaxConfirmDeleteActivity",data:["",e],callback:function(e){var p;o.items[0]={type:"inline",src:(p=e,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>","<div>",'<div class="joms-popup__content">',p.error||p.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',p.btnCancel,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',p.btnYes,"</button>","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click","[data-ui-object=popup-button-cancel]",s),t.on("click","[data-ui-object=popup-button-save]",n)}})})}}(),e("popups/stream.remove",["utils/popup"],function(){return joms.popup.stream.remove}),T=window,S=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.editLocation=function(o,t){var e,s,n;function p(p,u){s&&s.off(),e=p,n=u,joms.ajax({func:"activities,ajaxeditLocation",data:[n],callback:function(n){var p;e.items[0]={type:"inline",src:(p=n,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>","<div>",'<div class="joms-popup__content">',p.html||p.error,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',p.btnCancel,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',p.btnEdit,"</button>","</div>","</div>","</div>"].join(""))},e.updateItemHTML(),(s=e.contentContainer).on("click","[data-ui-object=popup-button-cancel]",i),s.on("click","[data-ui-object=popup-button-save]",a),_.defer(function(){var e;e=n,joms.util.map(function(){var n,p,i,a=s.find(".joms-js--location-map"),u=s.find(".joms-js--location-input"),c=s.find(".joms-js--location-loading"),r=s.find(".joms-js--location-selector");n=new o.google.maps.LatLng(e.latitude,e.longitude),p={center:n,zoom:14,mapTypeId:o.google.maps.MapTypeId.ROADMAD,mapTypeControl:!1,disableDefaultUI:!0,draggable:!1,scaleControl:!1,scrollwheel:!1,navigationControl:!1,streetViewControl:!1,disableDoubleClickZoom:!0},a=new o.google.maps.Map(a[0],p),(i=new o.google.maps.Marker({draggable:!1,map:a})).setPosition(n),a.panTo(n),u.on("input",function(){r.hide(),c.show(),m(this.value)});var m=_.debounce(function(o){(o=t.trim(o))&&joms.util.map.search(o).done(function(o){var t="";_.isArray(o)&&_.each(o,function(o){t+='<a class="joms-map--location-item" data-id="'+o.id+'""><strong>'+o.name+"</strong><br /><span>"+(o.description||"")+"</span></a>"}),c.hide(),r.html(t),r.show()})},1e3);u.val(e.location),m(e.location),r.on("click",".joms-map--location-item",function(){var o=t(this),e=o.data(),s=o.find("strong").text();u.data("name",s),joms.util.map.detail(e.id).done(function(o){var t=o.geometry,e=t.location,s=t.viewport;u.data("lat",e.lat()),u.data("lng",e.lng()),a.setCenter(e),i.setPosition(e),s?a.fitBounds(s):a.setZoom(15)})})})})}})}function i(){s.off(),e.close()}function a(){var o=s.find(".joms-js--location-input"),p=o.data("name"),i=o.data("lat"),a=o.data("lng");joms.ajax({func:"activities,ajaxSaveLocation",data:[n,p,i,a],callback:function(o){s.off(),e.close(),o.success&&t(".joms-stream").filter("[data-stream-id="+n+"]").find(".joms-status-location a").html(p)}})}return function(o){joms.util.popup.prepare(function(t){p(t,o)})}}(T,S),e("popups/stream.editlocation",["utils/popup"],function(){return joms.popup.stream.editLocation}),L=window,joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.addFeatured=(O=L,function(o){joms.util.popup.prepare(function(t){!function(o,t){U&&U.off(),I=o,E=t;var e,s=O.joms_page;"profile"===s?(s="profile",e=O.joms_user_id):"groups"===s?(s="group",e=O.joms_group_id):"events"===s?(s="event",e=O.joms_event_id):(s="frontpage",e=0),joms.ajax({func:"system,ajaxFeatureStream",data:[s,e,E],callback:function(o){var t;o.success?O.location.reload():(I.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title||"&nbsp;","</div>",'<div class="joms-popup__content joms-popup__content--single">',t.error||t.message,"</div>","</div>"].join(""))},I.updateItemHTML())}})}(t,o)})}),e("popups/stream.addfeatured",["utils/popup"],function(){return joms.popup.stream.addFeatured}),A=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.removeFeatured=(R=A,function(o){joms.util.popup.prepare(function(t){!function(o,t){H&&H.off(),N=o,P=t;var e,s=R.joms_page;"profile"===s?(s="profile",e=R.joms_user_id):"groups"===s?(s="group",e=R.joms_group_id):"events"===s?(s="event",e=R.joms_event_id):(s="frontpage",e=0),joms.ajax({func:"system,ajaxUnfeatureStream",data:[s,e,P],callback:function(o){var t;o.success?R.location.reload():(N.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title||"&nbsp;","</div>",'<div class="joms-popup__content joms-popup__content--single">',t.error||t.message,"</div>","</div>"].join(""))},N.updateItemHTML())}})}(t,o)})}),e("popups/stream.removefeatured",["utils/popup"],function(){return joms.popup.stream.removeFeatured}),window,joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.removeLocation=function(){var o,t,e;function s(){t.off(),o.close()}function n(){joms.ajax({func:"activities,deleteLocation",data:[e],callback:function(s){t.off(),o.close(),s.success&&joms.jQuery(".joms-stream").filter("[data-stream-id="+e+"]").find(".joms-status-location").remove()}})}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"activities,ajaxRemoveLocation",callback:function(e){var p;o.items[0]={type:"inline",src:(p=e,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>","<div>",'<div class="joms-popup__content">',p.error||p.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',p.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',p.btnYes,"</button>","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click","[data-ui-object=popup-button-cancel]",s),t.on("click","[data-ui-object=popup-button-save]",n)}})})}}(),e("popups/stream.removelocation",["utils/popup"],function(){return joms.popup.stream.removeLocation}),window,joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.removeMood=function(){var o,t,e;function s(){t.off(),o.close()}function n(){joms.ajax({func:"activities,ajaxRemoveMood",data:[e],callback:function(s){t.off(),o.close(),s.success&&joms.jQuery(".joms-stream").filter("[data-stream-id="+e+"]").find("[data-type=stream-content]").find("span").eq(0).html(s.html)}})}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"activities,ajaxConfirmRemoveMood",callback:function(e){var p;o.items[0]={type:"inline",src:(p=e,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>","<div>",'<div class="joms-popup__content">',p.error||p.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',p.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',p.btnYes,"</button>","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click","[data-ui-object=popup-button-cancel]",s),t.on("click","[data-ui-object=popup-button-save]",n)}})})}}(),e("popups/stream.removemood",["utils/popup"],function(){return joms.popup.stream.removeMood}),window,joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.report=function(){var o,t,e;function s(o){t.find("textarea").val(o.target.value)}function n(){t.off(),o.close()}function p(){var o;(o=(o=t.find("textarea").val()).replace(/^\s+|\s+$/g,""))?(t.find(".joms-js--error").hide(),joms.ajax({func:"system,ajaxSendReport",data:["activities,reportActivities",window.location.href,o,e],callback:function(o){t.find(".joms-js--step1").hide(),t.find(".joms-js--step2").show().children().html(o.error||o.message)}})):t.find(".joms-js--error").show()}return function(i){joms.util.popup.prepare(function(a){var u,c;u=a,c=i,t&&t.off(),o=u,e=c,joms.ajax({func:"system,ajaxReport",data:[],callback:function(e){var i;o.items[0]={type:"inline",src:(i=e,i||(i={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',i.title,"</div>",'<div class="joms-js--step1',i.error?" joms-popup__hide":"",'">',i.html,'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',i.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',i.btnSend,"</button>","</div>","</div>",'<div class="joms-js--step2',i.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',i.error||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("change","select",s),t.on("click",".joms-js--button-cancel",n),t.on("click",".joms-js--button-save",p)}})})}}(),e("popups/stream.report",["utils/popup"],function(){return joms.popup.stream.report}),$=window,Y=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.selectPrivacy=function(o,t){var e,s,n;function p(t,p){s&&s.off(),n=p,(e=t).items[0]={type:"inline",src:function(){var t,e,s,n,p;if(t=[["public",10,o.joms_lang.COM_COMMUNITY_PRIVACY_PUBLIC,"earth"],["site_members",20,o.joms_lang.COM_COMMUNITY_PRIVACY_SITE_MEMBERS,"users"],["friends",30,o.joms_lang.COM_COMMUNITY_PRIVACY_FRIENDS,"user"],["me",40,o.joms_lang.COM_COMMUNITY_PRIVACY_ME,"lock"]],(e=o.joms_privacylist)&&e.length)for(p=t.length-1;p>=0;p--)e.indexOf(t[p][0])<0&&t.splice(p,1);for(s=(s=o.location.href).replace(/#.*$/,""),n="",p=0;p<t.length;p++)n+='<a href="javascript:" data-value="'+t[p][1]+'" data-classname="joms-icon-'+t[p][3]+'">',n+='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="'+s+"#joms-icon-"+t[p][3]+'"></use></svg> ',n+="<span>"+t[p][2]+"</span></a>";return['<div class="joms-popup joms-popup--whiteblock joms-popup--privacy">','<div><div class="joms-popup__content joms-popup__content--single">',n,"</div></div>","</div>"].join("")}()},e.updateItemHTML(),(s=e.contentContainer).on("click","a",i)}function i(p){var i=t(p.currentTarget),a=i.data("value"),u=i.data("classname");joms.ajax({func:"activities,ajaxUpdatePrivacyActivity",data:[n,a],callback:function(p){s.off(),e.close(),p.success&&t(".joms-stream").filter("[data-stream-id="+n+"]").find(".joms-stream__meta use").attr("xlink:href",o.location+"#"+u)}})}return function(o){joms.util.popup.prepare(function(t){p(t,o)})}}($,Y),e("popups/stream.selectprivacy",["utils/popup"],function(){return joms.popup.stream.selectPrivacy}),Q=window,F=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.share=function(o,t){var e,s,n;function p(t,p){s&&s.off(),e=t,n=p,joms.ajax({func:"activities,ajaxSharePopup",data:[n],callback:function(t){var n;e.items[0]={type:"inline",src:(n=t,n||(n={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',n.title,"</div>","<div>",'<div class="joms-popup__content joms-popup__content--single">',n.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',n.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',n.btnShare,"</button> &nbsp;",'<div style="display:inline-block; position:relative;">','<div class="joms-button--privacy" data-ui-object="joms-dropdown-button" data-name="share-privacy">','<svg class="joms-icon" viewBox="0 0 16 16"><use xlink:href="#joms-icon-earth"></use></svg>','<input type="hidden" data-ui-object="joms-dropdown-value" value="10">',"</div>",'<ul class="joms-dropdown joms-dropdown--privacy" data-name="share-privacy">','<li data-classname="joms-icon-earth" data-value="10" style="white-space:nowrap">','<svg class="joms-icon" viewBox="0 0 16 16"><use xlink:href="#joms-icon-earth"></use></svg>'," <span>",o.joms_lang.COM_COMMUNITY_PRIVACY_PUBLIC,"</span>","</li>",'<li data-classname="joms-icon-users" data-value="20" style="white-space:nowrap">','<svg class="joms-icon" viewBox="0 0 16 16"><use xlink:href="#joms-icon-users"></use></svg>'," <span>",o.joms_lang.COM_COMMUNITY_PRIVACY_SITE_MEMBERS,"</span>","</li>",'<li data-classname="joms-icon-user" data-value="30" style="white-space:nowrap">','<svg class="joms-icon" viewBox="0 0 16 16"><use xlink:href="#joms-icon-user"></use></svg>'," <span>",o.joms_lang.COM_COMMUNITY_PRIVACY_FRIENDS,"</span>","</li>",'<li data-classname="joms-icon-lock" data-value="40" style="white-space:nowrap">','<svg class="joms-icon" viewBox="0 0 16 16"><use xlink:href="#joms-icon-lock"></use></svg>'," <span>",o.joms_lang.COM_COMMUNITY_PRIVACY_ME,"</span>","</li>","</ul>","</div>","</div>","</div>","</div>"].join(""))},e.updateItemHTML(),u(),c(),(s=e.contentContainer).on("click",".joms-js--button-cancel",i),s.on("click",".joms-js--button-save",a)}})}function i(){s.off(),e.close()}function a(){var o={msg:s.find("textarea.joms-textarea").val(),privacy:s.find("[data-ui-object=joms-dropdown-value]").val()};joms.ajax({func:"activities,ajaxAddShare",data:[n,JSON.stringify(o)],callback:function(o){s.off(),e.close(),o.success&&(t(".joms-stream__container").prepend(o.html),u(),c())}})}function u(){var o=".joms-js--initialized",e=t(".joms-media--images").not(o);e.each(function(){var e=t(this),s=e.find("img"),n=0;s.each(function(){var p=t(this);t("<img>").load(function(){++n===s.length&&(e.siblings(".joms-media--loading").remove(),e.addClass(o.substr(1)),s.show(),joms.util.photos.arrange(e))}).attr("src",p.attr("src"))})})}function c(){var o=".joms-js--initialized",e=".joms-js--video",s=t(e).not(o).addClass(o.substr(1));s.length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),s.on("click.joms-video",e+"-play",function(){var o=t(this).closest(e);joms.util.video.play(o,o.data())}),joms.ios&&setTimeout(function(){s.find(e+"-play").click()},2e3))}return function(o){joms.util.popup.prepare(function(t){p(t,o)})}}(Q,F),e("popups/stream.share",["utils/loadlib","utils/popup"],function(){return joms.popup.stream.share}),B=window,D=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.showComments=function(o,t){var e,s,n;function p(p,i,a){var u;s&&s.off(),e=p,u=[i],(n=a)&&u.push(n),joms.ajax({func:"system,ajaxStreamShowComments",data:u,callback:function(s){var n,p;e.items[0]={type:"inline",src:(n=s,p=!0,n||(n={}),t(t.trim(n.html||"")).children().length&&(p=!1),['<div class="joms-popup joms-popup--whiteblock joms-popup--rounded joms-popup--80pc">','<button class="mfp-close joms-hide"></button>','<div class="joms-comment">',p?o.joms_lang.COM_COMMUNITY_NO_COMMENTS_YET:n.html,"</div>","</div>"].join(""))},e.updateItemHTML()}})}return function(o,t){joms.util.popup.prepare(function(e){p(e,o,t)})}}(B,D),e("popups/stream.showcomments",["utils/popup"],function(){return joms.popup.stream.showComments}),q=window,z=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.showLikes=function(o,t){var e,s,n,p;function i(i,a,u){s&&s.off(),e=i,n=a,p=u,joms.ajax({func:"system,ajaxStreamShowLikes",data:[n,p],callback:function(s){var n,p;e.items[0]={type:"inline",src:(n=s,p=!0,n||(n={}),t(t.trim(n.html||"")).children().length&&(p=!1),['<div class="joms-popup joms-popup--whiteblock joms-popup--rounded joms-popup--80pc">','<button class="mfp-close joms-hide"></button>','<div class="joms-comment">',p?o.joms_lang.COM_COMMUNITY_NO_LIKES_YET:n.html,"</div>","</div>"].join(""))},e.updateItemHTML()}})}return function(o,t){joms.util.popup.prepare(function(e){i(e,o,t)})}}(q,z),e("popups/stream.showlikes",["utils/popup"],function(){return joms.popup.stream.showLikes}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.stream||(joms.popup.stream={}),joms.popup.stream.showOthers=function(o){joms.util.popup.prepare(function(t){var e,s;e=t,s=o,V&&V.off(),G=e,W=s,joms.ajax({func:"activities,ajaxShowOthers",data:[W],callback:function(o){var t;G.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--rounded joms-popup--80pc">','<button class="mfp-close joms-hide"></button>','<div class="joms-comment">',t.html||"","</div>","</div>"].join(""))},G.updateItemHTML()}})})},e("popups/stream.showothers",["utils/popup"],function(){return joms.popup.stream.showOthers}),window,joms.popup||(joms.popup={}),joms.popup.stream=(K=joms.popup.stream||{},joms._.extend({},K)),e("popups/stream",["popups/stream.remove","popups/stream.editlocation","popups/stream.addfeatured","popups/stream.removefeatured","popups/stream.removelocation","popups/stream.removemood","popups/stream.report","popups/stream.selectprivacy","popups/stream.share","popups/stream.showcomments","popups/stream.showlikes","popups/stream.showothers"],function(){return joms.popup.stream}),window,joms.jQuery,joms.view||(joms.view={}),joms.view.customize=function(){function o(){}return{start:function(){},stop:o}}(),e("views/customize",["popups/stream"],function(){return joms.view.stream}),J=window,X=joms.jQuery,joms.view||(joms.view={}),joms.view.misc=(Z=J,oo=X,so=joms._.debounce(function(){"large"!==joms.screenSize()?eo.nextAll(".joms-main").length&&eo.insertAfter(to):eo.prevAll(".joms-main").length&&eo.insertBefore(to)},500),{start:function(){to=oo(".joms-main"),eo=oo(".joms-sidebar"),so(),oo(Z).on("resize",so)},fixSVG:joms._.debounce(function(){var o=Z.joms_current_url,t="joms-icon--svg-fixed";o&&oo(".joms-icon use").not("."+t).each(function(){var e=this.getAttribute("xlink:href")||"",s=e.replace(/^[^#]*#/,"#");e===o+s?t+=" joms-icon--svg-unmodified":this.setAttribute("xlink:href",o+s),this.setAttribute("class",t)})},200)}),e("views/misc",[],function(){return joms.view.misc}),no=window,po=joms.jQuery,joms.view||(joms.view={}),joms.view.stream=function(o,t){var e;function s(){e&&e.off()}return{start:function(){s(),e=t(".joms-stream__wrapper")},stop:s,like:function(s){var n=e.find(".joms-js--stream-"+s);+n.attr("do-like")||(n.attr("do-like",1),joms.ajax({func:"system,ajaxStreamAddLike",data:[s],callback:function(n){var p,i,a,u,c;n.success&&(p=e.find(".joms-js--stream-"+s)).length&&((i=p.find(".joms-stream__actions").find(".joms-button--liked")).attr("onclick","joms.api.streamUnlike('"+s+"');"),i.addClass("liked"),i.find("span").html(i.data("lang-unlike")),i.find("use").attr("xlink:href",o.location+"#joms-icon-thumbs-down"),a=p.find(".joms-stream__status"),n.html?a.length?a.html(n.html):(a=p.find(".joms-stream__actions"),(a=t("<div class=joms-stream__status />").insertAfter(a)).html(n.html)):a.remove(),(c=p.find(".joms-stream__status--mobile")).length&&((u=c.find(".joms-like__counter--"+s)).html(+u.eq(0).text()+1),c.find(".joms-like__status").show()),p.attr("do-like",0))}}))},unlike:function(s){var n=e.find(".joms-js--stream-"+s);+n.attr("do-like")||(n.attr("do-like",1),joms.ajax({func:"system,ajaxStreamUnlike",data:[s],callback:function(n){var p,i,a,u,c;if(n.success&&(p=e.find(".joms-js--stream-"+s)).length){if((i=p.find(".joms-stream__actions").find(".joms-button--liked")).attr("onclick","joms.api.streamLike('"+s+"');"),i.removeClass("liked"),i.find("span").html(i.data("lang-like")),i.find("use").attr("xlink:href",o.location+"#joms-icon-thumbs-up"),a=p.find(".joms-stream__status"),n.html?a.length?a.html(n.html):(a=p.find(".joms-stream__actions"),(a=t("<div class=joms-stream__status />").insertAfter(a)).html(n.html)):a.remove(),(c=p.find(".joms-stream__status--mobile")).length){var r=+(u=c.find(".joms-like__counter--"+s)).eq(0).text()-1;u.html(r),0===r&&c.find(".joms-like__status").hide()}p.attr("do-like",0)}}}))},edit:function(o){var e=t(".joms-js--stream-"+o).eq(0).find(".joms-stream__body"),s=e.find("[data-type=stream-content]"),n=e.find("[data-type=stream-editor]"),p=n.find("textarea"),i=p.val();s.hide(),n.show(),p.removeData("joms-tagging"),p.jomsTagging(),p.off("reset.joms-tagging"),p.on("reset.joms-tagging",function(){n.hide(),s.show(),p.val(i)}),p.focus()},save:function(o,e){var s,n,p,i=t(e).closest(".joms-js--stream").find(".joms-stream__body").find("[data-type=stream-editor]").find("textarea"),a=i.val();i[0].joms_hidden&&(a=i[0].joms_hidden.val()),s=o,p=a,""!==(n=a).replace(/^\s+|\s+$/g,"")&&joms.ajax({func:"activities,ajaxSaveStatus",data:[s,n],callback:function(o){var e=t(".joms-stream").filter("[data-stream-id="+s+"]"),n=e.find(".joms-stream__body"),i=n.find("[data-type=stream-content]"),a=n.find("[data-type=stream-editor]"),u=a.find("textarea");o.success?(i.html("<span>"+o.data+"</span>"),u.val(o.unparsed)):u.val(p),a.hide(),i.show()}})},cancel:function(o){var e=t(".joms-js--stream-"+o).find(".joms-stream__body"),s=e.find("[data-type=stream-content]");e.find("[data-type=stream-editor]").hide(),s.show()},editLocation:function(o){joms.popup.stream.editLocation(o)},remove:function(o){joms.popup.stream.remove(o)},removeLocation:function(o){joms.popup.stream.removeLocation(o)},removeMood:function(o){joms.popup.stream.removeMood(o)},removeTag:function(o){joms.ajax({func:"activities,ajaxRemoveUserTag",data:[o,"post"],callback:function(e){var s,n,p,i,a,u;e.success&&(s=t(".joms-js--stream-"+o),n=s.find(".joms-stream__body"),p=s.find(".joms-list__options").find(".joms-dropdown").find(".joms-js--contextmenu-removetag"),i=n.find("[data-type=stream-content]"),a=n.find("[data-type=stream-editor]"),u=a.find("textarea"),i.html("<span>"+e.data+"</span>"),u.val(e.unparsed),p.remove())}})},selectPrivacy:function(o){joms.popup.stream.selectPrivacy(o)},share:function(o){joms.popup.stream.share(o)},hide:function(o,t){joms.ajax({func:"activities,ajaxHideStatus",data:[o,t],callback:function(t){var s;t.success&&(s=e.find(".joms-stream[data-stream-id="+o+"]")).fadeOut(500,function(){s.remove()})}})},ignoreUser:function(o){joms.popup.stream.ignoreUser(o)},showLikes:function(o,t){"popup"!==t?joms.ajax({func:"system,ajaxStreamShowLikes",data:[o],callback:function(t){t.success&&e.find(".joms-stream[data-stream-id="+o+"]").find(".joms-stream__status").html(t.html||"")}}):joms.popup.stream.showLikes(o,t)},showComments:function(o,t){joms.popup.stream.showComments(o,t)},showOthers:function(o){joms.popup.stream.showOthers(o)},report:function(o){joms.popup.stream.report(o)},toggleText:function(o){var e=t(".joms-js--stream-text-"+o),s=t(".joms-js--stream-textfull-"+o),n=t(".joms-js--stream-texttoggle-"+o);s.is(":visible")?(s.hide(),e.show(),n.html(n.data("lang-more"))):(e.hide(),s.show(),n.html(n.data("lang-less")))},addFeatured:function(o){joms.popup.stream.addFeatured(o)},removeFeatured:function(o){joms.popup.stream.removeFeatured(o)}}}(no,po),e("views/stream",["popups/stream"],function(){return joms.view.stream}),io=window,ao=joms.jQuery,joms.util||(joms.util={}),joms.util.photos=function(o,t){var e=[],s=180;function n(o,t){var e=0,n=t.length;t.each(function(p){var i,a,u,c;for(i=0,c=e;c<=p;c++)a=t.eq(c).data(),i+=a.width/a.height;if((u=o/i)<=s){for(c=e;c<=p;c++)t.eq(c).find("img").css({height:u});e=p+1}else if(c===n)for(c=e;c<=n;c++)t.eq(c).nextAll().andSelf().css({height:s}).find("img").css({height:u})}),t.css("border","1px solid transparent"),setTimeout(function(){t.css("border","")})}return t(o).resize(joms._.debounce(function(){!function(){var o,t;for(o=0;o<e.length;o++)n((t=e[o]).width(),t.children())}()},500)),{arrange:function(o){var s=o.children(),p=o.width();s.css({display:"block",float:"left",margin:"1px 0",overflow:"hidden",padding:0,position:"relative"}).each(function(){var o=t(this);o.data({width:o.width(),height:o.height()})}),n(p,s),e.push(o)}}}(io,ao),e("utils/photos",function(){}),uo=window,co=joms.jQuery,joms.view||(joms.view={}),joms.view.streams=function(o,t){var e,s,n;function p(){e&&e.off()}function i(){var o=".joms-js--initialized",e=t(".joms-media--images").not(o);e.each(function(){var e=t(this),s=e.find("img"),n=0;s.each(function(){var p=t(this);t("<img>").load(function(){++n===s.length&&(e.siblings(".joms-media--loading").remove(),e.addClass(o.substr(1)),s.show(),joms.util.photos.arrange(e))}).attr("src",p.attr("src"))})})}function a(){var o=".joms-js--initialized",e=".joms-js--video",s=t(".joms-stream__body").find(e).not(o).addClass(o.substr(1));s.length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),s.on("click.joms-video",e+"-play",function(){var o=t(this).closest(e);joms.util.video.play(o,o.data())}),joms.ios&&setTimeout(function(){s.find(e+"-play").click()},1e3))}function u(){joms.fn.tagging.initInputbox()}function c(o){var s,n;return(s=e.find(".joms-stream").not(".joms-stream--adagency")).length?(n=[],s.each(function(){n.push(+t(this).data("stream-id"))}),n["last"===o?n.length-1:0]):0}function r(){var o=e.children(".joms-stream__container");return{filter:o.data("filter"),filterId:o.data("filterid"),filterValue:o.data("filter-value")}}function m(){var e,s,n=m;n.loading||((e=o.joms_newest_stream_id)?(s=r(),n.loading=!0,n.xhr&&n.xhr.abort(),n.xhr=joms.ajax({func:"activities,ajaxGetRecentActivitiesCount",data:[e,s.filter,s.filterId,s.filterValue],callback:function(e){var s,p=+e.count,i=+e.nextPingDelay,a=t(".joms-js--stream-latest");n.loading=!1,n.xhr=null,o.joms_postbox_posting||(p>0?((s=t('<a href="javascript:">'+e.html+"</a>")).on("click",l),a.html(s).show()):a.hide().empty()),i>0&&joms._.delay(m,i)}})):console.warn("Variable `window.joms_newest_stream_id` not found."))}function l(){var s,n,p=l;p.loading||(s=c())&&(n=r(),p.loading=!0,p.xhr&&p.xhr.abort(),p.xhr=joms.ajax({func:"activities,ajaxGetRecentActivities",data:[s,n.filter,n.filterId,n.filterValue],callback:function(s){var n,c=t(t.trim(s.html)).filter(".joms-stream__wrapper").find(".joms-stream"),r=t(".joms-js--stream-latest");if(s.newest_stream_id&&(o.joms_newest_stream_id=+s.newest_stream_id),p.loading=!1,c.length)for(n=c.length-1;n>=0;n--)t(".joms-js--stream-"+c.eq(n).data("stream-id")).length||e.find(".joms-stream__container").prepend(c.eq(n));r.hide(),u(),i(),a()}}))}var d=function(){var s,n,p,m,l;if(joms.mobile)return!1;t(".joms-stream__loadmore").find("a").hide(),n=t(o),p=t(document),m=Math.max(+o.joms_autoloadtrigger||0,20),l=0,s=function(){var o,d,j,v=n.scrollTop(),b=n.height();o=v<l?"up":"down",l=v,"down"===o&&(v+b<p.height()-m||s.loading||(s.loading=!0,e.find(".joms-stream__loadmore .loading").show(),(d=c("last"))&&(j=r(),joms.ajax({func:"activities,ajaxGetOlderActivities",data:[d,j.filter,j.filterId,j.filterValue],callback:function(o){var n,p=!1;e.find(".joms-stream__loadmore .loading").hide(),o.html&&((n=t(t.trim(o.html)).filter(".joms-stream__wrapper").find(".joms-stream")).length?e.find(".joms-stream__container").append(n):p=!0),u(),i(),a(),f(),p||(s.loading=!1)}}))))},n.on("scroll",s)};function j(o,t){var e;return e='<div data-stream-type="adagency" class="joms-stream joms-stream--adagency">',e+='<div class="joms-stream__header">',e+='<div class="joms-avatar--stream">',e+='<a href="'+t.on_click_url+'" target="_blank" onclick="window.open(\''+t.on_click_url+"'); return false;\">",e+='<img src="'+t.banner_avatar+'">',e+="</a>",e+="</div>",e+='<div class="joms-stream__meta">',e+='<a class="joms-stream__user" href="'+t.on_click_url+'" target="_blank" onclick="window.open(\''+t.on_click_url+"'); return false;\">"+t.banner_headline+"</a>",e+='<a href="'+t.on_click_url+'" target="_blank" onclick="window.open(\''+t.on_click_url+'\'); return false;"><span class="joms-stream__time"><small>'+(t.short_url_to_promote||t.url_to_promote)+"</small></span></a>",e+="</div>",e+="</div>",e+='<div class="joms-stream__body">',e+="<p>"+t.banner_text+"</p>",e+='<div class="joms-media--image">',e+='<a href="'+t.on_click_url+'" target="_blank" onclick="window.open(\''+t.on_click_url+"'); return false;\">",e+='<img src="'+t.banner_image_content+'">',e+="</a>",e+="</div>",e+="</div>",(+o.show_sponsored_stream_info||+o.show_create_ad_link)&&(e+='<div class="joms-stream__actions">',+o.show_sponsored_stream_info&&(e+='<span style="float:left">'+o.sponsored_stream_info_text+"</span>"),+o.show_create_ad_link&&(e+='<a href="'+o.create_ad_link+'" style="float:right">'+o.create_ad_link_text+"</a>"),e+='<div style="clear:both"></div>',e+="</div>"),e+="</div>"}function f(){var n,p,i,a,u,c,r;if(s&&s.config&&s.ads&&s.ads.length){if(n=s.ads,p=s.config,i=+p.display_stream_ads_after_value,a=+p.display_stream_ads_every_value,c=+p.display_stream_ads,u=0,!+o.joms_my_id)for(var m=n.length-1;m>=0;m--)+n[m].banner_access||n.splice(m,1);n.length&&(r={frontpage:"front_page_stream",profile:"profile_stream",groups:"group_stream",events:"event_stream"},(p.js_stream_ads_on||[]).indexOf(r[o.joms_page])<0||e.find(".joms-stream").not(".joms-stream--adagency").each(function(o){var e,s;if(c){if(!i)return!1;if(o===i-1)return e=t(this),(s=e.next()).length&&s.hasClass("joms-stream--adagency")||(e.after(j(p,n[u])),v(n[u])),!1}else{if(!a)return!1;(o+1)%a==0&&(e=t(this),(s=e.next()).length&&s.hasClass("joms-stream--adagency")||(e.after(j(p,n[u%n.length])),v(n[u%n.length])),u++)}}))}}function v(o){var t=[o.advertiser_id,o.campaign_id,o.banner_id,o.campaign_type].join("-");n||(n={}),n[t]||(n[t]=!0,joms.ajax({func:"system,ajaxAdagencyGetImpression",data:[o.advertiser_id,o.campaign_id,o.banner_id,o.campaign_type],callback:function(){}}))}return{start:function(){if(p(),(e=t(".joms-stream__wrapper")).length){u(),i(),a(),o.joms_singleactivity||o.joms_filter_keyword||(+o.joms_adagency&&joms.ajax({func:"system,ajaxGetAdagency",callback:function(o){(s=o||{}).ads&&s.ads.length&&(s.ads=joms._.shuffle(s.ads)),f()}}),+o.joms_infinitescroll&&d(),+o.joms_enable_refresh&&m());var n=document.getElementsByClassName("joms-activity-filter-action");n&&n.length&&o.FastClick.attach(n[0])}},stop:p,loadMore:function o(){var s,n,p,m,l=o;l.loading||(s=c("last"))&&(n=r(),l.loading=!0,p=e.find("#activity-more"),m=p.find(".loading"),(p=p.find(".joms-button--primary")).hide(),m.show(),joms.ajax({func:"activities,ajaxGetOlderActivities",data:[s,n.filter,n.filterId,n.filterValue],callback:function(o){var s,n=!1;l.loading=!1,m.hide(),o.html&&((s=t(t.trim(o.html)).filter(".joms-stream__wrapper").find(".joms-stream")).length?e.find(".joms-stream__container").append(s):n=!0),u(),i(),a(),f(),n||p.show()}}))}}}(uo,co),e("views/streams",["utils/hovercard","utils/photos","utils/video","functions/tagging"],function(){return joms.view.streams}),ro=window,mo=joms.jQuery,joms.view||(joms.view={}),joms.view.toolbar=function(o,t){var e,s,n,p,i,a;function u(o){var s=t(o.target).closest(".joms-trigger__menu--main, .joms-trigger__menu--user, .joms-menu, .joms-menu--user");s.length||(e.hasClass("show-menu")||e.hasClass("show-menu--user"))&&(o.preventDefault(),o.stopPropagation(),e.removeClass("show-menu"),e.removeClass("show-menu--user"))}function c(o){o.stopPropagation(),e.toggleClass("show-menu")}function r(o){o.stopPropagation(),e.toggleClass("show-menu--user")}function m(o){var e=t(o.currentTarget).closest("li");e.hasClass("show-submenu")?e.removeClass("show-submenu"):e.addClass("show-submenu").siblings().removeClass("show-submenu")}function l(){e&&(e.off("click.menu"),e.off("click.menu",".joms-js--has-dropdown"),e.off("mouseenter.menu",".joms-toolbar--desktop > ul > li > a.joms-js--has-dropdown"),e.off("mouseleave.menu",".joms-toolbar--desktop")),s&&s.off("click.menu"),n&&n.off("click.menu"),p&&p.off("click.submenu")}function d(o){var e=t(o.currentTarget),s=e.data("connection");joms.ajax({func:"friends,ajaxRejectRequest",data:[s],callback:function(o){(e=t(".joms-js__friend-request-"+s)).find(".joms-popover__actions").remove(),e.find(".joms-popover__content").html(o.error||o.message),f("friendrequest",-1)}})}function j(o){var e=t(o.currentTarget),s=e.data("connection");joms.ajax({func:"friends,ajaxApproveRequest",data:[s],callback:function(o){(e=t(".joms-js__friend-request-"+s)).find(".joms-popover__actions").remove(),e.find(".joms-popover__content").html(o.error||o.message),f("friendrequest",-1)}})}function f(o,e){var s;["general","friendrequest","pm"].indexOf(o)<0||(s=t(".joms-notifications__label--"+o),e=+s.eq(0).text()+e,s.html(e>0?e:""))}function v(){var e=+o.joms_my_id;e&&t(".joms-js--notiflabel-general").length&&joms.ajax({func:"activities,ajaxGetTotalNotifications",callback:function(o){var e,s,n,p,i;o||(o={}),e=o.newNotificationCount,s=o.newFriendInviteCount,n=o.newMessageCount,p=+o.nextPingDelay,void 0!==e&&(e=+e||"",t(".joms-js--notiflabel-general").html(e),i=(i=document.title).replace(/^\(\d+\)\s/,""),i=(e?"("+e+") ":"")+i,document.title=i),void 0!==s&&t(".joms-js--notiflabel-frequest").html(+s||""),void 0!==n&&t(".joms-js--notiflabel-inbox").html(+n||""),p>0&&joms._.delay(v,p)}})}return{start:function(){e||(e=t(".jomsocial-wrapper")),s||(s=t(".joms-trigger__menu--main")),n||(n=t(".joms-trigger__menu--user")),p||(p=t(".joms-menu__toggle")),l(),e.on("click.menu",u),e.on("click.menu",".joms-js--has-dropdown",function(e){e.preventDefault(),e.stopPropagation(),o.location=t(e.currentTarget).attr("href")}),e.on("mouseenter.menu",".joms-toolbar--desktop > ul > li > a.joms-js--has-dropdown",function(o){var e=t(o.currentTarget);e.siblings("ul.joms-dropdown").is(":visible")||(a=e.trigger("click.dropdown"))}),e.on("mouseleave.menu",".joms-toolbar--desktop",function(){a&&(a.trigger("collapse.dropdown"),a=void 0)}),s.on("click.menu",c),n.on("click.menu",r),p.on("click.submenu",m),v()},stop:l,notificationGeneral:function(){joms.ajax({func:"notification,ajaxGetNotification",data:[""],callback:function(o){o.html&&t(".joms-popover--toolbar-general").html(o.html)}})},notificationFriend:function(){joms.ajax({func:"notification,ajaxGetRequest",data:[""],callback:function(o){var e;o.html&&((e=t(".joms-popover--toolbar-friendrequest")).html(o.html),e.off("click",".joms-button__approve").on("click",".joms-button__approve",d),e.off("click",".joms-button__reject").on("click",".joms-button__reject",j))}})},notificationPm:function(){joms.ajax({func:"notification,ajaxGetInbox",data:[""],callback:function(o){o.html&&t(".joms-popover--toolbar-pm").html(o.html)}})},notificationCounter:f,search:function(o){var e,s,n,p=o;"string"!=typeof o&&(p=t(o).val()),(p=p||"").replace(/^\s+|\s+$/g,"")&&(i&&i.abort(),o=t(".joms-popover--toolbar-search"),e=o.find(".joms-js--field"),s=o.find(".joms-js--loading"),n=o.find(".joms-js--viewall"),o.find("li:not(.joms-js--noremove)").remove(),n.hide(),s.show(),i=joms.ajax({func:"search,ajaxSearch",data:[p],callback:function(t){var i,a,u,c,r;if(s.hide(),t.error)return i='<li class="joms-js--error">'+t.error+"</li>",void e.after(i);if(t.length){for(i="",c=Math.min(3,t.length),a=0;a<c;a++)i+='<li><div class="joms-popover__avatar"><div class="joms-avatar">',i+='<img src="'+t[a].thumb+'"></div></div>',i+='<div class="joms-popover__content">',i+='<h5><a href="'+t[a].url+'">'+t[a].name+"</a></h5>",i+="</div></li>";(u=n.find("form")).find("input").val(p),n.off("click","a").on("click","a",function(){u[0].submit()}),(r=n.find("a")).html(r.data("lang").replace("%1$s",t.length)),e.after(i),n.show(),o.show()}}}))}}}(ro,mo),e("views/toolbar",function(){}),window,lo=joms.jQuery,joms.fn||(joms.fn={}),joms.fn.announcement=(jo=lo,{edit:function(o,t){jo(".joms-js--announcement-view-"+o+"-"+t).hide(),jo(".joms-js--announcement-edit-"+o+"-"+t).show(),jo(".joms-subnav,.joms-subnav--desktop").hide(),jo(".joms-sidebar").hide(),jo(".joms-main").css({padding:0,width:"100%"})},editCancel:function(o,t){jo(".joms-js--announcement-edit-"+o+"-"+t).hide(),jo(".joms-js--announcement-view-"+o+"-"+t).show(),jo(".joms-subnav,.joms-subnav--desktop").css("display",""),jo(".joms-main").css({padding:"",width:""}),jo(".joms-sidebar").show()}}),e("functions/announcement",[],function(){return joms.fn.announcement}),window,joms.jQuery,joms.fn||(joms.fn={}),joms.fn.facebook={update:function(){joms.ajax({func:"connect,ajaxUpdate",data:[""],callback:function(o){console.log(o)}})}},e("functions/facebook",[],function(){return joms.fn.facebook}),window,fo=joms.jQuery,joms.fn||(joms.fn={}),joms.fn.notification=(vo=fo,bo=[],{updateCounter:function(o,t,e){var s;t=o+"-"+t,bo.indexOf(t)>=0||(s=vo(".joms-js--notiflabel-"+o),bo.indexOf(t)<0&&(bo.push(t),e=+s.eq(0).text()+e,s.html(e>0?e:"")))}}),e("functions/notification",[],function(){return joms.fn.notification}),window,ho=joms.jQuery,joms.fn||(joms.fn={}),joms.fn.invitation=function(o,t){function e(o,e,s){t(".joms-js--invitation-buttons-"+o+"-"+e).remove(),t(".joms-js--invitation-notice-"+o+"-"+e).html(s&&s.message||""),joms.fn.notification.updateCounter("general",e,-1)}return{accept:function(o,t){var s="group"===o?"notification,ajaxGroupJoinInvitation":"events,ajaxJoinInvitation",n=[t];joms.ajax({func:s,data:n,callback:function(s){e(o,t,s)}})},reject:function(o,t){var s="group"===o?"notification,ajaxGroupRejectInvitation":"events,ajaxRejectInvitation",n=[t];joms.ajax({func:s,data:n,callback:function(s){e(o,t,s)}})}}}(0,ho),e("functions/invitation",["functions/notification"],function(){return joms.fn.invitation}),_o=window,go=joms.jQuery,joms.util||(joms.util={}),joms.util.field=(wo=_o,ko=go,{file:function(o){(o=ko(o)).each(function(o,t){var e;t=ko(t),(e=t.parent()).data("wrap")||(e=ko(['<div data-wrap="file" style="width:350px;max-width:100%;position:relative;overflow:hidden">','<input type="text" class="joms-input" readonly="readonly" placeholder="',wo.joms_lang&&wo.joms_lang.COM_COMMUNITY_SELECT_FILE||"Select file",'.."','style="margin-bottom:2px">',"</div>"].join("")),t.before(e),t.hide(),t.appendTo(e),t.css({cursor:"pointer",position:"absolute",right:0,top:0,width:"100%",height:"100%",opacity:0}),t.show()),t.off("change.joms-file"),t.on("change.joms-file",function(){var o,t;e.find(".joms-input").val((o=ko(this).val(),(t=o.match(/[^\\\/]+$/))&&t[0]?t[0]:""))})})}}),e("utils/field",function(){}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.info=function(){function o(o,t,e){var s,n;o.items[0]={type:"inline",src:(s=t,n=e,['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s||"&nbsp;","</div>",'<div class="joms-popup__content joms-popup__content--single">',n||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',window.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},o.updateItemHTML()}return function(t,e){joms.util.popup.prepare(function(s){o(s,t,e)})}}(),e("popups/info",["utils/popup"],function(){return joms.popup.info}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.login=function(){var o,t;function e(e,n){var p;t&&t.off(),(o=e).items[0]={type:"inline",src:(p=n,p||(p={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',p.html||"","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).find("form").on("submit",s)}function s(o){o.preventDefault(),o.stopPropagation(),joms.ajax({func:"system,ajaxGetLoginFormToken",data:[],callback:function(o){var e=t.find("form");o.token&&e.find(".joms-js--token input").prop("name",o.token),e.off("submit"),e.find("[name=submit]").click()}})}return function(o){joms.util.popup.prepare(function(t){!function(o,t){if(t&&"object"==typeof t)e(o,t);else{var s=t;"string"!=typeof t&&(s=(s=window.location.href).replace(/#.*$/,"")),joms.ajax({func:"system,ajaxLogin",data:[s],callback:function(t){e(o,t)}})}}(t,o)})}}(),e("popups/login",["utils/popup"],function(){return joms.popup.login}),yo=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.album||(joms.popup.album={}),joms.popup.album.addFeatured=function(o){var t,e,s;function n(n,p){e&&e.off(),t=n,s=p,joms.ajax({func:"photos,ajaxAddFeatured",data:[s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()},t.updateItemHTML()}})}return function(o){joms.util.popup.prepare(function(t){n(t,o)})}}(yo),e("popups/album.addfeatured",["utils/popup"],function(){return joms.popup.album.addFeatured}),xo=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.album||(joms.popup.album={}),joms.popup.album.removeFeatured=function(o){var t,e,s;function n(n,p){e&&e.off(),t=n,s=p,joms.ajax({func:"photos,ajaxRemoveFeatured",data:[s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()},t.updateItemHTML()}})}return function(o){joms.util.popup.prepare(function(t){n(t,o)})}}(xo),e("popups/album.removefeatured",["utils/popup"],function(){return joms.popup.album.removeFeatured}),window,joms.popup||(joms.popup={}),joms.popup.album||(joms.popup.album={}),joms.popup.album.remove=function(){var o,t,e;function s(){t.off(),o.close()}function n(){t.find("form").submit()}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"photos,ajaxRemoveAlbum",data:[e,"myphotos"],callback:function(e){var p;o.items[0]={type:"inline",src:(p=e,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div data-ui-object="popup-step-1"',p.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">',p.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',p.btnCancel,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',p.btnYes,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',p.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',p.error||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click","[data-ui-object=popup-button-cancel]",s),t.on("click","[data-ui-object=popup-button-save]",n)}})})}}(),e("popups/album.remove",["utils/popup"],function(){return joms.popup.album.remove}),window,joms.popup||(joms.popup={}),joms.popup.album=(Co=joms.popup.album||{},joms._.extend({},Co)),e("popups/album",["popups/album.addfeatured","popups/album.removefeatured","popups/album.remove"],function(){return joms.popup.album}),window,joms.popup||(joms.popup={}),joms.popup.announcement||(joms.popup.announcement={}),joms.popup.announcement.remove=function(){var o,t,e,s;function n(){t.off(),o.close()}function p(){t.find("form")[0].submit()}return function(i,a){joms.util.popup.prepare(function(u){var c,r,m;c=u,r=i,m=a,t&&t.off(),o=c,e=r,s=m,joms.ajax({func:"groups,ajaxShowRemoveBulletin",data:[e,s],callback:function(e){var s;o.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',s.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',s.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',s.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",n),t.on("click",".joms-js--button-save",p)}})})}}(),e("popups/announcement.remove",["utils/popup"],function(){return joms.popup.announcement.remove}),window,joms.popup||(joms.popup={}),joms.popup.announcement=(Mo=joms.popup.announcement||{},joms._.extend({},Mo)),e("popups/announcement",["popups/announcement.remove"],function(){return joms.popup.announcement}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.app||(joms.popup.app={}),joms.popup.app.about=function(){var o,t,e;function s(s,n){t&&t.off(),o=s,e=n,joms.ajax({func:"apps,ajaxShowAbout",data:[e],callback:function(t){var e;o.items[0]={type:"inline",src:(e=t,e||(e={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',e.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',e.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',window.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},o.updateItemHTML()}})}return function(o){joms.util.popup.prepare(function(t){s(t,o)})}}(),e("popups/app.about",["utils/popup"],function(){return joms.popup.app.about}),To=window,So=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.app||(joms.popup.app={}),joms.popup.app.browse=function(o,t){var e,s,n;function p(o){var p=t(o.target),i=p.data("appname"),u=p.data("position"),c=u.indexOf("-stacked")>=0;joms.ajax({func:"apps,ajaxAddApp",data:[i,u],callback:function(o){var p,u,r,m,l;o.success&&(p=t(".joms-js--app-pos-"+n),r=p.find(".joms-tab__bar").eq(0),c?r.before(t(o.item).show()):((u=r.find(".joms-js--app-new")).prevAll().removeClass("active"),u.before('<a href="#joms-js--app-app_id" class="no-padding joms-js--app-tab-app_id active"><div class="joms-tab__bar--button"><span class="title">app_title</span></div></a>'.replace(/app_id/g,o.id).replace(/app_title/,o.title)),p.find(".joms-tab__content").hide(),p.append(t(o.item).show())),m=o.id,l=i,joms.ajax({func:"apps,ajaxShowSettings",data:[m,l],callback:function(o){s.off("click","a[data-appname]"),s.html(a(o,"setting")),s.on("click",".joms-popup__content,.joms-popup__action",function(o){return o.stopPropagation(),!1}),s.on("click","[data-ui-object=popup-button-save]",function(){!function(){var o,t=s.find("form").serializeArray(),n=[];for(o=0;o<t.length;o++)n.push([t[o].name,t[o].value]);joms.ajax({func:"apps,ajaxSaveSettings",data:[n],callback:function(o){if(o.error)return s.find(".joms-popup__content").html(o.error),void s.find(".joms-popup__action").remove();e.close()}})}()})}}))}})}function i(){var o=s.find(".joms-popup__content").eq(0),t=o.innerHeight();o.css({height:t,overflow:"auto"}),s.find(".joms-js--btn-view-all").parent().remove(),s.find(".joms-js--app").show(),o.animate({scrollTop:o[0].scrollHeight})}function a(t,e){var s="";return t||(t={}),s="setting"===e&&t.btnSave?['<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close joms-left">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',t.btnSave,"</button>","</div>"].join(""):['<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>"].join(""),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.html||"","</div>",s,"</div>"].join("")}return function(o){joms.util.popup.prepare(function(t){var u,c;u=t,c=o,s&&s.off(),e=u,n=c,joms.ajax({func:"apps,ajaxBrowse",data:[n],callback:function(o){e.items[0]={type:"inline",src:a(o)},e.updateItemHTML(),(s=e.contentContainer).on("click","a[data-appname]",p),s.on("click",".joms-js--btn-view-all",i)}})})}}(To,So),e("popups/app.browse",["utils/popup"],function(){return joms.popup.app.browse}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.app||(joms.popup.app={}),joms.popup.app.privacy=function(){var o,t,e;function s(){var s=t.find("input[type=radio]:checked"),n=s.val();joms.ajax({func:"apps,ajaxSavePrivacy",data:[e,n],callback:function(e){if(e.error)return t.find(".joms-popup__content").html(e.error),void t.find(".joms-popup__action").remove();o.close()}})}return function(n){joms.util.popup.prepare(function(p){var i,a;i=p,a=n,t&&t.off(),o=i,e=a,joms.ajax({func:"apps,ajaxShowPrivacy",data:[e],callback:function(e){var n;o.items[0]={type:"inline",src:(n=e,n||(n={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',n.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',n.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',n.btnSave,"</button>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click","[data-ui-object=popup-button-save]",s)}})})}}(),e("popups/app.privacy",["utils/popup"],function(){return joms.popup.app.privacy}),Lo=window,Oo=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.app||(joms.popup.app={}),joms.popup.app.remove=function(o,t){var e,s,n;function p(p,i){s&&s.off(),e=p,n=i,joms.ajax({func:"apps,ajaxRemove",data:[n],callback:function(s){var p,i,a,u;e.items[0]={type:"inline",src:(u=s,u||(u={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',u.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',u.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},e.updateItemHTML(),p=t(".joms-js--app-tab-"+n),a=t("#joms-js--app-"+n),(i=p.prev()).length||(i=p.next().not(".joms-js--app-new")),p.remove(),a.remove(),i.length&&i.click()}})}return function(o){joms.util.popup.prepare(function(t){p(t,o)})}}(Lo,Oo),e("popups/app.remove",["utils/popup"],function(){return joms.popup.app.remove}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.app||(joms.popup.app={}),joms.popup.app.setting=function(){var o,t,e,s;function n(n,i,a){t&&t.off(),o=n,e=i,s=a,joms.ajax({func:"apps,ajaxShowSettings",data:[e,s],callback:function(e){var s,n;o.items[0]={type:"inline",src:(s=e,n="",s||(s={}),s.btnSave&&(n=['<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close joms-left">',window.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',s.btnSave,"</button>","</div>"].join("")),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content joms-popup__content--single" style="max-height:315px; overflow:auto">',s.html||"","</div>",n,"</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click","[data-ui-object=popup-button-save]",p)}})}function p(){var e,s=t.find("form"),n=s.serializeArray(),p=[];for(e=0;e<n.length;e++)p.push([n[e].name,n[e].value]);joms.ajax({func:"apps,ajaxSaveSettings",data:[p],callback:function(e){if(e.error)return t.find(".joms-popup__content").html(e.error),void t.find(".joms-popup__action").remove();o.close()}})}return function(o,t){joms.util.popup.prepare(function(e){n(e,o,t)})}}(),e("popups/app.setting",["utils/popup"],function(){return joms.popup.app.setting}),window,joms.popup||(joms.popup={}),joms.popup.app=(Io=joms.popup.app||{},joms._.extend({},Io)),e("popups/app",["popups/app.about","popups/app.browse","popups/app.privacy","popups/app.remove","popups/app.setting"],function(){return joms.popup.app}),Uo=window,Eo=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.avatar||(joms.popup.avatar={}),joms.popup.avatar.change=function(o,t){var e,s,n,p,i,a,u,c;function r(t,i,a){s&&s.off(),e=t,n=i,p=a,joms.ajax({func:"photos,ajaxUploadAvatar",data:[n,p],callback:function(t){var n;e.items[0]={type:"inline",src:(n=t,n||(n={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',n.title,"</div>",n.html||"",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},e.updateItemHTML(),(s=e.contentContainer).on("click",".joms-js--button-upload",f),s.on("click",".joms-js--button-save",m),s.on("click",".joms-js--button-rotate-left",l),s.on("click",".joms-js--button-rotate-right",d),v()}})}function m(){var t=joms.util.crop.getSelection();joms.ajax({func:"photos,ajaxUpdateThumbnail",data:[n,p,t.x,t.y,t.width,t.height],callback:function(t){t.success&&o.location.reload(!0)}})}function l(){joms.api.avatarRotate(n,p,"left",function(){j()})}function d(){joms.api.avatarRotate(n,p,"right",function(){j()})}function j(){var o=t(".joms-avatar__cropper"),e=o.find("img"),s=e.attr("src");s=(s=s.replace(/\?.*$/,""))+"?_="+(new Date).getTime(),joms.util.crop.detach(),e.removeAttr("src"),e.attr("src",s),setTimeout(function(){joms.util.crop(e)},100)}function f(){v(function(){u.click()})}function v(e){"function"!=typeof e&&(e=function(){}),i?e():joms.util.loadLib("plupload",function(){var n;n=s.find("form").attr("action"),a=t('<div id="joms-js--avatar-uploader" aria-hidden="true" style="width:1px; height:1px; position:absolute; overflow:hidden;">').appendTo(document.body),u=t('<div id="joms-js--avatar-uploader-button">').appendTo(a),(i=new o.plupload.Uploader({url:n,filters:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}],container:"joms-js--avatar-uploader",browse_button:"joms-js--avatar-uploader-button",runtimes:"html5,html4",multi_selection:!1,file_data_name:"filedata"})).bind("FilesAdded",b),i.bind("Error",h),i.bind("UploadProgress",_),i.bind("FileUploaded",g),i.bind("UploadComplete",w),i.init(),u=a.find("input[type=file]"),e()})}function b(t){o.setTimeout(function(){s.find(".joms-progressbar__progress").css({width:0}),t.refresh(),t.start()},0)}function h(){}function _(o,t){var e;e=Math.min(100,Math.floor(t.loaded/t.size*100)),s.find(".joms-progressbar__progress").stop().animate({width:e+"%"})}function g(o,e,s){var n,p={};try{p=JSON.parse(s.response)}catch(o){}c=p,p.msg&&!p.error&&((n=t(".joms-avatar__cropper")).find("img").attr("src",p.msg),n.show(),setTimeout(function(){var o=n.find("img");joms.util.crop.detach(),joms.util.crop(o)},100))}function w(){c.error?(s.find(".joms-js--avatar-uploader-error").html(c.msg).show(),s.find(".joms-progressbar__progress").stop().animate({width:"0%"})):s.find(".joms-js--avatar-uploader-error").hide()}return function(o,t){joms.util.popup.prepare(function(e){r(e,o,t)})}}(Uo,Eo),e("popups/avatar.change",["utils/crop","utils/loadlib","utils/popup"],function(){return joms.popup.avatar.change}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.avatar||(joms.popup.avatar={}),joms.popup.avatar.remove=function(){var o,t,e;function s(s,i,a){t&&t.off(),o=s,e=a,joms.ajax({func:"profile,ajaxRemovePicture",data:[e],callback:function(s){var i;o.items[0]={type:"inline",src:(i=s,i||(i={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',i.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',i.html||"","</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',i.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',i.btnYes,"</button>",'<div class="joms-popup__hide">','<form method="POST" action="',i.redirUrl,'"><input type="hidden" name="userid" value="',e,'"></form>',"</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click","[data-ui-object=popup-button-cancel]",n),t.on("click","[data-ui-object=popup-button-save]",p)}})}function n(){t.off(),o.close()}function p(){t.find("form").submit()}return function(o,t){joms.util.popup.prepare(function(o){s(o,0,t)})}}(),e("popups/avatar.remove",["utils/popup"],function(){return joms.popup.avatar.remove}),Ao=window,Ro=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.avatar||(joms.popup.avatar={}),joms.popup.avatar.rotate=(No=Ao,Ho=Ro,function(o,t,e,s){var n,p,i,a;n=o,p=t,i=e,a=s,joms.ajax({func:"profile,ajaxRotateAvatar",data:[n,p,i],callback:function(o){o.error?No.alert(o.error):o.success&&(Ho(".joms-js--avatar-"+p).attr("src",o.avatar+"?_="+(new Date).getTime()),"function"==typeof a&&a(o))}})}),e("popups/avatar.rotate",[],function(){return joms.popup.avatar.rotate}),window,joms.popup||(joms.popup={}),joms.popup.avatar=(Po=joms.popup.avatar||{},joms._.extend({},Po)),e("popups/avatar",["popups/avatar.change","popups/avatar.remove","popups/avatar.rotate"],function(){return joms.popup.avatar}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.comment||(joms.popup.comment={}),joms.popup.comment.showLikes=function(o){joms.util.popup.prepare(function(t){var e,s;e=t,s=o,Yo&&Yo.off(),$o=e,Qo=s,joms.ajax({func:"activities,ajaxshowLikedUser",data:[Qo],callback:function(o){var t;$o.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--rounded joms-popup--80pc">','<button class="mfp-close joms-hide"></button>','<div class="joms-comment">',t.html||"","</div>","</div>"].join(""))},$o.updateItemHTML()}})})},e("popups/comment.showlikes",["utils/popup"],function(){return joms.popup.comment.showLikes}),window,joms.popup||(joms.popup={}),joms.popup.comment=(Fo=joms.popup.comment||{},joms._.extend({},Fo)),e("popups/comment",["popups/comment.showlikes"],function(){return joms.popup.comment}),Bo=window,Do=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.cover||(joms.popup.cover={}),joms.popup.cover.change=function(o,t){var e,s,n,p,i,a,u,c;function r(t,i,a){s&&s.off(),e=t,n=i,p=a,joms.ajax({func:"photos,ajaxChangeCover",data:[n,p],callback:function(t){var n;e.items[0]={type:"inline",src:(n=t,n||(n={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',n.title,"</div>",n.html||"",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},e.updateItemHTML(),(s=e.contentContainer).on("click",".joms-js--album",m),s.on("click",".joms-js--back-to-album",l),s.on("click",".joms-js--select-photo",d),s.on("click","[data-ui-object=popup-button-upload]",j),f()}})}function m(){var o=t(this),e=o.data("album"),s=o.data("total");joms.ajax({func:"photos,ajaxGetPhotoList",data:[e,s],callback:function(o){o&&o.html&&(t(".joms-js--album-list").hide(),t(".joms-js--photo-list").html(o.html).show())}})}function l(){t(".joms-js--photo-list").hide(),t(".joms-js--album-list").show()}function d(){var o=t(this),s=o.data("photo");joms.ajax({func:"photos,ajaxSetPhotoCover",data:[n,s,p],callback:function(o){o&&o.path&&(t(".joms-js--cover-image > img").attr("src",o.path).css({top:0}),t(".joms-js--cover-image-mobile").css({background:"url("+o.path+") no-repeat center center"}),e.close(),t(".joms-js--menu-reposition").show())}})}function j(){f(function(){u.click()})}function f(e){"function"!=typeof e&&(e=function(){}),i?e():joms.util.loadLib("plupload",function(){var n;n=s.find("form").attr("action"),a=t('<div id="joms-js--cover-uploader" aria-hidden="true" style="width:1px; height:1px; position:absolute; overflow:hidden;">').appendTo(document.body),u=t('<div id="joms-js--cover-uploader-button">').appendTo(a),(i=new o.plupload.Uploader({url:n,filters:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}],container:"joms-js--cover-uploader",browse_button:"joms-js--cover-uploader-button",runtimes:"html5,html4",multi_selection:!1,file_data_name:"uploadCover"})).bind("FilesAdded",v),i.bind("UploadProgress",b),i.bind("Error",function(){}),i.bind("FileUploaded",h),i.bind("UploadComplete",_),i.init(),u=a.find("input[type=file]"),e()})}function v(t){o.setTimeout(function(){t.refresh(),t.start()},0)}function b(o,t){var e;e=Math.min(100,Math.floor(t.loaded/t.size*100)),s.find(".joms-progressbar__progress").stop().animate({width:e+"%"})}function h(o,s,n){var p={};try{p=JSON.parse(n.response)}catch(o){}c=p,p.path&&(t(".joms-js--cover-image > img").attr("src",p.path).css({top:0}),t(".joms-js--cover-image-mobile").css({background:"url("+p.path+") no-repeat center center"}),e.close(),t(".joms-js--menu-reposition").show())}function _(){c.error?(s.find(".joms-js--cover-uploader-error").html(c.error).show(),s.find(".joms-progressbar__progress").stop().animate({width:"0%"})):s.find(".joms-js--cover-uploader-error").hide()}return function(o,t){joms.util.popup.prepare(function(e){r(e,o,t)})}}(Bo,Do),e("popups/cover.change",["utils/loadlib","utils/popup"],function(){return joms.popup.cover.change}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.cover||(joms.popup.cover={}),joms.popup.cover.remove=function(){var o,t,e,s;function n(n,a,u){var c,r;t&&t.off(),o=n,c="profile,ajaxRemoveCover",r=[s=u],"group"!==(e=a)&&"event"!==e||(c="photos,ajaxRemoveCover",r=[e,s]),joms.ajax({func:c,data:r,callback:function(n){var a;o.items[0]={type:"inline",src:(a=n,a||(a={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',a.title,"</div>",'<div class="joms-js--step1',a.error?" joms-popup__hide":"",'">','<div class="joms-popup__content joms-popup__content--single">',a.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',a.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',a.btnYes,"</button>",'<div class="joms-popup__hide">','<form method="POST" action="',a.redirUrl,'">',"group"===e||"event"===e?'<input type="hidden" name="type" value="'+e+'">':"","group"===e||"event"===e?'<input type="hidden" name="id" value="'+s+'">':"","group"===e||"event"===e?"":'<input type="hidden" name="userid" value="'+s+'">',"</form>","</div>","</div>","</div>",'<div class="joms-js--step2',a.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',a.error||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",p),t.on("click",".joms-js--button-save",i)}})}function p(){t.off(),o.close()}function i(){var o=t.find("form");o.data("saving")||(o.data("saving",1),o.submit())}return function(o,t){joms.util.popup.prepare(function(e){n(e,o,t)})}}(),e("popups/cover.remove",["utils/popup"],function(){return joms.popup.cover.remove}),window,joms.popup||(joms.popup={}),joms.popup.cover=(qo=joms.popup.cover||{},joms._.extend({},qo)),e("popups/cover",["popups/cover.change","popups/cover.remove"],function(){return joms.popup.cover}),window,joms.popup||(joms.popup={}),joms.popup.discussion||(joms.popup.discussion={}),joms.popup.discussion.lock=function(){var o,t,e,s;function n(){t.off(),o.close()}function p(){t.find("form")[0].submit()}return function(i,a){joms.util.popup.prepare(function(u){var c,r,m;c=u,r=i,m=a,t&&t.off(),o=c,e=r,s=m,joms.ajax({func:"groups,ajaxShowLockDiscussion",data:[e,s],callback:function(e){var s;o.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',s.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',s.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',s.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",n),t.on("click",".joms-js--button-save",p)}})})}}(),e("popups/discussion.lock",["utils/popup"],function(){return joms.popup.discussion.lock}),window,joms.popup||(joms.popup={}),joms.popup.discussion||(joms.popup.discussion={}),joms.popup.discussion.remove=function(){var o,t,e,s;function n(){t.off(),o.close()}function p(){t.find("form")[0].submit()}return function(i,a){joms.util.popup.prepare(function(u){var c,r,m;c=u,r=i,m=a,t&&t.off(),o=c,e=r,s=m,joms.ajax({func:"groups,ajaxShowRemoveDiscussion",data:[e,s],callback:function(e){var s;o.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',s.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',s.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',s.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",n),t.on("click",".joms-js--button-save",p)}})})}}(),e("popups/discussion.remove",["utils/popup"],function(){return joms.popup.discussion.remove}),window,joms.popup||(joms.popup={}),joms.popup.discussion=(zo=joms.popup.discussion||{},joms._.extend({},zo)),e("popups/discussion",["popups/discussion.lock","popups/discussion.remove"],function(){return joms.popup.discussion}),window,joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.delete=function(){var o,t,e;function s(){t.off(),o.close()}function n(o,s,p){var i,a;s?i=[e,s,p]:(i=[e,1],a=t.find("[name=recurring]:checked"),i.push(a&&a.length?a.val():"")),joms.ajax({func:"events,ajaxDeleteEvent",data:i,callback:function(o){var e;t.find(".joms-js--step1").hide(),t.find(".joms-js--step2").show().children().first().append("<div>"+(o.error||o.message)+"</div>"),o.next?n(0,o.next,i[2]):o.redirect&&((e=t.find(".joms-js--step2")).find(".joms-js--button-done").html(o.btnDone).on("click",function(){window.location=o.redirect}),e.find(".joms-popup__action").show(),e.find(".joms-popup__content").removeClass("joms-popup__content--single"))}})}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"events,ajaxWarnEventDeletion",data:[e],callback:function(e){o.items[0]={type:"inline",src:function(o){var t,e,s;if(o||(o={}),t="",o.radios&&o.radios.length){for(t='<div><form style="margin:5px;padding:0">',s=0;s<o.radios.length;s++)e=o.radios[s],t+='<div><label> <input type="radio" name="recurring" value="'+e[0]+'"'+(e[2]?" checked":"")+"> ",t+=e[1]+"</label></div>";t+="</form></div>"}return['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">','<div class="joms-popup__content">',o.html,t,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnDelete,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>",'<div class="joms-popup__action joms-popup__hide">','<button class="joms-button--primary joms-js--button-done"></button>',"</div>","</div>","</div>"].join("")}(e)},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",s),t.on("click",".joms-js--button-save",n)}})})}}(),e("popups/event.delete",["utils/popup"],function(){return joms.popup.event.delete}),Go=window,Vo=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.invite=function(o,t){var e,s,n,p,i,a,u,c,r,m,l,d;function j(o){var e=t(o.currentTarget);g(e.val())}function f(){var o,t=p.find("input[type=checkbox]"),n=[],i=s.find("input[name=emails]").val()||"",a=s.find("[name=message]").val()||"",c=/^\s+|\s+$/g;t.each(function(){n.push(this.value)}),i=i.replace(c,""),a=a.replace(c,""),o=[["friendsearch",""],["emails",i],["message",a],["friends",n.join(",")]],joms.ajax({func:"system,ajaxSubmitInvitation",data:["events,inviteUsers",u,o],callback:function(){s.off(),e.close()}})}function v(e){var s=t(e.target),n="#joms-popup-tab-selected"===s.attr("href"),p=o.joms_lang[n?"COM_COMMUNITY_UNSELECT_ALL":"COM_COMMUNITY_SELECT_ALL"];i.html(p)}function b(){var o,e=t(".joms-tab__content:visible");if("joms-popup-tab-selected"===e.attr("id"))return e.find(".joms-js--friend").remove(),void s.find("input[type=checkbox]").each(function(){this.checked=!1});(o=e.find(".joms-js--friend").clone()).find("input[type=checkbox]").add(e.find("input[type=checkbox]")).prop("checked","checked"),(e=s.find("#joms-popup-tab-selected")).html(o)}function h(){g()}function _(o){var e,n,p=t(o.target),i=p.closest(".joms-tab__content");return"joms-popup-tab-selected"===i.attr("id")?(e=p[0].value,p.closest(".joms-js--friend").remove(),void(s.find(".joms-js--friend-"+e+" input[type=checkbox]")[0].checked=!1)):p[0].checked?(i=s.find("#joms-popup-tab-selected"),n=p.closest(".joms-js--friend").clone(),(p=n.find("input[type=checkbox]"))[0].checked=!0,void i.append(n)):(e=p[0].value,void s.find("#joms-popup-tab-selected .joms-js--friend-"+e).remove())}function g(e){var s,j,f="string"==typeof e;f?(n.empty(),m=0,r=e):m+=l,s="group"===c?"system,ajaxLoadGroupEventMembers":"system,ajaxLoadFriendsList",j=[r,"events,inviteUsers",u,m,l],"group"===c&&j.splice(1,1),d&&d.abort(),d=joms.ajax({func:s,data:j,callback:function(e){var s;e.html&&((s=t(t.trim(e.html))).each(function(){var o=t(this).find(":checkbox"),e=o.val();p.find(":checkbox[value="+e+"]").length&&(o[0].checked=!0)}),n.append(s)),f||(n[0].scrollTop=n[0].scrollHeight),e.loadMore?(i.css({width:"49%",marginRight:"2%"}),a.css({width:"49%"}).html(o.joms_lang.COM_COMMUNITY_INVITE_LOAD_MORE+" ("+e.moreCount+")").show()):(a.hide(),i.css({width:"100%",marginRight:"0"}))}})}return function(o,t){joms.util.popup.prepare(function(r){var m,d,w;m=r,d=o,w=t,s&&s.off(),e=m,u=d,c=w,l=200,joms.ajax({func:"system,ajaxShowInvitationForm",data:[null,"",u,1,"group"===c?0:1,c],callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div data-ui-object="popup-step-1"',t.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">',t.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--primary" data-btn-save="1">',t.btnInvite,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',t.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',t.error||"","</div>","</div>","</div>"].join(""))},e.updateItemHTML(),o.limit&&(l=+o.limit),s=e.contentContainer,n=s.find(".joms-tab__content").eq(0),p=s.find(".joms-tab__content").eq(1),i=s.find("[data-btn-select]"),a=s.find("[data-btn-load]"),s.on("keyup","[data-search]",j),s.on("click",".joms-tab__bar a",v),s.on("click","[data-btn-select]",b),s.on("click","[data-btn-load]",h),s.on("click","[data-btn-save]",f),s.on("click","input[type=checkbox]",_),g("")}})})}}(Go,Vo),e("popups/event.invite",["utils/popup"],function(){return joms.popup.event.invite}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.join=function(){var o,t,e;function s(){t.off(),o.close()}function n(){t.find("form")[0].submit()}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"events,ajaxRequestInvite",data:[e],callback:function(e){var p;o.items[0]={type:"inline",src:(p=e,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div class="joms-js--step1 ',p.isMember?"joms-popup__hide":"",'">','<div class="joms-popup__content">',p.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',p.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',p.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2 ',p.isMember?"":"joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',p.html,"</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",s),t.on("click",".joms-js--button-save",n)}})})}}(),e("popups/event.join",["utils/popup"],function(){return joms.popup.event.join}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.leave=function(){var o,t,e;function s(){t.off(),o.close()}function n(){t.find("form")[0].submit()}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"events,ajaxIgnoreEvent",data:[e],callback:function(e){var p;o.items[0]={type:"inline",src:(p=e,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',p.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',p.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',p.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",s),t.on("click",".joms-js--button-save",n)}})})}}(),e("popups/event.leave",["utils/popup"],function(){return joms.popup.event.leave}),Wo=window,Ko=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.response=function(o,t){var e,s,n;function p(e){var s=t(e.currentTarget).data("value");joms.ajax({func:"events,ajaxUpdateStatus",data:[n,s],callback:function(){o.location.reload()}})}return function(o){var t=[].slice.call(arguments);t.shift(),joms.util.popup.prepare(function(i){var a,u,c;a=i,u=o,c=t,s&&s.off(),n=u,(e=a).items[0]={type:"inline",src:function(o){var t,e="";for(t=0;t<o.length;t++)e+='<li><a data-value="'+o[t][0]+'" href="javascript:">'+o[t][1]+"</a></li>";return['<div class="joms-popup joms-popup--dropdown">','<ul class="joms-dropdown">',e,"</ul>",'<button class="mfp-close" type="button" title="Close (Esc)">×</button>',"</div>"].join("")}(c)},e.updateItemHTML(),(s=e.contentContainer).on("click","a[data-value]",p)})}}(Wo,Ko),e("popups/event.response",["utils/popup"],function(){return joms.popup.event.response}),Jo=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.addFeatured=function(o){var t,e,s;function n(n,p){e&&e.off(),t=n,s=p,joms.ajax({func:"events,ajaxAddFeatured",data:[s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()},t.updateItemHTML()}})}return function(o){joms.util.popup.prepare(function(t){n(t,o)})}}(Jo),e("popups/event.addfeatured",["utils/popup"],function(){return joms.popup.event.addFeatured}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.rejectGuest=function(){var o,t,e,s;function n(){t.off(),o.close()}function p(){var n=t.find("input:checkbox")[0].checked||!1;joms.ajax({func:n?"events,ajaxBlockGuest":"events,ajaxRemoveGuest",data:[s,e],callback:function(e){var s=t.find(".joms-js--step1"),n=t.find(".joms-js--step2");e.error||(o.st.callbacks||(o.st.callbacks={}),o.st.callbacks.close=function(){window.location.reload()}),n.find(".joms-popup__content").html(e.error||e.message),s.hide(),n.show()}})}return function(i,a){joms.util.popup.prepare(function(u){var c,r,m;c=u,r=i,m=a,t&&t.off(),o=c,e=r,s=m,joms.ajax({func:"events,ajaxConfirmRemoveGuest",data:[s,e],callback:function(e){var s;o.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',s.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',s.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',s.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",n),t.on("click",".joms-js--button-save",p)}})})}}(),e("popups/event.rejectguest",["utils/popup"],function(){return joms.popup.event.rejectGuest}),Xo=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.removeFeatured=function(o){var t,e,s;function n(n,p){e&&e.off(),t=n,s=p,joms.ajax({func:"events,ajaxRemoveFeatured",data:[s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()},t.updateItemHTML()}})}return function(o){joms.util.popup.prepare(function(t){n(t,o)})}}(Xo),e("popups/event.removefeatured",["utils/popup"],function(){return joms.popup.event.removeFeatured}),window,joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.report=function(){var o,t,e;function s(o){t.find("textarea").val(o.target.value)}function n(){t.off(),o.close()}function p(){var o;(o=(o=t.find("textarea").val()).replace(/^\s+|\s+$/g,""))?(t.find(".joms-js--error").hide(),joms.ajax({func:"system,ajaxSendReport",data:["events,reportEvent",window.location.href,o,e],callback:function(o){t.find(".joms-js--step1").hide(),t.find(".joms-js--step2").show().children().html(o.error||o.message)}})):t.find(".joms-js--error").show()}return function(i){joms.util.popup.prepare(function(a){var u,c;u=a,c=i,t&&t.off(),o=u,e=c,joms.ajax({func:"system,ajaxReport",data:[],callback:function(e){var i;o.items[0]={type:"inline",src:(i=e,i||(i={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',i.title,"</div>",'<div class="joms-js--step1',i.error?" joms-popup__hide":"",'">',i.html,'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',i.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',i.btnSend,"</button>","</div>","</div>",'<div class="joms-js--step2',i.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',i.error||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("change","select",s),t.on("click",".joms-js--button-cancel",n),t.on("click",".joms-js--button-save",p)}})})}}(),e("popups/event.report",["utils/popup"],function(){return joms.popup.event.report}),Zo=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.banMember=function(o){var t,e,s,n;function p(p,i,a){e&&e.off(),t=p,s=i,n=a,joms.ajax({func:"events,ajaxBanMember",data:[n,s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||s.message||s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.updateItemHTML(),e.success&&(t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()})}})}return function(o,t){joms.util.popup.prepare(function(e){p(e,o,t)})}}(Zo),e("popups/event.banmember",["utils/popup"],function(){return joms.popup.event.banMember}),ot=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.unbanMember=function(o){var t,e,s,n;function p(p,i,a){e&&e.off(),t=p,s=i,n=a,joms.ajax({func:"events,ajaxUnbanMember",data:[n,s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||s.message||s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.updateItemHTML(),e.success&&(t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()})}})}return function(o,t){joms.util.popup.prepare(function(e){p(e,o,t)})}}(ot),e("popups/event.unbanmember",["utils/popup"],function(){return joms.popup.event.unbanMember}),window,joms.popup||(joms.popup={}),joms.popup.event||(joms.popup.event={}),joms.popup.event.unpublish=function(){var o,t,e;function s(){t.off(),o.close()}function n(o,s,p){var i;i=s?[e,s,p]:[e],t.find(".joms-js--step1").find(".joms-popup__content").html(joms_lang.COM_COMMUNITY_POPUP_LOADING),t.find(".joms-js--step1").find(".joms-popup__action").children().hide(),joms.ajax({func:"events,ajaxUnpublishEvent",data:i,callback:function(o){var e;t.find(".joms-js--step1").hide(),t.find(".joms-js--step2").show().children().first().append("<div>"+(o.error||o.message)+"</div>"),o.next?n(0,o.next,i[2]):o.redirect&&((e=t.find(".joms-js--step2")).find(".joms-js--button-done").html(o.btnDone).on("click",function(){window.location=o.redirect}),e.find(".joms-popup__action").show(),e.find(".joms-popup__content").removeClass("joms-popup__content--single"))}})}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"events,ajaxShowUnpublishEvent",data:[e],callback:function(e){o.items[0]={type:"inline",src:function(o){var t,e,s;if(o||(o={}),t="",o.radios&&o.radios.length){for(t='<div><form style="margin:5px;padding:0">',s=0;s<o.radios.length;s++)e=o.radios[s],t+='<div><label> <input type="radio" name="recurring" value="'+e[0]+'"'+(e[2]?" checked":"")+"> ",t+=e[1]+"</label></div>";t+="</form></div>"}return['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',o.title,"</div>",'<div class="joms-js--step1',o.error?" joms-popup__hide":"",'">','<div class="joms-popup__content">',o.html,t,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',o.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',o.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2',o.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',o.error||"","</div>",'<div class="joms-popup__action joms-popup__hide">','<button class="joms-button--primary joms-js--button-done"></button>',"</div>","</div>","</div>"].join("")}(e)},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",s),t.on("click",".joms-js--button-save",n)}})})}}(),e("popups/event.unpublish",["utils/popup"],function(){return joms.popup.event.unpublish}),window,joms.popup||(joms.popup={}),joms.popup.event=(tt=joms.popup.event||{},joms._.extend({},tt)),e("popups/event",["popups/event.delete","popups/event.invite","popups/event.join","popups/event.leave","popups/event.response","popups/event.addfeatured","popups/event.rejectguest","popups/event.removefeatured","popups/event.report","popups/event.banmember","popups/event.unbanmember","popups/event.unpublish"],function(){return joms.popup.event}),et=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.fbc||(joms.popup.fbc={}),joms.popup.fbc.update=function(o){var t,e,s,n;function p(s){var n;e&&e.off(),t=s,o.joms_use_tfa?(t.items[0]={type:"inline",src:(n=o.joms_lang||{},['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',n.COM_COMMUNITY_AUTHENTICATION_KEY||"Authentication key","</div>",'<div class="joms-popup__content">',"<span>",n.COM_COMMUNITY_AUTHENTICATION_KEY_LABEL||"Insert your two-factor authentication key","</span>",'<input type="text" class="joms-input" name="secret">',"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-skip">',n.COM_COMMUNITY_SKIP_BUTTON||"Skip","</button>",'<button class="joms-button--primary joms-button--small joms-js--button-next">',n.COM_COMMUNITY_NEXT||"Next","</button>","</div>","</div>"].join(""))},t.updateItemHTML(),(e=t.contentContainer).off("click"),e.on("click",".joms-js--button-next",function(){i(e.find("[name=secret]").val())}),e.on("click",".joms-js--button-skip",function(){i()})):i()}function i(n){e&&e.off(),joms.ajax({func:"connect,ajaxUpdate",data:[n||""],callback:function(n){var p,i=n.jax_token_var;i&&(n.btnNext=n.btnContinue,o.jax_token_var=n.jax_token_var),t.items[0]={type:"inline",src:(p=n,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content ',p.btnNext?"":"joms-popup__content--single",'">',p.error||p.html||"","</div>",p.btnNext?'<div class="joms-popup__action">':"",p.btnNext?'<button class="joms-button--primary joms-button--small joms-js--button-next">'+p.btnNext+"</button>":"",p.btnNext?"</div>":"","</div>",'<div class="joms-js--step2 joms-popup__hide">','<div class="joms-popup__content"></div>','<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-back2"></button>','<button class="joms-button--primary joms-button--small joms-js--button-next2"></button>',"</div>","</div>",'<div class="joms-js--step3 joms-popup__hide">','<div class="joms-popup__content joms-popup__content--single"></div>','<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-back3"></button>',"</div>","</div>","</div>"].join(""))},t.updateItemHTML(),e=t.contentContainer,s=n.lang,e.off("click"),e.on("click",".joms-js--button-next",i?m:a),e.on("click",".joms-js--button-back2",u),e.on("click",".joms-js--button-next2",c),e.on("click",".joms-js--button-back3",l)}})}function a(){var o,t;(n=2==+e.find("[name=membertype]:checked").val())?joms.ajax({func:"connect,ajaxShowExistingUserForm",data:[""],callback:function(o){var t;e.find(".joms-js--step1").hide(),(t=e.find(".joms-js--step2")).find(".joms-popup__content").html(o.html),t.find(".joms-js--button-back2").html(o.btnBack),t.find(".joms-js--button-next2").html(o.btnLogin),t.show()}}):(o=e.find("#joms-js--fbc-tnc-checkbox")).length?(o=o[0],t=e.find(".joms-js--fbc-tnc-error"),o.checked?(t.hide(),r()):t.show()):r()}function u(){e.find(".joms-js--step2").hide(),e.find(".joms-js--step3").hide(),e.find(".joms-js--step1").show()}function c(){var o,p,i;n?(o=e.find(".joms-js--step2"),p=o.find("[name=username]").val(),i=o.find("[name=password]").val(),joms.ajax({func:"connect,ajaxValidateLogin",data:[p,i],callback:function(o){var s;if(o.error)return e.find(".joms-js--step2").hide(),(s=e.find(".joms-js--step3")).find(".joms-popup__content").html(o.error),s.find(".joms-js--button-back3").html(o.btnBack),void s.show();e.off(),t.close(),joms.popup.fbc.update()}})):function(){var o=e.find(".joms-js--step2"),n=o.find("[name=name]").val(),p=o.find("[name=username]").val(),i=o.find("[name=email]").val(),a=o.find("[name=profiletype]"),u="";if(a.length){if(!a.filter(":checked").length)return o.hide(),(o=e.find(".joms-js--step3")).find(".joms-popup__content").html(s.selectProfileType),o.find(".joms-js--button-back3").html(s.btnBack),void o.show();u=a.filter(":checked").val()}joms.ajax({func:"connect,ajaxCreateNewAccount",data:[n,p,i,u],callback:function(o){var s;if(o.error)return e.find(".joms-js--step2").hide(),(s=e.find(".joms-js--step3")).find(".joms-popup__content").html(o.error),s.find(".joms-js--button-back3").html(o.btnBack),void s.show();e.off(),t.close(),joms.popup.fbc.update()}})}()}function r(){joms.ajax({func:"connect,ajaxShowNewUserForm",data:[""],callback:function(o){var t;e.find(".joms-js--step1").hide(),(t=e.find(".joms-js--step2")).find(".joms-popup__content").html(o.html),t.find(".joms-js--button-back2").html(o.btnBack),t.find(".joms-js--button-next2").html(o.btnCreate),t.show()}})}function m(){var t=e.find("[name=importstatus]"),s=e.find("[name=importavatar]");t=t.length&&t[0].checked?1:0,s=s.length&&s[0].checked?1:0,joms.ajax({func:"connect,ajaxImportData",data:[t,s],callback:function(t){var s;return e.find(".joms-js--step1").hide(),t.error?(e.off("click").on("click",".joms-js--button-next2",d),(s=e.find(".joms-js--step2")).find(".joms-popup__content").html(t.error),s.find(".joms-js--button-back2").hide(),s.find(".joms-js--button-next2").html(t.btnNext),void s.show()):t.btnUpdate?(e.off("click").on("click",".joms-js--button-back2",d),e.off("click").on("click",".joms-js--button-next2",function(){o.location=t.redirect}),(s=e.find(".joms-js--step2")).find(".joms-popup__content").html(t.html),s.find(".joms-js--button-back2").html(t.btnSkip),s.find(".joms-js--button-next2").html(t.btnUpdate),void s.show()):(d(),void(o.location=t.redirect))}})}function l(){e.find(".joms-js--step3").hide(),n?(e.find(".joms-js--step2").hide(),e.find(".joms-js--step1").show()):(e.find(".joms-js--step2").show(),e.find(".joms-js--step1").hide())}function d(){e.off(),t.close()}return function(){joms.util.popup.prepare(function(o){p(o)})}}(et),e("popups/fbc.update",["utils/popup"],function(){return joms.popup.fbc.update}),window,joms.popup||(joms.popup={}),joms.popup.fbc=(st=joms.popup.fbc||{},joms._.extend({},st)),e("popups/fbc",["popups/fbc.update"],function(){return joms.popup.fbc}),nt=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.file||(joms.popup.file={}),joms.popup.file.download=function(o){var t,e,s,n,p;function i(i,a,u,c){e&&e.off(),t=i,s=a,n=u,p=c,joms.ajax({func:"files,ajaxFileDownload",data:[s,n],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',s.message||s.error,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.updateItemHTML(),e.url&&(t.close(),o.open(p))}})}return function(o,t,e){joms.util.popup.prepare(function(s){i(s,o,t,e)})}}(nt),e("popups/file.download",["utils/popup"],function(){return joms.popup.file.download}),pt=window,it=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.file||(joms.popup.file={}),joms.popup.file.list=function(o,t){var e,s,n,p,i,a,u,c;function r(o,t){joms.ajax({func:"files,ajaxgetFileList",data:[o,p,a,4,n],callback:function(o){t(o)}})}function m(){var e=t(this),n=e.data("id");i!==n&&(i=n,u=s.find(".joms-js--tab-"+n),e.addClass("active").siblings().removeClass("active"),c.css({visibility:"hidden"}),u.empty().show().siblings(".joms-js--tab").hide(),a=0,r(i,function(t){u.html(t.html),t.next&&t.count?(a=t.next,c.css({visibility:"visible"}),c.html(o.joms_lang.COM_COMMUNITY_FILES_LOAD_MORE+" ("+t.count+")")):c.css({visibility:"hidden"})}))}function l(){r(i,function(t){u.append(t.html),u[0].scrollTop=u[0].scrollHeight,t.next&&t.count?(a=t.next,c.css({visibility:"visible"}),c.html(o.joms_lang.COM_COMMUNITY_FILES_LOAD_MORE+" ("+t.count+")")):c.css({visibility:"hidden"})})}return function(o,t){joms.util.popup.prepare(function(a){var u,r,d;u=a,r=o,d=t,s&&s.off(),e=u,n=r,p=d,joms.ajax({func:"files,ajaxviewMore",data:[n,p],callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--600">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",t.html,"</div>"].join(""))},e.updateItemHTML(),s=e.contentContainer,c=s.find(".joms-js--btn-loadmore"),s.on("click",".joms-js--tab-bar a",m),s.on("click",".joms-js--btn-loadmore",l),i=!1,s.find(".joms-js--tab-bar a.active").trigger("click")}})})}}(pt,it),e("popups/file.list",["utils/loadlib","utils/popup"],function(){return joms.popup.file.list}),at=window,ut=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.file||(joms.popup.file={}),joms.popup.file.remove=function(o,t){var e,s;function n(n,p){e=n,s=p,o.confirm(o.joms_lang.COM_COMMUNITY_FILES_DELETE_CONFIRM)&&joms.ajax({func:"files,ajaxDeleteFile",data:[e,s],callback:function(o){o.success?t(".joms-js--file-"+s).remove():joms.util.popup.prepare(function(t){var e,s,n;s=o,(e=t).items[0]={type:"inline",src:(n=s,n||(n={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button> &nbsp; </div>','<div class="joms-popup__content joms-popup__content--single">',n.message||n.error,"</div>","</div>"].join(""))},e.updateItemHTML()})}})}return function(o,t){n(o,t)}}(at,ut),e("popups/file.remove",["utils/popup"],function(){return joms.popup.file.remove}),ct=window,rt=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.file||(joms.popup.file={}),joms.popup.file.upload=function(o,t){var e,s,n,p,i,a,u,c,r;function m(){l(function(){u.click()})}function l(e){"function"!=typeof e&&(e=function(){}),i?e():(a=joms.BASE_URL+s.find("input[name=url]").val(),joms.util.loadLib("plupload",function(){var n;n=t('<div id="joms-js--file-uploader" aria-hidden="true" style="width:1px; height:1px; overflow:hidden">').appendTo(document.body),t('<button id="joms-js--file-uploader-button">').appendTo(n),(i=new o.plupload.Uploader({url:a,container:"joms-js--file-uploader",browse_button:"joms-js--file-uploader-button",runtimes:"html5,html4",filters:[{title:"Document files",extensions:s.find("input[name=filetype]").val()}],max_file_size:s.find("input[name=maxfilesize]").val()+"mb"})).bind("FilesAdded",d),i.bind("Error",j),i.bind("UploadProgress",v),i.bind("FileUploaded",b),i.bind("uploadComplete",h),i.init(),u=n.find("input[type=file]"),e()}))}function d(o,t){var e,n="";for(e=0;e<t.length;e++)n+='<div class="joms-file--'+t[e].id+'" style="margin-bottom:5px">',n+="<div><strong>"+t[e].name+"</strong> <span>("+Math.round(t[e].size/1024)+" KB)</span></div>",n+='<div class="joms-progressbar"><div class="joms-progressbar__progress" style="width:0%"></div></div>',n+="</div>";c.find(".joms-js--upload-placeholder").remove(),c.append(n),s.find(".joms-js--btn-add").html(s.find(".joms-js--btn-add").data("lang-more")).css({visibility:"visible"}),s.find(".joms-js--btn-upload").show(),s.find(".joms-js--btn-done").hide()}function j(t,e){c.find(".joms-file--"+e.file.id).remove(),o.alert(e.message+" ("+e.code+")")}function f(){s.find(".joms-js--btn-add").css({visibility:"hidden"}),s.find(".joms-js--btn-upload").hide(),s.find(".joms-js--btn-done").hide(),i.settings.url=a+"&type="+n+"&id="+p,i.refresh(),i.start()}function v(o,t){var e;e=Math.min(100,Math.floor(t.loaded/t.size*100)),s.find(".joms-file--"+t.id).find(".joms-progressbar__progress").stop().animate({width:e+"%"})}function b(t,e,n){var p={};try{p=JSON.parse(n.response)}catch(o){}if(p.error)return i.stop(),s.find(".joms-js--btn-add").css({visibility:"hidden"}),s.find(".joms-js--btn-upload").hide(),s.find(".joms-js--btn-done").show(),s.find(".joms-file--"+e.id).nextAll().andSelf().remove(),void o.alert(p.msg);p.msg?s.find(".joms-file--"+e.id).css({color:"#F00"}):p.id&&(r=!0)}function h(){s.find(".joms-js--btn-add").css({visibility:"visible"}),s.find(".joms-js--btn-upload").hide(),s.find(".joms-js--btn-done").show()}return function(t,i){joms.util.popup.prepare(function(a){var u,d,j;u=a,d=t,j=i,s&&s.off(),e=u,n=d,p=j,joms.ajax({func:"files,ajaxFileUploadForm",data:[n,p],callback:function(t){var n;e.items[0]={type:"inline",src:(n=t,n||(n={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',n.title,"</div>",n.html,"</div>"].join(""))},e.updateItemHTML(),e.st.callbacks||(e.st.callbacks={}),e.st.callbacks.close=function(){r&&o.location.reload()},s=e.contentContainer,r=!1,c=s.find(".joms-js--upload-preview"),s.on("click",".joms-js--btn-add",m),s.on("click",".joms-js--btn-upload",f),s.on("click",".joms-js--btn-done",function(){r&&o.location.reload()}),l()}})})}}(ct,rt),e("popups/file.upload",["utils/loadlib","utils/popup"],function(){return joms.popup.file.upload}),mt=window,joms.popup||(joms.popup={}),joms.popup.file||(joms.popup.file={}),joms.popup.file.updateHit=(lt=mt,function(o,t){joms.ajax({func:"files,ajaxUpdateHit",data:[o],callback:function(){}}),"string"==typeof t&&lt.open(t)}),e("popups/file.updatehit",["utils/popup"],function(){return joms.popup.file.updateHit}),window,joms.popup||(joms.popup={}),joms.popup.file=(dt=joms.popup.file||{},joms._.extend({},dt)),e("popups/file",["popups/file.download","popups/file.list","popups/file.remove","popups/file.upload","popups/file.updatehit"],function(){return joms.popup.file}),window,joms.popup||(joms.popup={}),joms.popup.friend||(joms.popup.friend={}),joms.popup.friend.add=function(){var o,t,e;function s(s,i){t&&t.off(),o=s,e=i,joms.ajax({func:"friends,ajaxConnect",data:[e],callback:function(e){var s;o.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div data-ui-object="popup-step-1"',s.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">','<div class="joms-stream__header" style="padding:0">','<div class="joms-avatar--stream"><img src="',s.avatar,'"></div>','<div class="joms-stream__meta"><span>',s.desc,"</span></div>","</div>","</div>",'<div class="joms-popup__content">','<textarea class="joms-textarea" style="margin:0">',s.message,"</textarea>","</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',s.btnCancel,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',s.btnAdd,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',s.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',window.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click","[data-ui-object=popup-button-cancel]",n),t.on("click","[data-ui-object=popup-button-save]",p)}})}function n(){t.off(),o.close()}function p(){var s=t.find("textarea").val().replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/&quot;/g,'"');joms.ajax({func:"friends,ajaxSaveFriend",data:[[["msg",s],["userid",e]]],callback:function(e){var s=t.find("[data-ui-object=popup-step-1]"),n=t.find("[data-ui-object=popup-step-2]");e.error||(o.st.callbacks||(o.st.callbacks={}),o.st.callbacks.close=function(){window.location.reload()}),n.find("[data-ui-object=popup-message]").html(e.error||e.message),s.hide(),n.show()}})}return function(o){joms.util.popup.prepare(function(t){s(t,o)})}}(),e("popups/friend.add",["utils/popup"],function(){return joms.popup.friend.add}),window,joms.popup||(joms.popup={}),joms.popup.friend||(joms.popup.friend={}),joms.popup.friend.addCancel=function(){var o,t,e;function s(){t.off(),o.close()}function n(){t.find("form")[0].submit()}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"friends,ajaxCancelRequest",data:[e,window.location.href],callback:function(e){var p;o.items[0]={type:"inline",src:(p=e,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',p.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',p.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',p.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",s),t.on("click",".joms-js--button-save",n)}})})}}(),e("popups/friend.addcancel",["utils/popup"],function(){return joms.popup.friend.addCancel}),jt=window,ft=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.friend||(joms.popup.friend={}),joms.popup.friend.approve=function(o,t){var e;function s(s){e=s,joms.ajax({func:"friends,ajaxApproveRequest",data:[e],callback:function(s){if(s.success)return n=s,t(".joms-js--frequest-msg-"+e).html(n.message),t(".joms-js--frequest-btn-"+e).remove(),void joms.fn.notification.updateCounter("frequest",e,-1);var n;joms.util.popup.prepare(function(t){var e;t.items[0]={type:"inline",src:(e=s,e||(e={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',e.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',e.error||e.message,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.updateItemHTML()})}})}return function(o){s(o)}}(jt,ft),e("popups/friend.approve",["utils/popup","functions/notification"],function(){return joms.popup.friend.approve}),vt=window,bt=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.friend||(joms.popup.friend={}),joms.popup.friend.reject=function(o,t){var e;function s(s){e=s,joms.ajax({func:"friends,ajaxRejectRequest",data:[e],callback:function(s){if(s.success)return n=s,t(".joms-js--frequest-msg-"+e).html(n.message),t(".joms-js--frequest-btn-"+e).remove(),void joms.fn.notification.updateCounter("frequest",e,-1);var n;joms.util.popup.prepare(function(t){var e;t.items[0]={type:"inline",src:(e=s,e||(e={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',e.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',e.error||e.message,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.updateItemHTML()})}})}return function(o){s(o)}}(vt,bt),e("popups/friend.reject",["utils/popup","functions/notification"],function(){return joms.popup.friend.reject}),ht=window,_t=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.friend||(joms.popup.friend={}),joms.popup.friend.remove=function(o,t){var e,s,n;function p(){s.off(),e.close()}function i(){var o,e=s.find("input[type=checkbox]");o=e[0].checked?"friends,ajaxBlockFriend":"friends,ajaxRemoveFriend",joms.ajax({func:o,data:[n],callback:function(o){var e=s.find("[data-ui-object=popup-step-1]"),p=s.find("[data-ui-object=popup-step-2]");p.find("[data-ui-object=popup-message]").html(o.error||o.message),e.hide(),p.show(),o&&o.success&&t("#friend-"+n).remove()}})}return function(t){joms.util.popup.prepare(function(a){var u,c;u=a,c=t,s&&s.off(),e=u,n=c,joms.ajax({func:"friends,ajaxConfirmFriendRemoval",data:[n],callback:function(t){var n;e.items[0]={type:"inline",src:(n=t,n||(n={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',n.title,"</div>",'<div data-ui-object="popup-step-1"',n.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">',n.html||"","</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',n.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',n.btnYes,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',n.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',n.error||"","</div>","</div>","</div>"].join(""))},e.st.callbacks||(e.st.callbacks={}),e.st.callbacks.close=function(){o.location.reload()},e.updateItemHTML(),(s=e.contentContainer).on("click","[data-ui-object=popup-button-cancel]",p),s.on("click","[data-ui-object=popup-button-save]",i)}})})}}(ht,_t),e("popups/friend.remove",["utils/popup"],function(){return joms.popup.friend.remove}),window,joms.popup||(joms.popup={}),joms.popup.friend||(joms.popup.friend={}),joms.popup.friend.response=function(){var o,t,e,s;function n(){joms.ajax({func:"friends,ajaxRejectRequest",data:[s],callback:function(o){i(o)}})}function p(){joms.ajax({func:"friends,ajaxApproveRequest",data:[s],callback:function(o){i(o)}})}function i(e){var s=t.find(".joms-js--step1"),n=t.find(".joms-js--step2");e.error||(o.st.callbacks||(o.st.callbacks={}),o.st.callbacks.close=function(){window.location.reload()}),n.find(".joms-popup__content").html(e.error||e.message),s.hide(),n.show()}return function(i){joms.util.popup.prepare(function(a){var u,c;u=a,c=i,t&&t.off(),o=u,e=c,joms.ajax({func:"friends,ajaxConnect",data:[e],callback:function(e){var i,a;o.items[0]={type:"inline",src:(i=e,a=!1,i||(i={}),i.error&&!i.desc&&(a=i.error),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',i.title,"</div>",'<div class="joms-js--step1',a?" joms-popup__hide":"",'">','<div class="joms-popup__content">','<div class="joms-stream__header" style="padding:0">','<div class="joms-avatar--stream"><img src="',i.avatar,'"></div>','<div class="joms-stream__meta"><span>',i.desc,"</span></div>","</div>","</div>",'<div class="joms-popup__content">','<div class="cStream-Quote">',i.message,"</div>","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',i.btnReject,"</button>",'<button class="joms-button--primary joms-button--small joms-js--button-save">',i.btnAccept,"</button>","</div>","</div>",'<div class="joms-js--step2',a?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',a||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),s=e.connection_id,(t=o.contentContainer).on("click",".joms-js--button-cancel",n),t.on("click",".joms-js--button-save",p)}})})}}(),e("popups/friend.response",["utils/popup","functions/notification"],function(){return joms.popup.friend.response}),window,joms.popup||(joms.popup={}),joms.popup.friend=(gt=joms.popup.friend||{},joms._.extend({},gt)),e("popups/friend",["popups/friend.add","popups/friend.addcancel","popups/friend.approve","popups/friend.reject","popups/friend.remove","popups/friend.response"],function(){return joms.popup.friend}),window,joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.delete=function(){var o,t,e;function s(){t.off(),o.close()}function n(o,s){joms.ajax({func:"groups,ajaxDeleteGroup",data:[e,s||1],callback:function(o){var e;t.find(".joms-js--step1").hide(),t.find(".joms-js--step2").show().children().first().append("<div>"+(o.error||o.message)+"</div>"),o.next?n(0,o.next):o.redirect&&((e=t.find(".joms-js--step2")).find(".joms-js--button-done").html(o.btnDone).on("click",function(){window.location=o.redirect}),e.find(".joms-popup__action").show(),e.find(".joms-popup__content").removeClass("joms-popup__content--single"))}})}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"groups,ajaxWarnGroupDeletion",data:[e],callback:function(e){var p;o.items[0]={type:"inline",src:(p=e,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div class="joms-js--step1',p.error?" joms-popup__hide":"",'">','<div class="joms-popup__content">',p.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',p.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',p.btnDelete,"</button>","</div>","</div>",'<div class="joms-js--step2',p.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',p.error||"","</div>",'<div class="joms-popup__action joms-popup__hide">','<button class="joms-button--primary joms-js--button-done"></button>',"</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",s),t.on("click",".joms-js--button-save",n)}})})}}(),e("popups/group.delete",["utils/popup"],function(){return joms.popup.group.delete}),wt=window,kt=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.invite=function(o,t){var e,s,n,p,i,a,u,c,r,m,l;function d(o){var e=t(o.currentTarget);_(e.val())}function j(){var o,t=p.find("input[type=checkbox]"),n=[],i=s.find("input[name=emails]").val()||"",a=s.find("[name=message]").val()||"",c=/^\s+|\s+$/g;t.each(function(){n.push(this.value)}),i=i.replace(c,""),a=a.replace(c,""),o=[["friendsearch",""],["emails",i],["message",a],["friends",n.join(",")]],joms.ajax({func:"system,ajaxSubmitInvitation",data:["groups,inviteUsers",u,o],callback:function(){s.off(),e.close()}})}function f(e){var s=t(e.target),n="#joms-popup-tab-selected"===s.attr("href"),p=o.joms_lang[n?"COM_COMMUNITY_UNSELECT_ALL":"COM_COMMUNITY_SELECT_ALL"];i.html(p)}function v(){var o,e=t(".joms-tab__content:visible");if("joms-popup-tab-selected"===e.attr("id"))return e.find(".joms-js--friend").remove(),void s.find("input[type=checkbox]").each(function(){this.checked=!1});(o=e.find(".joms-js--friend").clone()).find("input[type=checkbox]").add(e.find("input[type=checkbox]")).prop("checked","checked"),(e=s.find("#joms-popup-tab-selected")).html(o)}function b(){_()}function h(o){var e,n,p=t(o.target),i=p.closest(".joms-tab__content");return"joms-popup-tab-selected"===i.attr("id")?(e=p[0].value,p.closest(".joms-js--friend").remove(),void(s.find(".joms-js--friend-"+e+" input[type=checkbox]")[0].checked=!1)):p[0].checked?(i=s.find("#joms-popup-tab-selected"),n=p.closest(".joms-js--friend").clone(),(p=n.find("input[type=checkbox]"))[0].checked=!0,void i.append(n)):(e=p[0].value,void s.find("#joms-popup-tab-selected .joms-js--friend-"+e).remove())}function _(e){var s="string"==typeof e;s?(n.empty(),r=0,c=e):r+=m,l&&l.abort(),l=joms.ajax({func:"system,ajaxLoadFriendsList",data:[c,"groups,inviteUsers",u,r,m],callback:function(e){var u;e.html&&((u=t(t.trim(e.html))).each(function(){var o=t(this).find(":checkbox"),e=o.val();p.find(":checkbox[value="+e+"]").length&&(o[0].checked=!0)}),n.append(u)),s||(n[0].scrollTop=n[0].scrollHeight),e.loadMore?(i.css({width:"49%",marginRight:"2%"}),a.css({width:"49%"}).html(o.joms_lang.COM_COMMUNITY_INVITE_LOAD_MORE+" ("+e.moreCount+")").show()):(a.hide(),i.css({width:"100%",marginRight:"0"}))}})}return function(o){joms.util.popup.prepare(function(t){var c,r;c=t,r=o,s&&s.off(),e=c,u=r,m=200,joms.ajax({func:"system,ajaxShowInvitationForm",data:[null,"",u,1,1],callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div data-ui-object="popup-step-1"',t.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">',t.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--primary" data-btn-save="1">',t.btnInvite,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',t.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',t.error||"","</div>","</div>","</div>"].join(""))},e.updateItemHTML(),o.limit&&(m=+o.limit),s=e.contentContainer,n=s.find(".joms-tab__content").eq(0),p=s.find(".joms-tab__content").eq(1),i=s.find("[data-btn-select]"),a=s.find("[data-btn-load]"),s.on("keyup","[data-search]",d),s.on("click",".joms-tab__bar a",f),s.on("click","[data-btn-select]",v),s.on("click","[data-btn-load]",b),s.on("click","[data-btn-save]",j),s.on("click","input[type=checkbox]",h),_("")}})})}}(wt,kt),e("popups/group.invite",["utils/popup"],function(){return joms.popup.group.invite}),yt=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.join=(xt=yt,function(o){joms.util.popup.prepare(function(t){var e;e=o,Ct&&Ct.off(),Mt=e,joms.ajax({func:"groups,ajaxJoinGroup",data:[Mt],callback:function(){xt.location.reload()}})})}),e("popups/group.join",["utils/popup"],function(){return joms.popup.group.join}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.leave=function(){var o,t,e;function s(){t.off(),o.close()}function n(){t.find("form")[0].submit()}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"groups,ajaxShowLeaveGroup",data:[e],callback:function(e){var p;o.items[0]={type:"inline",src:(p=e,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',p.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',p.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',p.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",s),t.on("click",".joms-js--button-save",n)}})})}}(),e("popups/group.leave",["utils/popup"],function(){return joms.popup.group.leave}),Tt=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.addFeatured=function(o){var t,e,s;function n(n,p){e&&e.off(),t=n,s=p,joms.ajax({func:"groups,ajaxAddFeatured",data:[s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()},t.updateItemHTML()}})}return function(o){joms.util.popup.prepare(function(t){n(t,o)})}}(Tt),e("popups/group.addfeatured",["utils/popup"],function(){return joms.popup.group.addFeatured}),St=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.removeFeatured=function(o){var t,e,s;function n(n,p){e&&e.off(),t=n,s=p,joms.ajax({func:"groups,ajaxRemoveFeatured",data:[s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()},t.updateItemHTML()}})}return function(o){joms.util.popup.prepare(function(t){n(t,o)})}}(St),e("popups/group.removefeatured",["utils/popup"],function(){return joms.popup.group.removeFeatured}),window,joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.report=function(){var o,t,e;function s(o){t.find("textarea").val(o.target.value)}function n(){t.off(),o.close()}function p(){var o;(o=(o=t.find("textarea").val()).replace(/^\s+|\s+$/g,""))?(t.find(".joms-js--error").hide(),joms.ajax({func:"system,ajaxSendReport",data:["groups,reportGroup",window.location.href,o,e],callback:function(o){t.find(".joms-js--step1").hide(),t.find(".joms-js--step2").show().children().html(o.error||o.message)}})):t.find(".joms-js--error").show()}return function(i){joms.util.popup.prepare(function(a){var u,c;u=a,c=i,t&&t.off(),o=u,e=c,joms.ajax({func:"system,ajaxReport",data:[],callback:function(e){var i;o.items[0]={type:"inline",src:(i=e,i||(i={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',i.title,"</div>",'<div class="joms-js--step1',i.error?" joms-popup__hide":"",'">',i.html,'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',i.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',i.btnSend,"</button>","</div>","</div>",'<div class="joms-js--step2',i.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',i.error||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("change","select",s),t.on("click",".joms-js--button-cancel",n),t.on("click",".joms-js--button-save",p)}})})}}(),e("popups/group.report",["utils/popup"],function(){return joms.popup.group.report}),window,joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.unpublish=function(){var o,t,e;function s(){t.off(),o.close()}function n(){t.find("form")[0].submit()}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"groups,ajaxShowUnpublishGroup",data:[e],callback:function(e){var p;o.items[0]={type:"inline",src:(p=e,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div class="joms-popup__content">',p.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',p.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',p.btnYes,"</button>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",s),t.on("click",".joms-js--button-save",n)}})})}}(),e("popups/group.unpublish",["utils/popup"],function(){return joms.popup.group.unpublish}),window,Lt=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.approve=(Ot=Lt,function(o,t){It=o,Ut=t,joms.ajax({func:"groups,ajaxApproveMember",data:[Ut,It],callback:function(o){o&&(Ot(".joms-js--request-buttons-group-"+It+"-"+Ut).remove(),Ot(".joms-js--request-notice-group-"+It+"-"+Ut).html(o.message||o.error),o.success&&joms.fn.notification.updateCounter("general",It,-1))}})}),e("popups/group.approve",["functions/notification"],function(){return joms.popup.group.approve}),window,Et=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.removeMember=function(o,t){var e,s,n,p;function i(){s.off(),e.close()}function a(){var o=s.find("input:checkbox"),e=o[0].checked?"groups,ajaxBanMember":"groups,ajaxRemoveMember",i=[p,n];joms.ajax({func:e,data:i,callback:function(o){s.find(".joms-js--step1").hide(),s.find(".joms-js--step2").show().children().append(o.error||o.message),o.success&&(t(".joms-js--member-group-"+n+"-"+p).remove(),t(".joms-js--request-buttons-group-"+n+"-"+p).remove(),t(".joms-js--request-notice-group-"+n+"-"+p).html(o&&o.message||""),joms.fn.notification.updateCounter("general",n,-1))}})}return function(o,t){joms.util.popup.prepare(function(u){var c,r,m;c=u,r=o,m=t,s&&s.off(),e=c,n=r,p=m,joms.ajax({func:"groups,ajaxConfirmMemberRemoval",data:[p,n],callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',t.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',t.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',t.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join(""))},e.updateItemHTML(),(s=e.contentContainer).on("click",".joms-js--button-cancel",i),s.on("click",".joms-js--button-save",a)}})})}}(0,Et),e("popups/group.removemember",["utils/popup","functions/notification"],function(){return joms.popup.group.removeMember}),At=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.banMember=function(o){var t,e,s,n;function p(p,i,a){e&&e.off(),t=p,s=i,n=a,joms.ajax({func:"groups,ajaxBanMember",data:[n,s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||s.message||s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.updateItemHTML(),e.success&&(t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()})}})}return function(o,t){joms.util.popup.prepare(function(e){p(e,o,t)})}}(At),e("popups/group.banmember",["utils/popup"],function(){return joms.popup.group.banMember}),Rt=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.group||(joms.popup.group={}),joms.popup.group.unbanMember=function(o){var t,e,s,n;function p(p,i,a){e&&e.off(),t=p,s=i,n=a,joms.ajax({func:"groups,ajaxUnbanMember",data:[n,s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||s.message||s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.updateItemHTML(),e.success&&(t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()})}})}return function(o,t){joms.util.popup.prepare(function(e){p(e,o,t)})}}(Rt),e("popups/group.unbanmember",["utils/popup"],function(){return joms.popup.group.unbanMember}),window,joms.popup||(joms.popup={}),joms.popup.group=(Nt=joms.popup.group||{},joms._.extend({},Nt)),e("popups/group",["popups/group.delete","popups/group.invite","popups/group.join","popups/group.leave","popups/group.addfeatured","popups/group.removefeatured","popups/group.report","popups/group.unpublish","popups/group.approve","popups/group.removemember","popups/group.banmember","popups/group.unbanmember"],function(){return joms.popup.group}),Ht=window,Pt=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.inbox||(joms.popup.inbox={}),joms.popup.inbox.addRecipient=function(o,t){var e,s,n,p,i,a,u,c,r,m,l;function d(o){var e=t(o.currentTarget);_(e.val())}function j(){var o=t("#joms-js--compose-to");p.find(".joms-js--friend").each(function(){var e=t(this),s=e.find(":checkbox"),n=s.val();o.find(".joms-js--friend-"+n).length||o.append(e.clone())}),s.off(),e.close(),o.show()}function f(e){var s=t(e.target),n="#joms-popup-tab-selected"===s.attr("href"),p=o.joms_lang[n?"COM_COMMUNITY_UNSELECT_ALL":"COM_COMMUNITY_SELECT_ALL"];i.html(p)}function v(){var o,e=t(".joms-tab__content:visible");if("joms-popup-tab-selected"===e.attr("id"))return e.find(".joms-js--friend").remove(),void s.find("input[type=checkbox]").each(function(){this.checked=!1});(o=e.find(".joms-js--friend").clone()).find("input[type=checkbox]").add(e.find("input[type=checkbox]")).prop("checked","checked"),(e=s.find("#joms-popup-tab-selected")).html(o)}function b(){_()}function h(o){var e,n,p=t(o.target),i=p.closest(".joms-tab__content");return"joms-popup-tab-selected"===i.attr("id")?(e=p[0].value,p.closest(".joms-js--friend").remove(),void(s.find(".joms-js--friend-"+e+" input[type=checkbox]")[0].checked=!1)):p[0].checked?(i=s.find("#joms-popup-tab-selected"),n=p.closest(".joms-js--friend").clone(),(p=n.find("input[type=checkbox]"))[0].checked=!0,void i.append(n)):(e=p[0].value,void s.find("#joms-popup-tab-selected .joms-js--friend-"+e).remove())}function _(e){var s="string"==typeof e;s?(n.empty(),r=0,c=e):r+=m,l&&l.abort(),l=joms.ajax({func:"system,ajaxLoadFriendsList",data:[c,"friends,inviteUsers",u,r,m],callback:function(e){var u;e.html&&((u=t(t.trim(e.html))).each(function(){var o=t(this).find(":checkbox"),e=o.val();p.find(":checkbox[value="+e+"]").length&&(o[0].checked=!0)}),n.append(u)),s||(n[0].scrollTop=n[0].scrollHeight),e.loadMore?(i.css({width:"49%",marginRight:"2%"}),a.css({width:"49%"}).html(o.joms_lang.COM_COMMUNITY_INVITE_LOAD_MORE+" ("+e.moreCount+")").show()):(a.hide(),i.css({width:"100%",marginRight:"0"}))}})}return function(o){joms.util.popup.prepare(function(t){var c,r;c=t,r=o,s&&s.off(),e=c,u=r,m=200,joms.ajax({func:"system,ajaxShowFriendsForm",data:[null,"",u,1,1],callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div data-ui-object="popup-step-1"',t.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">',t.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--primary" data-btn-save="1">',t.btnSelect,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',t.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',t.error||"","</div>","</div>","</div>"].join(""))},e.updateItemHTML(),o.limit&&(m=+o.limit),s=e.contentContainer,n=s.find(".joms-tab__content").eq(0),p=s.find(".joms-tab__content").eq(1),i=s.find("[data-btn-select]"),a=s.find("[data-btn-load]"),s.on("keyup","[data-search]",d),s.on("click",".joms-tab__bar a",f),s.on("click","[data-btn-select]",v),s.on("click","[data-btn-load]",b),s.on("click","[data-btn-save]",j),s.on("click","input[type=checkbox]",h),_("")}})})}}(Ht,Pt),e("popups/inbox.addrecipient",["utils/popup"],function(){return joms.popup.inbox.addRecipient}),$t=window,Yt=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.chat||(joms.popup.chat={}),joms.popup.chat.addRecipient=function(o,t){var e,s,n,p,i,a,u,c,r,m,l;function d(o){var e=t(o.currentTarget);_(e.val())}function j(){var o={};p.find(".joms-js--friend").each(function(){var e=t(this),s=e.find(":checkbox"),n=s.val(),p={id:+n,name:e.find(".joms-avatar--comment a img").attr("alt"),avatar:e.find(".joms-avatar--comment a img").attr("src")};o[n]=p}),joms_observer.do_action("chat_add_people",o),s.off(),e.close()}function f(e){var s=t(e.target),n="#joms-popup-tab-selected"===s.attr("href"),p=o.joms_lang[n?"COM_COMMUNITY_UNSELECT_ALL":"COM_COMMUNITY_SELECT_ALL"];i.html(p)}function v(){var o,e=t(".joms-tab__content:visible");if("joms-popup-tab-selected"===e.attr("id"))return e.find(".joms-js--friend").remove(),void s.find("input[type=checkbox]").each(function(){this.checked=!1});(o=e.find(".joms-js--friend").clone()).find("input[type=checkbox]").add(e.find("input[type=checkbox]")).prop("checked","checked"),(e=s.find("#joms-popup-tab-selected")).html(o)}function b(){_()}function h(o){var e,n,p=t(o.target),i=p.closest(".joms-tab__content");return"joms-popup-tab-selected"===i.attr("id")?(e=p[0].value,p.closest(".joms-js--friend").remove(),void(s.find(".joms-js--friend-"+e+" input[type=checkbox]")[0].checked=!1)):p[0].checked?(i=s.find("#joms-popup-tab-selected"),n=p.closest(".joms-js--friend").clone(),(p=n.find("input[type=checkbox]"))[0].checked=!0,void i.append(n)):(e=p[0].value,void s.find("#joms-popup-tab-selected .joms-js--friend-"+e).remove())}function _(e){var s="string"==typeof e;s?(n.empty(),r=0,c=e):r+=m,l&&l.abort(),l=joms.ajax({func:"system,ajaxLoadFriendsList",data:[c,"friends,inviteUsers",u,r,m],callback:function(e){var u;e.html&&((u=t(t.trim(e.html))).each(function(){var o=t(this).find(":checkbox"),e=o.val();p.find(":checkbox[value="+e+"]").length&&(o[0].checked=!0)}),n.append(u)),s||(n[0].scrollTop=n[0].scrollHeight),e.loadMore?(i.css({width:"49%",marginRight:"2%"}),a.css({width:"49%"}).html(o.joms_lang.COM_COMMUNITY_INVITE_LOAD_MORE+" ("+e.moreCount+")").show()):(a.hide(),i.css({width:"100%",marginRight:"0"}))}})}return function(o){joms.util.popup.prepare(function(t){var c,r;c=t,r=o,s&&s.off(),e=c,u=r,m=200,joms.ajax({func:"system,ajaxShowFriendsForm",data:[null,"",u,1,1],callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div data-ui-object="popup-step-1"',t.error?' class="joms-popup__hide"':"",">",'<div class="joms-popup__content">',t.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--primary" data-btn-save="1">',t.btnSelect,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',t.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',t.error||"","</div>","</div>","</div>"].join(""))},e.updateItemHTML(),o.limit&&(m=+o.limit),s=e.contentContainer,n=s.find(".joms-tab__content").eq(0),p=s.find(".joms-tab__content").eq(1),i=s.find("[data-btn-select]"),a=s.find("[data-btn-load]"),s.on("keyup","[data-search]",d),s.on("click",".joms-tab__bar a",f),s.on("click","[data-btn-select]",v),s.on("click","[data-btn-load]",b),s.on("click","[data-btn-save]",j),s.on("click","input[type=checkbox]",h),_("")}})})}}($t,Yt),e("popups/chat.addrecipient",["utils/popup"],function(){return joms.popup.chat.addRecipient}),window,Qt=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.inbox||(joms.popup.inbox={}),joms.popup.inbox.remove=function(o,t){var e,s,n,p;function i(){s.off(),e.close()}function a(){joms.ajax({func:"inbox"===n?"inbox,ajaxRemoveFullMessages":"inbox,ajaxRemoveSentMessages",data:[p.join(",")],callback:function(o){var e;if(s.find(".joms-js--step1").hide(),s.find(".joms-js--step2").show().children().html(o.error||o.message),o.success){for(t(".joms-js--message-checkall")[0].checked=!1,e=0;e<p.length;e++)t(".joms-js--message-item-"+p[e]).remove();t(".joms-js--message-item").length||t(".joms-js--message-ct").remove()}}})}return function(o,t){joms.util.popup.prepare(function(u){var c,r,m,l;c=u,r=o,m=t,s&&s.off(),e=c,l=[n=r],(p=m).length||l.push("empty"),joms.ajax({func:"inbox,ajaxDeleteMessages",data:l,callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-js--step1 ',t.error?"joms-popup__hide":"",'">','<div class="joms-popup__content">',t.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',t.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',t.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2 ',t.error?"":"joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',t.error||"","</div>","</div>","</div>"].join(""))},e.updateItemHTML(),(s=e.contentContainer).on("click",".joms-js--button-cancel",i),s.on("click",".joms-js--button-save",a)}})})}}(0,Qt),e("popups/inbox.remove",["utils/popup"],function(){return joms.popup.inbox.remove}),Ft=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.inbox||(joms.popup.inbox={}),joms.popup.inbox.setRead=(Bt=Ft,function(o,t){!function(o,t){var e;if(o.length)for(e=0;e<o.length;e++)Bt.jax.call("community","inbox,ajaxMarkMessageAsRead",o[e]);else joms.util.popup.prepare(function(o){var e;o.items[0]={type:"inline",src:(e={error:t},e||(e={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',e.title||"","</div>",'<div class="joms-js--step1 ',e.error?"joms-popup__hide":"",'">','<div class="joms-popup__content">',e.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',e.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',e.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2 ',e.error?"":"joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',e.error||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML()})}(o,t)}),e("popups/inbox.setread",["utils/popup"],function(){return joms.popup.inbox.setRead}),Dt=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.inbox||(joms.popup.inbox={}),joms.popup.inbox.setUnread=(qt=Dt,function(o,t){!function(o,t){var e;if(o.length)for(e=0;e<o.length;e++)qt.jax.call("community","inbox,ajaxMarkMessageAsUnread",o[e]);else joms.util.popup.prepare(function(o){var e;o.items[0]={type:"inline",src:(e={error:t},e||(e={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',e.title||"","</div>",'<div class="joms-js--step1 ',e.error?"joms-popup__hide":"",'">','<div class="joms-popup__content">',e.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',e.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',e.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2 ',e.error?"":"joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',e.error||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML()})}(o,t)}),e("popups/inbox.setunread",["utils/popup"],function(){return joms.popup.inbox.setUnread}),window,joms.popup||(joms.popup={}),joms.popup.inbox=(zt=joms.popup.inbox||{},joms._.extend({},zt)),e("popups/inbox",["popups/inbox.addrecipient","popups/chat.addrecipient","popups/inbox.remove","popups/inbox.setread","popups/inbox.setunread"],function(){return joms.popup.inbox}),Gt=window,joms.popup||(joms.popup={}),joms.popup.location||(joms.popup.location={}),joms.popup.location.view=function(o){var t,e,s;function n(n,p){e&&e.off(),t=n,s=p,joms.ajax({func:"activities,ajaxShowMap",data:[s],callback:function(s){var n,p,i;t.items[0]={type:"inline",src:(n=s,n||(n={}),p=n.latitude+","+n.longitude,n.location,i="https://maps.googleapis.com/maps/api/staticmap?center="+p+"&markers=color:red%7Clabel:S%7C"+p+"&zoom=14&size=600x350&maptype=roadmap",o.joms_gmap_key&&(i+="&key="+o.joms_gmap_key),['<div class="joms-popup joms-popup--location-view">',"<div",n.error?' class="joms-popup__hide"':"",">",'<a href="//www.google.com/maps/@',p,',19z" target="_blank">','<img src="',i,'">',"</a>","</div>","<div",n.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single">',n.error,"</div>","</div>","</div>"].join(""))},t.updateItemHTML(),e=t.contentContainer}})}return function(o){joms.util.popup.prepare(function(t){n(t,o)})}}(Gt),e("popups/location.view",["utils/popup"],function(){return joms.popup.location.view}),window,joms.popup||(joms.popup={}),joms.popup.location=(Vt=joms.popup.location||{},joms._.extend({},Vt)),e("popups/location",["popups/location.view"],function(){return joms.popup.location}),window,joms.popup||(joms.popup={}),joms.popup.notification||(joms.popup.notification={}),joms.popup.notification.global=function(){joms.util.popup.prepare(function(o){var t;t=o,joms.ajax({func:"notification,ajaxGetNotification",data:[""],callback:function(o){var e;t.items[0]={type:"inline",src:(e=o,e||(e={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title">',e.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single" style="max-height:400px;overflow:auto">','<ul style="margin: 0; list-style: none;">',e.html||"","</ul>","</div>","</div>"].join(""))},t.updateItemHTML()}})})},e("popups/notification.global",["utils/popup"],function(){return joms.popup.notification.global}),window,joms.popup||(joms.popup={}),joms.popup.notification||(joms.popup.notification={}),joms.popup.notification.friend=function(){joms.util.popup.prepare(function(o){var t;t=o,joms.ajax({func:"notification,ajaxGetRequest",data:[""],callback:function(o){var e;t.items[0]={type:"inline",src:(e=o,e||(e={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title">',e.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single" style="max-height:400px;overflow:auto">','<ul style="margin: 0; list-style: none;">',e.html||"","</ul>","</div>","</div>"].join(""))},t.updateItemHTML()}})})},e("popups/notification.friend",["utils/popup"],function(){return joms.popup.notification.friend}),Wt=window,Kt=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.notification||(joms.popup.notification={}),joms.popup.notification.chat=(Jt=Wt,Xt=Kt,function(o){joms.util.popup.prepare(function(t){var e,s,n,p;e=t,s=Xt(o).next(".joms-popover--toolbar-chat"),(n={}).title=Jt.joms_lang&&joms_lang.COM_COMMUNITY_MESSAGE||"Message",n.html=s.html(),e.items[0]={type:"inline",src:(p=n,p||(p={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title">',p.title||"","</div>",'<div class="joms-popup__content joms-popup__content--single" style="max-height:400px;overflow:auto">','<ul style="margin: 0; list-style: none;">',p.html||"","</ul>","</div>","</div>"].join(""))},e.updateItemHTML()})}),e("popups/notification.chat",["utils/popup"],function(){return joms.popup.notification.chat}),window,joms.popup||(joms.popup={}),joms.popup.notification=(Zt=joms.popup.notification||{},joms._.extend({},Zt)),e("popups/notification",["popups/notification.global","popups/notification.friend","popups/notification.chat"],function(){return joms.popup.notification}),oe=window,te=joms.jQuery,joms.util||(joms.util={}),joms.util.phototag=function(o,t,e){var s,n,p,i,a,u,c,r;function m(e){var s,p,a,c;i||(i=o.joms_friends||[]),s=t(e?e.currentTarget:n.find("input")),p=s.val().replace(/^\s+|\s+$/g,"").toLowerCase(),a=i,a=(a=joms._.filter(i,function(o){return!(!o||!o.name||u&&u.indexOf(o.id+"")>=0||p&&o.name.toLowerCase().indexOf(p)<0)})).slice(0,8),(a=joms._.map(a,function(o){return'<a href="javascript:" data-id="'+o.id+'">'+o.name+"</a>"})).length?r=!1:(a=["<span><em>"+o.joms_lang.COM_COMMUNITY_NO_RESULT_FOUND+"</em></span>"],r=!0),(c=n.find(".joms-phototag__autocomplete")).html(a.join("")),c.append('<div><button class="joms-button--neutral joms-button--small joms-button--full">'+o.joms_lang.COM_COMMUNITY_PHOTO_DONE_TAGGING+"</button></div>"),c.show()}function l(o){var e,p,i,c,r,l,d,j,f=n.find(".joms-phototag__autocomplete"),v=t(o.currentTarget),b=v.data("id")||"";o.stopPropagation(),f.hide(),a&&a.tagAdded&&(u||(u=[]),u.push(b+""),i=s.width(),c=s.height(),p=n.position(),r=n.width(),l=n.height(),d=p.left,j=p.top,e={top:j/=c,left:d/=i,width:r/=i,height:l/=c},a.tagAdded(b,e.left,e.top,e.width,e.height),m())}function d(){t(".joms-phototag__tags").show(),n&&(n.remove(),s.remove(),t(o).off("resize.phototag"),n=e,p=e,a&&a.destroy&&a.destroy(),a=e)}function j(o){var t,e,s,n=p.height(),i=p.width();return c?(s=o.clientY-45-o.target.offsetTop-43,e=o.clientX-45-o.target.offsetLeft-43):(t=p.offset(),s=o.pageY-t.top-43,e=o.pageX-t.left-43),s=Math.max(0,Math.min(s,n-86)),e=Math.max(0,Math.min(e,i-86)),{top:s,left:e}}function f(o){var t;r?d():(t=j(o),n.css({top:t.top,left:t.left}))}return{populate:function(o,e){var s,n,i,a,u,c,r,m,l,d,j,f=".joms-phototag__tags";if(t(f).remove(),e&&e.length)for(p=t(o),(a=p.position()).top,a.left,u=p.width(),d=p.height(),(s=t("<div class="+f.substr(1)+"></div>")).css({top:0,left:0,right:0,bottom:0,margin:"auto",width:u,height:d}),s.insertAfter(p),j=0;j<e.length;j++)i=e[j],c=Math.round(d*i.top),r=Math.round(u*i.left),m=Math.round(u*i.width),l=Math.round(d*i.height),l=m=Math.max(10,Math.min(m,l)),(n=t("<div class="+".joms-phototag__tag".substr(1)+"><span>"+i.displayName+"</span></div>")).css({top:c+"px",left:r+"px",width:m+"px",height:l+"px"}),n.appendTo(s)},create:function(r,v,b,h,_){var g,w,k,y,x,C,M;d(),t(".joms-phototag__tags").hide(),s=t(["<div class=joms-phototag__wrapper>","<div class=joms-phototag>","<div class=joms-phototag__input>",'<input type=text placeholder="',o.joms_lang.COM_COMMUNITY_SEARCH,'">','<div class="joms-phototag__autocomplete"></div>',"</div>","</div>","</div>"].join("")),n=s.find(".joms-phototag"),p=t(r.target),i=e,a={},C=p.width(),M=p.height(),g=p.offset(),w=p.parent().offset(),y=g.top-w.top,x=g.left-w.left,u=v||[],c="page"!==b,n.css({top:0,left:0}),s.css({top:y,left:x,width:C,height:M}),s.insertAfter(p),k=j(r),n.css({top:k.top,left:k.left}),n.on("keyup","input",m),n.on("click","a[data-id]",l),n.on("click","button",d),n.on("click",function(o){o.stopPropagation()}),s.on("click",f),+h?joms.fn.tagging.fetchGroupMembers(h,function(o){i=o,m()}):+_?joms.fn.tagging.fetchEventMembers(_,function(o){i=o,m()}):m(),joms.mobile||t(o).on("resize.phototag",d)},destroy:d,on:function(o,t){a[o]=t},off:function(o){o?a[o]&&(a[o]=e):a={}}}}(oe,te),e("utils/phototag",function(){}),ee=window,se=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.open=function(o,t){var e,s,n,p,i,a,u,c,r,m,l,d,j,f,v,b,h,_,g,w,k,y,x,C,M,T,S,L,O,I,U,E,A,R,N='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-cog"></use></svg>',H='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-bubble"></use></svg>',P='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-thumbs-up"></use></svg>',$='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-tag"></use></svg>',Y='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-newspaper"></use></svg>';function Q(u,c,r){s&&s.off(),e=u,m=c,l=r,joms.ajax({func:"photos,ajaxGetPhotosByAlbum",data:[m,l],callback:function(u){var c,r,m,A,R;u||(u={}),f=u.lang||{},v=u.can_edit||!1,b=u.can_delete||!1,h=u.can_tag||!1,_=u.can_move_photo||!1,g=u.can_rotate||!1,w=u.album_name||"Untitled",k=u.album_url,y=u.photo_url,T=x=+u.my_id,C=+u.groupid,M=+u.eventid,S=T&&+u.my_id==+u.owner_id,L=+u.is_admin,O=!+u.deleteoriginalphotos,I=+u.enablereporting,U=+u.enablesharing,E=+u.enablelike,k&&(w='<a href="'+k+'">'+w+"</a>"),e.items[0]={type:"inline",src:u.error?(c=u,c||(c={}),c.title||(c.title="&nbsp;"),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',c.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',c.error,"</div>","</div>"].join("")):(r=u,R="",r||(r={}),m=r.error||"",A=r.error?"":r.commentHtml||"",r.error||(d=r.list||[],j=r.index||0,j=Math.min(d.length,j),m='<img src="'+d[j].url+'" data-index="'+j+'"><div class="joms-spinner" style="display:none"></div>',R=w+' <span class="joms-popup__optcapindex">'+(j+1)+" "+o.joms_lang.COM_COMMUNITY_OF+" "+d.length+"</span>"),['<div class="joms-popup joms-popup--photo">','<div class="joms-popup__commentwrapper">','<div class="joms-popup__content">',d&&d.length>1?'<button class="mfp-arrow mfp-arrow-left" type="button" title="'+f.prev+'"></button>':"",d&&d.length>1?'<button class="mfp-arrow mfp-arrow-right" type="button" title="'+f.next+'"></button>':"",m,'<div class="joms-popup__option clearfix">','<div class="joms-popup__optcaption">',R||"Untitled","</div>",'<div class="joms-popup__optoption">','<button class="joms-popup__btn-viewalbum" onclick="window.location=\'',k,"'\">",Y,' <span class="joms-popup__btn-overlay">',f.view_album,"</span></button>",'<button class="joms-popup__btn-comments">',H,' <span class="joms-popup__btn-overlay">',f.comments,"</span></button>",'<button class="joms-popup__btn-like"></button>',h?'<button class="joms-popup__btn-tag-photo">'+$+' <span class="joms-popup__btn-overlay">'+f.tag_photo+"</span></button>":"",'<div class="joms-popup__dropdown--wrapper"><div class="joms-popup__dropdown"></div><button class="joms-popup__btn-option">',N,' <span class="joms-popup__btn-overlay">',f.options,"</span></button></div>","</div>","</div>","</div>",'<div class="joms-popup__comment">',A,"</div>",'<button class="mfp-close" type="button" title="Close (Esc)">×</button>',"</div>","</div>"].join(""))},e.updateItemHTML(),e.close=oo,s=e.contentContainer,u.error||(n=s.find("img"),p=s.find(".joms-spinner"),i=s.find(".joms-popup__optcaption"),a=s.find(".joms-popup__btn-tag-photo"),s.on("click",".mfp-arrow-left",B),s.on("click",".mfp-arrow-right",D),s.on("click",".joms-popup__btn-tag-photo",G),s.on("click",".joms-popup__btn-comments",Z),s.on("click",".joms-popup__btn-comments .joms-icon",Z),s.on("click",".joms-popup__btn-option",to),s.on("click",".joms-popup__btn-share",so),s.on("click",".joms-popup__btn-download",no),s.on("click",".joms-popup__btn-report",po),s.on("click",".joms-popup__btn-upload",io),s.on("click",".joms-popup__btn-cover",ao),s.on("click",".joms-popup__btn-profile",uo),s.on("click",".joms-popup__btn-delete",co),s.on("click",".joms-popup__btn-move",ro),s.on("click",".joms-popup__btn-like",mo),s.on("click",".joms-popup__btn-dislike",lo),s.on("click",".joms-popup__btn-rotate-left",jo),s.on("click",".joms-popup__btn-rotate-right",fo),s.on("mouseleave",".joms-popup__dropdown--wrapper",eo),s.on("click",".joms-js--remove-tag",J),s.on("click",".joms-js--btn-desc-edit",_o),s.on("click",".joms-js--btn-desc-cancel",go),s.on("click",".joms-js--btn-desc-save",wo),t(document).off("keyup.photomodal").on("keyup.photomodal",function(o){var t=o.target.tagName.toLowerCase(),e=o.keyCode;"input"!==t&&"textarea"!==t&&(37!==e&&39!==e||(37===e&&j>0?B():39===e&&j<d.length-1&&D()))}),e.st.callbacks||(e.st.callbacks={}),e.st.callbacks.close=function(){t(document).off("keyup.photomodal")},l||(l=u.list[u.index].id),ho(l),q(),z())}})}function F(o,e){clearTimeout(A),clearTimeout(R),o.hide(),o.removeAttr("src"),R=setTimeout(function(){p.show()},100),A=setTimeout(function(){t("<img>").load(function(){clearTimeout(R),p.hide(),o.attr("src",e),o.show()}).attr("src",e)},1)}function B(){--j<0&&(j=d.length-1),l=d[j].id,F(n,d[j].url),i.html(w+' <span class="joms-popup__optcapindex">'+(j+1)+" "+o.joms_lang.COM_COMMUNITY_OF+" "+d.length+"</span>"),K(),ho(l),q(),z()}function D(){++j>=d.length&&(j=0),l=d[j].id,F(n,d[j].url),i.html(w+' <span class="joms-popup__optcapindex">'+(j+1)+" "+o.joms_lang.COM_COMMUNITY_OF+" "+d.length+"</span>"),K(),ho(l),q(),z()}function q(){var o=j<=0,t=j>=d.length-1;s.find(".mfp-arrow-left")[o?"hide":"show"](),s.find(".mfp-arrow-right")[t?"hide":"show"]()}function z(){var o=j<=0,t=j>=d.length-1;o||((new Image).src=d[j-1].url),t||((new Image).src=d[j+1].url)}function G(){a.data("tagging")?K():(a.data("tagging",1),s.find(".joms-phototag__tags").hide(),s.children(".joms-popup--photo").addClass("joms-popup--phototag"),n.off("click.phototag").on("click.phototag",V),n.addClass("joms-phototag__image"),s.find(".joms-popup__btn-tag-photo").html($+" "+f.done_tagging))}function V(o){var t=joms._.map(u,function(o){return o.userId+""});joms.util.phototag.create(o,t,!1,C,M),joms.util.phototag.on("tagAdded",W),joms.util.phototag.on("destroy",function(){a.removeData("tagging"),s.children(".joms-popup--photo").removeClass("joms-popup--phototag"),n.off("click.phototag"),n.removeClass("joms-phototag__image"),s.find(".joms-popup__btn-tag-photo").html($+' <span class="joms-popup__btn-overlay">'+f.tag_photo+"</span>")}),s.children(".joms-popup--photo").removeClass("joms-popup--phototag"),n.off("click.phototag")}function W(t,e,n,p,i){joms.ajax({func:"photos,ajaxAddPhotoTag",data:[l,t,n,e,p,i],callback:function(t){t.error?o.alert(bo(t.error)):t.success&&(u.push(t.data),s.find(".joms-popup__comment").find(".joms-js--tag-info").html(X()))}})}function K(){joms.util.phototag.destroy()}function J(e){var n=t(e.currentTarget),p=n.data("id");joms.ajax({func:"photos,ajaxRemovePhotoTag",data:[l,p],callback:function(t){var e;if(t.error)o.alert(bo(t.error));else if(t.success){for(e=0;e<u.length;e++)+p==+u[e].userId&&u.splice(e--,1);s.find(".joms-popup__comment").find(".joms-js--tag-info").html(X())}}})}function X(){var o,t,e,s;if(u&&u.length||(u=[]),joms.util.phototag.populate(n,u,"page"),!u.length)return"";for(o=[],s=0;s<u.length;s++)t=u[s],e='<a href="'+t.profileUrl+'">'+t.displayName+"</a>",t.canRemove&&(e+=' (<a href="javascript:" class="joms-js--remove-tag" data-id="'+t.userId+'">'+r+"</a>)"),o.push(e);return o=o.join(", "),o=c+"<br>"+o}function Z(o){o.stopPropagation(),s.children(".joms-popup").toggleClass("joms-popup--togglecomment")}function oo(){var o=s.children(".joms-popup"),e="joms-popup--togglecomment";o.hasClass(e)?o.removeClass(e):t.magnificPopup.proto.close.call(this)}function to(o){var e=t(o.target).closest(".joms-popup__dropdown--wrapper"),s=e.children(".joms-popup__dropdown");s.toggleClass("joms-popup__dropdown--open")}function eo(o){var e=t(o.target).closest(".joms-popup__dropdown--wrapper"),s=e.children(".joms-popup__dropdown");s.removeClass("joms-popup__dropdown--open")}function so(){joms.api.pageShare(y.replace("___photo_id___",l))}function no(){o.open(d[j].original)}function po(){joms.api.photoReport(x,y.replace("___photo_id___",l))}function io(){joms.api.photoUpload(m)}function ao(){joms.ajax({func:"photos,ajaxConfirmDefaultPhoto",data:[m,l],callback:function(t){t.error?o.alert(bo(t.error)):o.confirm(bo(t.message))&&joms.ajax({func:"photos,ajaxSetDefaultPhoto",data:[m,l],callback:function(t){o.alert(bo(t.error||t.message))}})}})}function uo(){joms.ajax({func:"photos,ajaxLinkToProfile",data:[l],callback:function(e){var s,n;if(e.error)o.alert(bo(e.error));else if(o.confirm(bo(e.message))){for(n in e.formParams||(e.formParams={}),s=t('<form method=post action="'+e.formUrl+'" style="width:1px; height:1px; position:absolute"/>'),e.formParams)s.append('<input type=hidden name="'+n+'" value="'+e.formParams[n]+'"/>');s.appendTo(document.body),s[0].submit()}}})}function co(){joms.ajax({func:"photos,ajaxConfirmRemovePhoto",data:[l],callback:function(t){t.error?o.alert(bo(t.error)):o.confirm(bo(t.message))&&joms.ajax({func:"photos,ajaxRemovePhoto",data:[l],callback:function(t){t.error?o.alert(bo(t.error)):(s.off(),e.close(),o.location.reload())}})}})}function ro(){joms.api.photoSetAlbum(l)}function mo(){}function lo(){}function jo(){vo("left")}function fo(){vo("right")}function vo(o){var t=d[j]&&d[j].id;t&&joms.ajax({func:"photos,ajaxRotatePhoto",data:[t,o],callback:function(o){joms._.extend(d[j],o||{}),n.attr("src",d[j].url)}})}function bo(o){return o=o.replace(/<\/?[^>]+>/g,"")}function ho(o,e){var n=s.find(".joms-popup__comment");e||n.empty(),joms.ajax({func:"photos,ajaxSwitchPhotoTrigger",data:[o,e?1:0],callback:function(o){var p,i,a,m,d,j,w,k,y,x,C;e||o.comments&&o.showall&&(o.showall='<div class="joms-comment__more joms-js--more-comments"><a href="javascript:">'+o.showall+"</a></div>",o.comments=t(t.trim(o.comments)),o.comments.prepend(o.showall)),e?n.find(".joms-comment").replaceWith(o.comments):(n.html(o.head||""),n.append(o.comments),n.append(o.form||""),u=o.tagged||[],c=o.tagLabel||"",r=o.tagRemoveLabel||"",v=void 0===o.can_edit?v:o.can_edit,b=void 0===o.can_delete?b:o.can_delete,h=void 0===o.can_tag?h:o.can_tag,_=void 0===o.can_move_photo?_:o.can_move_photo,g=void 0===o.can_rotate?g:o.can_rotate,n.find(".joms-js--description").html(("object"!=typeof(x=o.description||{})&&(x={}),['<div class="joms-js--btn-desc-content">',x.content||"","</div>",'<div class="joms-js--btn-desc-editor joms-popup__hide">','<textarea class="joms-textarea" style="margin:0" placeholder="',x.lang_placeholder||"",'">',(C=x.content||"",C=(C=C||"").replace(/<br\s*\/?>/g,"\n")),"</textarea>",'<div style="margin-top:5px;text-align:right">','<button class="joms-button--neutral joms-button--small joms-js--btn-desc-cancel">',x.lang_cancel||"Cancel","</button> ",'<button class="joms-button--primary joms-button--small joms-js--btn-desc-save">',x.lang_save||"Save","</button>","</div>","</div>",'<div class="joms-js--btn-desc-edit"',v?"":' style="display:none"','><a href="javascript:"',' data-lang-add="',x.lang_add||"Add description",'"',' data-lang-edit="',x.lang_edit||"Edit description",'">',x.content?x.lang_edit:x.lang_add,"</a>","</div>"].join(""))),p=!!g,i=s.find(".joms-popup__btn-rotate-toggle"),"boolean"==typeof p&&(p?i.show():i.hide()),n.find(".joms-js--tag-info").html(X()),n.find(".joms-js--comments,.joms-js--newcomment").find("textarea.joms-textarea"),joms.fn.tagging.initInputbox()),k="",y="",(d=o)||(d={}),w=d.is_photo_owner,U&&(k+='<a href="javascript:" class="joms-popup__btn-share">'+f.share+"</a>"),O&&(k+='<a href="javascript:" class="joms-popup__btn-download">'+f.download+"</a>"),S||L||w?(k+=U||O?'<div class="sep"></div>':"",k+=S?'<a href="javascript:" class="joms-popup__btn-upload">'+f.upload_photos+"</a>":"",k+=S?'<div class="sep"></div>':"",k+=S?'<a href="javascript:" class="joms-popup__btn-profile">'+f.set_as_profile_picture+"</a>":"",k+=S||L?'<a href="javascript:" class="joms-popup__btn-cover">'+f.set_as_album_cover+"</a>":"",k+=b?'<a href="javascript:" class="joms-popup__btn-delete">'+f.delete_photo+"</a>":"",k+=_||w?'<a href="javascript:" class="joms-popup__btn-move">'+f.move_to_another_album+"</a>":"",k+=g?'<div class="sep joms-popup__btn-rotate-toggle"></div>':"",k+=g?'<a href="javascript:" class="joms-popup__btn-rotate-left joms-popup__btn-rotate-toggle">'+f.rotate_left+"</a>":"",k+=g?'<a href="javascript:" class="joms-popup__btn-rotate-right joms-popup__btn-rotate-toggle">'+f.rotate_right+"</a>":""):(k+=b?'<a href="javascript:" class="joms-popup__btn-delete">'+f.delete_photo+"</a>":"",k+=I?'<a href="javascript:" class="joms-popup__btn-report">'+f.report+"</a>":""),k='<div class="joms-popup__dropdown"><div class="joms-popup__ddcontent">'+k+"</div></div>",E&&d&&d.like&&(y+='<button class="joms-popup__btn-like joms-js--like-photo-'+l+(d.like.is_liked?" liked":"")+'"',y+=' onclick="joms.api.page'+(d.like.is_liked?"Unlike":"Like")+"('photo', '"+l+"');\"",y+=' data-lang="'+(d.like.lang||"Like")+'"',y+=' data-lang-like="'+(d.like.lang_like||"Like")+'"',y+=' data-lang-liked="'+(d.like.lang_liked||"Liked")+'">',y+=P+" ",y+="<span>",y+=d.like.is_liked?d.like.lang_liked:d.like.lang_like,(j=+d.like.count)>0&&(y+=" ("+j+")"),y+="</span></button>"),s.find(".joms-popup__dropdown").replaceWith(k),s.find(".joms-popup__btn-like").replaceWith(y),a=".joms-js--video",(m=t(".joms-comment__body,.joms-js--inbox").find(a).not(".joms-js--initialized")).length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),m.on("click.joms-video",a+"-play",function(){var o=t(this).closest(a);joms.util.video.play(o,o.data())}),joms.ios&&setTimeout(function(){m.find(a+"-play").click()},2e3))}})}function _o(){s.find(".joms-js--btn-desc-content").hide(),s.find(".joms-js--btn-desc-edit").hide(),s.find(".joms-js--btn-desc-editor").show()}function go(){s.find(".joms-js--btn-desc-editor").hide(),s.find(".joms-js--btn-desc-content").show(),s.find(".joms-js--btn-desc-edit").show()}function wo(){var e=s.find(".joms-js--btn-desc-content"),n=s.find(".joms-js--btn-desc-editor"),p=s.find(".joms-js--btn-desc-edit"),i=n.find("textarea"),a=t.trim(i.val());joms.ajax({func:"photos,ajaxSaveCaption",data:[l,a],callback:function(t){var s=p.find("a");t.error?o.alert(t.error):t.success&&(n.hide(),e.html(t.caption).show(),s.html(s.data("lang-"+(a?"edit":"add"))),p.show())}})}return joms._.debounce(function(o,t){joms.util.popup.prepare(function(e){Q(e,o,t)})},200)}(ee,se),e("popups/photo.open",["utils/popup","utils/phototag"],function(){return joms.popup.photo.open}),ne=window,pe=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.remove=function(o,t){var e,s,n;function p(){s.off(),e.close()}function i(){joms.ajax({func:"photos,ajaxRemovePhoto",data:[n],callback:function(e){var i;e.error?(s.find(".joms-js--step1").hide(),s.find(".joms-js--step2").show().children().html(e.error||e.message)):(i=t(".joms-js--photo-"+n)).length&&i.siblings().length?(i.remove(),p()):o.location.reload()}})}return function(o){joms.util.popup.prepare(function(t){var a,u;a=t,u=o,s&&s.off(),e=a,n=u,joms.ajax({func:"photos,ajaxConfirmRemovePhoto",data:[n],callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-js--step1',t.error?" joms-popup__hide":"",'">','<div class="joms-popup__content joms-popup__content--single">',t.message,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',t.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',t.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2',t.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',t.error||"","</div>","</div>","</div>"].join(""))},e.updateItemHTML(),(s=e.contentContainer).on("click",".joms-js--button-cancel",p),s.on("click",".joms-js--button-save",i)}})})}}(ne,pe),e("popups/photo.remove",["utils/popup"],function(){return joms.popup.photo.remove}),window,joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.report=function(){var o,t,e,s;function n(o){t.find("textarea").val(o.target.value)}function p(){t.off(),o.close()}function i(){var o;(o=(o=t.find("textarea").val()).replace(/^\s+|\s+$/g,""))?(t.find(".joms-js--error").hide(),joms.ajax({func:"system,ajaxSendReport",data:["photos,reportPhoto",s||window.location.href,o,e],callback:function(o){t.find(".joms-js--step1").hide(),t.find(".joms-js--step2").show().children().html(o.error||o.message)}})):t.find(".joms-js--error").show()}return function(a,u){joms.util.popup.prepare(function(c){var r,m,l;r=c,m=a,l=u,t&&t.off(),o=r,e=m,s=l,joms.ajax({func:"system,ajaxReport",data:[],callback:function(e){var s;o.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-js--step1',s.error?" joms-popup__hide":"",'">',s.html,'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',s.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',s.btnSend,"</button>","</div>","</div>",'<div class="joms-js--step2',s.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',s.error||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("change","select",n),t.on("click",".joms-js--button-cancel",p),t.on("click",".joms-js--button-save",i)}})})}}(),e("popups/photo.report",["utils/popup"],function(){return joms.popup.photo.report}),window,ie=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.setAvatar=function(o,t){var e,s,n,p,i;function a(){s.off(),e.close()}function u(){var o,e=t('<form method=post action="'+p+'" style="width:1px; height:1px; position:absolute"/>');for(o in i)e.append('<input type=hidden name="'+o+'" value="'+i[o]+'"/>');e.appendTo(document.body),e[0].submit()}return function(o){joms.util.popup.prepare(function(t){var c,r;c=t,r=o,s&&s.off(),e=c,n=r,joms.ajax({func:"photos,ajaxLinkToProfile",data:[n],callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-js--step1',t.error?" joms-popup__hide":"",'">','<div class="joms-popup__content">',t.message,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',t.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',t.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2',t.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',t.error||"","</div>","</div>","</div>"].join(""))},e.updateItemHTML(),p=o.formUrl||"",i=o.formParams||{},(s=e.contentContainer).on("click",".joms-js--button-cancel",a),s.on("click",".joms-js--button-save",u)}})})}}(0,ie),e("popups/photo.setavatar",["utils/popup"],function(){return joms.popup.photo.setAvatar}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.setCover=function(){var o,t,e,s;function n(){t.off(),o.close()}function p(){joms.ajax({func:"photos,ajaxSetDefaultPhoto",data:[e,s],callback:function(o){t.find(".joms-js--step1").hide(),t.find(".joms-js--step2").show().children().html(o.error||o.message)}})}return function(i,a){joms.util.popup.prepare(function(u){var c,r,m;c=u,r=i,m=a,t&&t.off(),o=c,e=r,s=m,joms.ajax({func:"photos,ajaxConfirmDefaultPhoto",data:[e,s],callback:function(e){var s;o.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-js--step1',s.error?" joms-popup__hide":"",'">','<div class="joms-popup__content">',s.message,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',s.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',s.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2',s.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',s.error||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click",".joms-js--button-cancel",n),t.on("click",".joms-js--button-save",p)}})})}}(),e("popups/photo.setcover",["utils/popup"],function(){return joms.popup.photo.setCover}),ae=window,ue=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.upload=function(o,t){var e,s,n,p,i,a,u,c,r,m;function l(o){var e=s.find(".joms-js--btn-create"),n=s.find(".joms-js--btn-add"),p=t(o.target),i=p.attr("href");m||i.match(/select-album/)?(e.hide(),n.show()):(n.hide(),e.show())}function d(o){var t=s.find(".joms-js--form-toggle");"show"!==o&&"hide"!==o&&(o=t.data("hidden")?"show":"hide"),"show"===o?(t.removeData("hidden"),s.find(".joms-js--thumbnails").hide(),s.find(".joms-js--form-detail").css({height:""})):"hide"===o&&(t.data("hidden","hidden"),s.find(".joms-js--form-detail").css({height:0}),s.find(".joms-js--thumbnails").show())}function j(){var e=t.trim(s.find("[name=name]").val()),n=t.trim(s.find("[name=location]").val()),p=t.trim(s.find("[name=description]").val()),i=s.find("[name=permissions]").val(),r=s.find("[name=name]").siblings(".joms-help").hide(),l=s.find(".joms-js--btn-create img");e.length?l.is(":visible")||(l.show(),joms.ajax({func:"photos,ajaxCreateAlbum",data:[e,u||"",c||"",n||"",p||"",i||""],callback:joms._.debounce(function(t){l.hide(),t.error?o.alert(t.error):t.albumid&&(a=m=t.albumid,s.find(".joms-js--btn-create").hide(),s.find(".joms-js--btn-add").show(),s.find("#joms-js__new-album").find("input.joms-input, textarea.joms-textarea, select.joms-select").attr("disabled","disabled"),d("hide"))},500)})):r.show()}function f(){v(function(){p.click()})}function v(e){"function"!=typeof e&&(e=function(){}),n?e():joms.util.loadLib("plupload",function(){var s;s=t('<div id="joms-js--photoupload-uploader" aria-hidden="true" style="width:1px; height:1px; overflow:hidden">').appendTo(document.body),t('<button id="joms-js--photoupload-uploader-button">').appendTo(s),(n=new o.plupload.Uploader({url:"index.php?option=com_community&view=photos&task=multiUpload",filters:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}],container:"joms-js--photoupload-uploader",browse_button:"joms-js--photoupload-uploader-button",runtimes:"html5,html4"})).bind("FilesAdded",b),n.bind("Error",h),n.bind("UploadProgress",_),n.bind("FileUploaded",g),n.bind("uploadComplete",w),n.init(),p=s.find("input[type=file]"),e()})}function b(o,t){var e,p="";for(e=0;e<t.length;e++)p+='<li class="joms-gallery__item joms-file--'+t[e].id+'">',p+='<div class="joms-gallery__thumbnail"><img src="'+joms.ASSETS_URL+'photo_thumb.png"></div>',p+='<div class="joms-gallery__body">',p+='<a class="joms-gallery__title">'+t[e].name+"</a> <span>("+Math.round(t[e].size/1024)+" KB)</span>",p+='<div class="joms-progressbar"><div class="joms-progressbar__progress" style="width:0%"></div></div>',p+="</div>",p+="</li>";i.append(p),s.find(".joms-js--btn-add").css({visibility:"visible"}),s.find(".joms-js--btn-view").hide(),setTimeout(function(){s.find("[name=name]").is(":visible")?m&&(a=m):a=s.find("[name=album-id]").val(),s.find(".joms-js--btn-add").css({visibility:"hidden"}),s.find(".joms-js--btn-view").hide(),n.settings.url=joms.BASE_URL+"index.php?option=com_community&view=photos&task=multiUpload&albumid="+a,n.refresh(),n.start()},1e3)}function h(){}function _(o,t){var e;e=Math.min(100,Math.floor(t.loaded/t.size*100)),s.find(".joms-file--"+t.id).find(".joms-progressbar__progress").stop().animate({width:e+"%"})}function g(t,e,p){var i,a={};try{a=JSON.parse(p.response)}catch(o){}if(a.error)return n.stop(),a.canContinue?s.find(".joms-js--btn-add").css({visibility:"visible"}):s.find(".joms-js--btn-add").css({visibility:"hidden"}),(i=s.find(".joms-file--"+e.id)).prevAll().length&&s.find(".joms-js--btn-view").show(),i.nextAll().andSelf().remove(),void o.alert(a.msg);a.info&&(r.push({photoId:a.photoId}),(i=(i=s.find(".joms-file--"+e.id)).find("img")).attr("src",a.info),s.find(".joms-js--btn-add").html(s.find(".joms-js--btn-add").data("lang-more")),s.find(".joms-js--btn-view").show(),s.off("click",".joms-tab__bar a"),s.find(".joms-tab__bar a").removeAttr("href"),s.find("input.joms-input, textarea.joms-textarea, select.joms-select").attr("disabled","disabled"))}function w(){s.find(".joms-js--btn-add").css({visibility:"visible"}),s.find(".joms-js--btn-view").show(),joms.ajax({func:"photos,ajaxUpdateCounter",data:[a,JSON.stringify({files:r})],callback:function(){}})}function k(){joms.ajax({func:"photos,ajaxGetAlbumURL",data:[a||"",u||"",c||""],callback:function(t){t.url&&(o.location=t.url)}})}return function(o,t,n){joms.util.popup.prepare(function(p){var m,b,h,_,g;m=p,b=o,h=t,_=n,s&&s.off(),e=m,c=_||!1,u=h||!1,(g=[]).push((a=b||!1)||""),g.push(u||""),g.push(c||""),joms.ajax({func:"photos,ajaxUploadPhoto",data:g,callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--photoupload">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",t.html,"</div>"].join(""))},e.updateItemHTML(),o.lang,s=e.contentContainer,i=s.find(".joms-gallery"),r=[],s.on("click",".joms-tab__bar a",l),s.on("click",".joms-js--form-toggle",d),s.on("click",".joms-js--btn-create",j),s.on("click",".joms-js--btn-add",f),s.on("click",".joms-js--btn-view",k),v()}})})}}(ae,ue),e("popups/photo.upload",["utils/loadlib","utils/popup"],function(){return joms.popup.photo.upload}),ce=window,re=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.zoom=(me=ce,le=re,fe=joms._.debounce(function(){var o=de.find(".joms-popup").css({position:"",display:"",top:"",width:""}),t=o.find("img").css({height:""});de.find(".joms-popup-wrapper").length&&(de.find(".joms-popup-wrapper .mfp-close").appendTo(o),o.unwrap()),setTimeout(function(){var e=+t.height(),s=+de.height();e=e&&e<s?"":s,t.css("height",e),setTimeout(function(){o.css({position:"relative",width:t.width()})},1)},1)},100),function(o){joms.util.popup.prepare(function(t){var e,s,n,p;s=o,n="resize.joms-photozoom",(e=t).items[0]={type:"inline",src:(p=s,['<div class="joms-popup-wrapper" style="width:100%;height:100%;margin:0 auto;text-align:center">','<div class="joms-popup" style="max-width:100%;left:auto;right:auto;position:relative;display:inline;top:0">','<img src="'+(p=(p=p||"").replace("thumb_",""))+'" style="width:auto;max-width:100%">',"</div>","</div>"].join(""))},de=e.container,je=le(me),setTimeout(function(){de.find(".joms-popup img").one("load",fe).each(function(){this.complete&&le(this).load()})},1),je.off(n).on(n,fe),e.updateItemHTML(),e.st.callbacks||(e.st.callbacks={}),e.st.callbacks.close=function(){je.off(n)}})}),e("popups/photo.zoom",["utils/popup"],function(){return joms.popup.photo.zoom}),window,ve=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.photo||(joms.popup.photo={}),joms.popup.photo.setAlbum=function(o,t){var e,s,n;function p(){s.off(),e.close()}function i(){var o=s.find("[name=albumid]").val();joms.ajax({func:"photos,ajaxConfirmPhotoAlbum",data:[o,n.join(",")],callback:function(o){var e,n,p=[];if(o.message&&p.push(o.message),o.moved&&o.moved.length)for(n=0;n<o.moved.length;n++)(e=t(".joms-js--album-"+o.moved[n].old_album)).length&&e.find(".joms-js--photo-"+o.moved[n].id).remove();if("[object Array]"===Object.prototype.toString.call(o.error)){if(o.error.length){for(n=0;n<o.error.length;n++)o.error[n]="<li>ID: "+o.error[n][0]+" - "+o.error[n][1]+"</li>";p.push("<ul>"+o.error.join("")+"</ul>")}}else"string"==typeof o.error&&p.push(o.error);s.find(".joms-js--step1").hide(),s.find(".joms-js--step2").show().children().html(p.join("<br/>"))}})}return function(o){joms.util.popup.prepare(function(t){var a,u;a=t,u=o,s&&s.off(),e=a,n=u,"[object Array]"!==Object.prototype.toString.call(n)&&(n=[n]),joms.ajax({func:"photos,ajaxSetPhotoAlbum",data:[n.join(",")],callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-js--step1',t.error?" joms-popup__hide":"",'">','<div class="joms-popup__content joms-popup__content--single">',t.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',t.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',t.btnYes,"</button>","</div>","</div>",'<div class="joms-js--step2',t.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',t.error||"","</div>","</div>","</div>"].join(""))},e.updateItemHTML(),(s=e.contentContainer).on("click",".joms-js--button-cancel",p),s.on("click",".joms-js--button-save",i)}})})}}(0,ve),e("popups/photo.setalbum",["utils/popup"],function(){return joms.popup.photo.setAlbum}),window,joms.popup||(joms.popup={}),joms.popup.photo=(be=joms.popup.photo||{},joms._.extend({},be)),e("popups/photo",["popups/photo.open","popups/photo.remove","popups/photo.report","popups/photo.setavatar","popups/photo.setcover","popups/photo.upload","popups/photo.zoom","popups/photo.setalbum"],function(){return joms.popup.photo}),window,joms.popup||(joms.popup={}),joms.popup.pm||(joms.popup.pm={}),joms.popup.pm.send=function(){var o,t,e;function s(){t.off(),o.close()}function n(){var o,s,n=t.find("[name=body]").val(),p=t.find(".joms-textarea__attachment"),i={};n=n.replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/&quot;/g,'"'),t.data("saving")||(t.data("saving",1),p.is(":visible")&&(o=p.find(".joms-textarea__attachment--thumbnail img"),s=o.siblings("b"),o.is(":visible")&&o.attr("src")?i={type:"image",id:o.data("photo_id")}:s.is(":visible")&&(i={type:"file",id:s.data("id")})),joms.ajax({func:"chat,ajaxPrivateMessageSend",data:[e,n,JSON.stringify(i)],callback:function(o){var e=t.find("[data-ui-object=popup-step-1]"),s=t.find("[data-ui-object=popup-step-2]");t.removeData("saving"),s.find("[data-ui-object=popup-message]").html(o),e.hide(),s.show()}}))}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"inbox,ajaxCompose",data:[e],callback:function(e){var p;o.items[0]={type:"inline",src:(p=e,p||(p={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div data-ui-object="popup-step-1"',p.error?' class="joms-popup__hide"':"",">",p.html||"",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',p.btnCancel,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',p.btnSend,"</button>","</div>","</div>",'<div data-ui-object="popup-step-2"',p.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single" data-ui-object="popup-message">',p.error||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).find("textarea.joms-textarea").jomsTagging(),t.on("click","[data-ui-object=popup-button-cancel]",s),t.on("click","[data-ui-object=popup-button-save]",n)}})})}}(),e("popups/pm.send",["utils/popup"],function(){return joms.popup.pm.send}),window,joms.popup||(joms.popup={}),joms.popup.pm=(he=joms.popup.pm||{},joms._.extend({},he)),e("popups/pm",["popups/pm.send"],function(){return joms.popup.pm}),window,_e=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.search||(joms.popup.search={}),joms.popup.search.save=function(o,t){var e,s,n;function p(){s.off(),e.close()}function i(){var o=s.find("[name=title]"),e=s.find("[name=description]"),n=!1;t.trim(o.val())?o.siblings(".joms-help").hide():(o.siblings(".joms-help").show(),n=!0),t.trim(e.val())?e.siblings(".joms-help").hide():(e.siblings(".joms-help").show(),n=!0),n||s.find("form").submit()}return function(o){joms.util.popup.prepare(function(t){!function(o,t){var a,u,c,r,m,l;for(s&&s.off(),e=o,a=(n=t||{}).json||{},u=(n.keys||"").split(","),r=[],l=0;l<u.length;l++)c=u[l],m="date"===a["fieldType"+c]||"birthdate"===a["fieldType"+c]||"between"===a["condition"+c]?a["value"+c]+","+a["value"+c+"_2"]:a["value"+c],r[l]=["field="+a["field"+c]+",condition="+a["condition"+c]+",fieldType="+a["fieldType"+c]+",value="+m];joms.ajax({func:"memberlist,ajaxShowSaveForm",data:[n.operator,n.avatar_only?1:0].concat(r),callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-js--step1',t.error?" joms-popup__hide":"",'">','<div class="joms-popup__content">',t.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',t.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',t.btnSave,"</button>","</div>","</div>",'<div class="joms-js--step2',t.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',t.error||"","</div>","</div>","</div>"].join(""))},e.updateItemHTML(),(s=e.contentContainer).on("click",".joms-js--button-cancel",p),s.on("click",".joms-js--button-save",i)}})}(t,o)})}}(0,_e),e("popups/search.save",[],function(){return joms.popup.search.save}),window,joms.popup||(joms.popup={}),joms.popup.search=(ge=joms.popup.search||{},joms._.extend({},ge)),e("popups/search",["popups/search.save"],function(){return joms.popup.search}),window,joms.popup||(joms.popup={}),joms.popup.tnc=function(){joms.util.popup.prepare(function(o){we=o,joms.ajax({func:"register,ajaxShowTnc",data:[0],callback:function(o){var t;we.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single" style="max-height:400px;overflow:auto;">',t.html||"&nbsp;","</div>","</div>"].join(""))},we.updateItemHTML()}})})},e("popups/tnc",function(){}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.changeVanityURL=function(){var o,t,e;function s(){t.off(),o.close()}function n(){t.find("form").submit()}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"profile,ajaxUpdateURL",data:[e],callback:function(e){var p,i;o.items[0]={type:"inline",src:(p=e,i="",p||(p={}),p.btnUpdate&&p.btnCancel&&(i=['<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',p.btnCancel,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',p.btnUpdate,"</button>","</div>"].join("")),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div class="joms-popup__content">',p.html||p.message,"</div>",i,"</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click","[data-ui-object=popup-button-cancel]",s),t.on("click","[data-ui-object=popup-button-save]",n)}})})}}(),e("popups/user.changevanityurl",["utils/popup"],function(){return joms.popup.user.changeVanityURL}),ke=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.addFeatured=function(o){var t,e,s;function n(n,p){e&&e.off(),t=n,s=p,joms.ajax({func:"search,ajaxAddFeatured",data:[s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()},t.updateItemHTML()}})}return function(o){joms.util.popup.prepare(function(t){n(t,o)})}}(ke),e("popups/user.addfeatured",["utils/popup"],function(){return joms.popup.user.addFeatured}),ye=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.removeFeatured=function(o){var t,e,s;function n(n,p){e&&e.off(),t=n,s=p,joms.ajax({func:"search,ajaxRemoveFeatured",data:[s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()},t.updateItemHTML()}})}return function(o){joms.util.popup.prepare(function(t){n(t,o)})}}(ye),e("popups/user.removefeatured",["utils/popup"],function(){return joms.popup.user.removeFeatured}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.ban=function(){var o,t,e;function s(){t.off(),o.close()}function n(){t.find("form").submit()}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"profile,ajaxBanUser",data:[e,0],callback:function(e){var p,i;o.items[0]={type:"inline",src:(p=e,i="",p||(p={}),p.error||(i=['<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',p.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',p.btnYes,"</button>","</div>"].join("")),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div class="joms-popup__content',p.error?" joms-popup__content--single":"",'">',p.html||p.error,"</div>",i,"</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click","[data-ui-object=popup-button-cancel]",s),t.on("click","[data-ui-object=popup-button-save]",n)}})})}}(),e("popups/user.ban",["utils/popup"],function(){return joms.popup.user.ban}),window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.unban=function(){var o,t,e;function s(){t.off(),o.close()}function n(){t.find("form").submit()}return function(p){joms.util.popup.prepare(function(i){var a,u;a=i,u=p,t&&t.off(),o=a,e=u,joms.ajax({func:"profile,ajaxBanUser",data:[e,1],callback:function(e){var p,i;o.items[0]={type:"inline",src:(p=e,i="",p||(p={}),p.error||(i=['<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',p.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',p.btnYes,"</button>","</div>"].join("")),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',p.title,"</div>",'<div class="joms-popup__content',p.error?" joms-popup__content--single":"",'">',p.html||p.error,"</div>",i,"</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("click","[data-ui-object=popup-button-cancel]",s),t.on("click","[data-ui-object=popup-button-save]",n)}})})}}(),e("popups/user.unban",["utils/popup"],function(){return joms.popup.user.unban}),xe=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.block=function(o){var t,e,s;function n(){e.off(),t.close()}function p(){joms.ajax({func:"profile,ajaxBlockUser",data:[s],callback:function(s){if(!s.success)return e.find(".joms-popup__action").hide(),void e.find(".joms-popup__content").html(s.error);t.close(),o.location.reload()}})}return function(o){joms.util.popup.prepare(function(i){var a,u;a=i,u=o,e&&e.off(),t=a,s=u,joms.ajax({func:"profile,ajaxConfirmBlockUser",data:[s],callback:function(o){var s,i;t.items[0]={type:"inline",src:(s=o,s||(s={}),i=s.error?['<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-cancel">',s.btnClose,"</button>","</div>"].join(""):['<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',s.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',s.btnYes,"</button>","</div>"].join(""),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content">',s.error||s.html||s.message,"</div>",i,"</div>"].join(""))},t.updateItemHTML(),(e=t.contentContainer).on("click",".joms-js--button-cancel",n),e.on("click",".joms-js--button-save",p)}})})}}(xe),e("popups/user.block",["utils/popup"],function(){return joms.popup.user.block}),Ce=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.unblock=function(o){var t,e,s;function n(){e.off(),t.close()}function p(){joms.ajax({func:"profile,ajaxUnblockUser",data:[s],callback:function(s){if(!s.success)return e.find(".joms-popup__action").hide(),void e.find(".joms-popup__content").html(s.error);t.close(),o.location.reload()}})}return function(o){joms.util.popup.prepare(function(i){var a,u;a=i,u=o,e&&e.off(),t=a,s=u,joms.ajax({func:"profile,ajaxConfirmUnBlockUser",data:[s],callback:function(o){var s;t.items[0]={type:"inline",src:(s=o,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content">',s.html||s.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',s.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',s.btnYes,"</button>","</div>","</div>"].join(""))},t.updateItemHTML(),(e=t.contentContainer).on("click","[data-ui-object=popup-button-cancel]",n),e.on("click","[data-ui-object=popup-button-save]",p)}})})}}(Ce),e("popups/user.unblock",["utils/popup"],function(){return joms.popup.user.unblock}),Me=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.ignore=function(o){var t,e,s;function n(){e.off(),t.close()}function p(){joms.ajax({func:"profile,ajaxIgnoreUser",data:[s],callback:function(s){if(!s.success)return e.find(".joms-popup__action").hide(),void e.find(".joms-popup__content").html(s.error);t.close(),o.location.reload()}})}return function(o){joms.util.popup.prepare(function(i){var a,u;a=i,u=o,e&&e.off(),t=a,s=u,joms.ajax({func:"profile,ajaxConfirmIgnoreUser",data:[s],callback:function(o){var s;t.items[0]={type:"inline",src:(s=o,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content">',s.html||s.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',s.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',s.btnYes,"</button>","</div>","</div>"].join(""))},t.updateItemHTML(),(e=t.contentContainer).on("click","[data-ui-object=popup-button-cancel]",n),e.on("click","[data-ui-object=popup-button-save]",p)}})})}}(Me),e("popups/user.ignore",["utils/popup"],function(){return joms.popup.user.ignore}),window,joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.report=function(){var o,t,e;function s(o){t.find("textarea").val(o.target.value)}function n(){t.off(),o.close()}function p(){var o;(o=(o=t.find("textarea").val()).replace(/^\s+|\s+$/g,""))?(t.find(".joms-js--error").hide(),joms.ajax({func:"system,ajaxSendReport",data:["profile,reportProfile",window.location.href,o,e],callback:function(o){t.find(".joms-js--step1").hide(),t.find(".joms-js--step2").show().children().html(o.error||o.message)}})):t.find(".joms-js--error").show()}return function(i){joms.util.popup.prepare(function(a){var u,c;u=a,c=i,t&&t.off(),o=u,e=c,joms.ajax({func:"system,ajaxReport",data:[],callback:function(e){var i;o.items[0]={type:"inline",src:(i=e,i||(i={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',i.title,"</div>",'<div class="joms-js--step1',i.error?" joms-popup__hide":"",'">',i.html,'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',i.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',i.btnSend,"</button>","</div>","</div>",'<div class="joms-js--step2',i.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',i.error||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("change","select",s),t.on("click",".joms-js--button-cancel",n),t.on("click",".joms-js--button-save",p)}})})}}(),e("popups/user.report",["utils/popup"],function(){return joms.popup.user.report}),Te=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.user||(joms.popup.user={}),joms.popup.user.unignore=function(o){var t,e,s;function n(){e.off(),t.close()}function p(){joms.ajax({func:"profile,ajaxUnIgnoreUser",data:[s],callback:function(s){if(!s.success)return e.find(".joms-popup__action").hide(),void e.find(".joms-popup__content").html(s.error);t.close(),o.location.reload()}})}return function(o){joms.util.popup.prepare(function(i){var a,u;a=i,u=o,e&&e.off(),t=a,s=u,joms.ajax({func:"profile,ajaxConfirmUnIgnoreUser",data:[s],callback:function(o){var s;t.items[0]={type:"inline",src:(s=o,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content">',s.html||s.message,"</div>",'<div class="joms-popup__action">','<a href="javascript:" class="joms-button--neutral joms-button--small joms-left" data-ui-object="popup-button-cancel">',s.btnNo,"</a> &nbsp;",'<button class="joms-button--primary joms-button--small" data-ui-object="popup-button-save">',s.btnYes,"</button>","</div>","</div>"].join(""))},t.updateItemHTML(),(e=t.contentContainer).on("click","[data-ui-object=popup-button-cancel]",n),e.on("click","[data-ui-object=popup-button-save]",p)}})})}}(Te),e("popups/user.unignore",["utils/popup"],function(){return joms.popup.user.unignore}),window,joms.popup||(joms.popup={}),joms.popup.user=(Se=joms.popup.user||{},joms._.extend({},Se)),e("popups/user",["popups/user.changevanityurl","popups/user.addfeatured","popups/user.removefeatured","popups/user.ban","popups/user.unban","popups/user.block","popups/user.unblock","popups/user.ignore","popups/user.report","popups/user.unignore"],function(){return joms.popup.user}),Le=window,Oe=joms.jQuery,joms.util||(joms.util={}),joms.util.videotag=function(o,t,e){var s,n,p,i,a,u,c;function r(e){var s,p,a,r;i||(i=o.joms_friends||[]),s=t(e?e.currentTarget:n.find("input")),p=s.val().replace(/^\s+|\s+$/g,"").toLowerCase(),a=i,a=(a=joms._.filter(i,function(o){return!(!o||!o.name||u&&u.indexOf(o.id+"")>=0||p&&o.name.toLowerCase().indexOf(p)<0)})).slice(0,8),(a=joms._.map(a,function(o){return'<a href="javascript:" data-id="'+o.id+'">'+o.name+"</a>"})).length?c=!1:(a=["<span><em>"+o.joms_lang.COM_COMMUNITY_NO_RESULT_FOUND+"</em></span>"],c=!0),(r=n.find(".joms-phototag__autocomplete")).html(a.join("")),r.append('<div><button class="joms-button--neutral joms-button--small joms-button--full">'+o.joms_lang.COM_COMMUNITY_PHOTO_DONE_TAGGING+"</button></div>"),r.show()}function m(o){var e,p,i,c,m,l,d,j,f=n.find(".joms-phototag__autocomplete"),v=t(o.currentTarget),b=v.data("id")||"";o.stopPropagation(),f.hide(),a&&a.tagAdded&&(u||(u=[]),u.push(b+""),i=s.width(),c=s.height(),p=n.position(),m=n.width(),l=n.height(),d=p.left+m/2,j=p.top+l/2,e={top:j/=c,left:d/=i,width:m/=c,height:l/=c},a.tagAdded(b,e.left,e.top,e.width,e.height),r())}function l(){n&&(n.remove(),s.remove(),t(o).off("resize.phototag"),n=e,p=e,a&&a.destroy&&a.destroy(),a=e)}function d(){var o,t,e=p.height(),s=p.width();return t=Math.max(0,e-86)/4.5,o=Math.max(0,s-86)/2,{top:t,left:o}}function j(o){var t;c?l():(t=d(),n.css({top:t.top,left:t.left}))}return{create:function(c,f,v,b){var h,_,g,w,k;if(l(),s=t(["<div class=joms-phototag__wrapper>","<div class=joms-phototag>","<div class=joms-phototag__input>",'<input type=text placeholder="',o.joms_lang.COM_COMMUNITY_SEARCH,'">','<div class="joms-phototag__autocomplete"></div>',"</div>","</div>","</div>"].join("")),n=s.find(".joms-phototag"),p=c&&c.currentTarget?t(c.currentTarget).closest(".joms-popup--video").find("iframe,video,.joms-js--video").eq(0):t(c),i=e,a={},w=p.width(),k=p.height(),h=p.position(),_=h.top,g=h.left,u=f||[],n.css({top:0,left:0}),s.css({top:_,left:g,width:w,height:k}),s.insertBefore(p),h=d(),n.css({top:h.top,left:h.left}),n.on("keyup","input",r),n.on("click","a[data-id]",m),n.on("click","button",l),n.on("click",function(o){o.stopPropagation()}),s.on("click",j),+v?joms.fn.tagging.fetchGroupMembers(v,function(o){i=o,r()}):+b?joms.fn.tagging.fetchEventMembers(b,function(o){i=o,r()}):r(),joms.ios)try{o.scrollTo(o.scrollLeft,n.find("input").offset().top-100)}catch(c){}joms.mobile||t(o).on("resize.phototag",l)},destroy:l,on:function(o,t){a[o]=t},off:function(o){o?a[o]&&(a[o]=e):a={}}}}(Le,Oe),e("utils/videotag",function(){}),Ie=window,Ue=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.open=function(o,t){var e,s,n,p,i,a,u,c,r,m,l,d,j,f,v,b,h,_,g,w,k,y='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-cog"></use></svg>',x='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-bubble"></use></svg>',C='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-thumbs-up"></use></svg>',M='<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-tag"></use></svg>';function T(T,S){s&&s.off(),e=T,u=S,joms.ajax({func:"videos,ajaxShowVideoWindow",data:[u],callback:function(T){var S,O,V,W,K,J,X,Z,oo,to,eo;T||(T={}),c=T.lang||{},r=T.can_edit||!1,m=T.can_delete||!1,l=T.video_url,v=d=+T.my_id,j=+T.groupid,f=+T.eventid,b=v&&+T.my_id==+T.owner_id,h=+T.is_admin,_=+T.enableprofilevideo,g=+T.enablereporting,w=+T.enablesharing,k=T.enablefeature,e.items[0]={type:"inline",src:(S=T,S||(S={}),['<div class="joms-popup joms-popup--video">','<div class="joms-popup__commentwrapper">','<div class="joms-popup__content">','<div class="joms-popup__video">',S.error||S.playerHtml||"","</div>",'<div class="joms-popup__option clearfix">','<div class="joms-popup__optcaption">',' &nbsp;<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-eye"></use></svg> ',S.hits,"</div>",'<div class="joms-popup__optoption">','<button class="joms-popup__btn-comments">',x,' <span class="joms-popup__btn-overlay">',c.comments,"</span></button>",(W=S.like,K="",W&&(K+='<button class="joms-popup__btn-like joms-js--like-videos-'+u+(W.is_liked?" liked":"")+'"',K+=' onclick="joms.api.page'+(W.is_liked?"Unlike":"Like")+"('videos', '"+u+"');\"",K+=' data-lang="'+(W.lang||"Like")+'"',K+=' data-lang-like="'+(W.lang_like||"Like")+'"',K+=' data-lang-liked="'+(W.lang_liked||"Liked")+'">',K+=C+" ",K+="<span>",K+=W.is_liked?W.lang_liked:W.lang_like,(J=+W.count)>0&&(K+=" ("+J+")"),K+="</span></button>"),K),r?'<button class="joms-popup__btn-tag-video">'+M+' <span class="joms-popup__btn-overlay">'+c.tag_video+"</span></button>":"",'<div class="joms-popup__dropdown--wrapper">',(O=S,V="",O||(O={}),w&&(V+='<a href="javascript:" class="joms-popup__btn-share">'+c.share+"</a>",V+='<div class="sep"></div>'),b||h?(V+='<a href="javascript:" class="joms-popup__btn-fetch">'+c.fetch+"</a>",V+=b&&_?'<a href="javascript:" class="joms-popup__btn-profile">'+c.set_as_profile_video+"</a>":"",h&&k&&("add"===k?V+='<a href="javascript:" class="joms-popup__btn-feature" data-featured="0">'+c.make_feature+"</a>":"remove"===k&&(V+='<a href="javascript:" class="joms-popup__btn-feature" data-featured="1">'+c.remove_featured+"</a>")),V+='<div class="sep"></div>',V+=r?'<a href="javascript:" class="joms-popup__btn-edit">'+c.edit_video+"</a>":"",V+=m?'<a href="javascript:" class="joms-popup__btn-delete">'+c.delete_video+"</a>":""):(V+=r?'<a href="javascript:" class="joms-popup__btn-edit">'+c.edit_video+"</a>":"",V+=m?'<a href="javascript:" class="joms-popup__btn-delete">'+c.delete_video+"</a>":"",V+=g?'<a href="javascript:" class="joms-popup__btn-report">'+c.report+"</a>":""),V='<div class="joms-popup__dropdown"><div class="joms-popup__ddcontent">'+V+"</div></div>"),'<button class="joms-popup__btn-option">',y,' <span class="joms-popup__btn-overlay">',c.options,"</span></button></div>","</div>","</div>","</div>",'<div class="joms-popup__comment"></div>','<button class="mfp-close" type="button" title="Close (Esc)">×</button>',"</div>","</div>"].join(""))},e.updateItemHTML(),e.close=A,to=".joms-js--video",(eo=t(".joms-popup__content").find(to)).length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),eo.on("click.joms-video",to+"-play",function(){var o=t(this).closest(to);joms.util.video.play(o,o.data())})),s=e.contentContainer,n=s.find(".joms-popup__btn-tag-video"),s.on("click",".joms-popup__btn-tag-video",L),s.on("click",".joms-popup__btn-comments",E),s.on("click",".joms-popup__btn-option",R),s.on("click",".joms-popup__btn-share",H),s.on("click",".joms-popup__btn-report",P),s.on("click",".joms-popup__btn-fetch",$),s.on("click",".joms-popup__btn-profile",Y),s.on("click",".joms-popup__btn-feature",Q),s.on("click",".joms-popup__btn-edit",F),s.on("click",".joms-popup__btn-delete",B),s.on("mouseleave",".joms-popup__dropdown--wrapper",N),s.on("click",".joms-js--remove-tag",I),s.on("click",".joms-js--btn-desc-toggle",D),s.on("click",".joms-js--btn-desc-edit",q),s.on("click",".joms-js--btn-desc-cancel",z),s.on("click",".joms-js--btn-desc-save",G),X=u,oo=s.find(".joms-popup__comment"),Z||oo.empty(),joms.ajax({func:"videos,ajaxGetInfo",data:[X,Z?1:0],callback:function(e){var s,n,u,c,m,l;Z||e.comments&&e.showall&&(e.showall='<div class="joms-comment__more joms-js--more-comments"><a href="javascript:">'+e.showall+"</a></div>",e.comments=t(e.comments),e.comments.prepend(e.showall)),Z?oo.find(".joms-comment").replaceWith(e.comments):(oo.html(e.head||""),oo.append(e.comments),oo.append(e.form||""),oo.find(".joms-js--description").html(("object"!=typeof(c=e.description||{})&&(c={}),c.content&&c.excerpt!==c.content&&(m=!0),['<div class="joms-js--btn-desc-content">','<span class="joms-js--btn-desc-excerpt"',m?"":' style="display:none"',">",c.excerpt||"","</span>",'<span class="joms-js--btn-desc-fulltext"',m?' style="display:none"':"",">",c.content||"","</span>",' <a href="javascript:" class="joms-js--btn-desc-toggle"',m?"":' style="display:none"',">",o.joms_lang.COM_COMMUNITY_SHOW_MORE,"</a>","</div>",'<div class="joms-js--btn-desc-editor joms-popup__hide">','<textarea class="joms-textarea" style="margin:0" placeholder="',c.lang_placeholder||"",'">',(l=c.content||"",l=(l=l||"").replace(/<br\s*\/?>/g,"\n")),"</textarea>",'<div style="margin-top:5px;text-align:right">','<button class="joms-button--neutral joms-button--small joms-js--btn-desc-cancel">',c.lang_cancel||"Cancel","</button> ",'<button class="joms-button--primary joms-button--small joms-js--btn-desc-save">',c.lang_save||"Save","</button>","</div>","</div>",'<div class="joms-js--btn-desc-edit"',r?"":' style="display:none"','><a href="javascript:"',' data-lang-add="',c.lang_add||"Add description",'"',' data-lang-edit="',c.lang_edit||"Edit description",'">',c.content?c.lang_edit:c.lang_add,"</a>","</div>"].join(""))),p=e.tagged||[],i=e.tagLabel||"",a=e.tagRemoveLabel||"",oo.find(".joms-js--tag-info").html(U()),oo.find("textarea.joms-textarea"),joms.fn.tagging.initInputbox()),s=".joms-js--initialized",n=".joms-js--video",(u=t(".joms-comment__body,.joms-js--inbox").find(n).not(s).addClass(s.substr(1))).length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),u.on("click.joms-video",n+"-play",function(){var o=t(this).closest(n);joms.util.video.play(o,o.data())}),joms.ios&&setTimeout(function(){u.find(n+"-play").click()},2e3))}})}})}function S(o){return o=o.replace(/<\/?[^>]+>/g,"")}function L(o){var t,e;n.data("tagging")?(n.removeData("tagging"),n.html(M+' <span class="joms-popup__btn-overlay">'+c.tag_video+"</span>"),joms.util.videotag.destroy()):(n.data("tagging",1),n.html(M+" "+c.done_tagging),t=o,e=joms._.map(p,function(o){return o.userId+""}),joms.util.videotag.create(t,e,j,f),joms.util.videotag.on("tagAdded",O),joms.util.videotag.on("destroy",function(){n.removeData("tagging"),n.html(M+' <span class="joms-popup__btn-overlay">'+c.tag_video+"</span>")}))}function O(t){joms.ajax({func:"videos,ajaxAddVideoTag",data:[u,t],callback:function(t){t.error?o.alert(S(t.error)):t.success&&(p.push(t.data),s.find(".joms-popup__comment").find(".joms-js--tag-info").html(U()))}})}function I(e){var n=t(e.currentTarget),i=n.data("id");joms.ajax({func:"videos,ajaxRemoveVideoTag",data:[u,i],callback:function(t){var e;if(t.error)o.alert(S(t.error));else if(t.success){for(e=0;e<p.length;e++)+i==+p[e].userId&&p.splice(e--,1);s.find(".joms-popup__comment").find(".joms-js--tag-info").html(U())}}})}function U(){var o,t,e,s;if(!p||!p.length)return"";for(o=[],s=0;s<p.length;s++)t=p[s],e='<a href="'+t.profileUrl+'">'+t.displayName+"</a>",t.canRemove&&(e+=' (<a href="javascript:" class="joms-js--remove-tag" data-id="'+t.userId+'">'+a+"</a>)"),o.push(e);return o=o.join(", "),o=i+"<br>"+o}function E(){s.children(".joms-popup").toggleClass("joms-popup--togglecomment")}function A(){var o=s.children(".joms-popup"),e="joms-popup--togglecomment";o.hasClass(e)?o.removeClass(e):t.magnificPopup.proto.close.call(this)}function R(o){var e=t(o.target).closest(".joms-popup__dropdown--wrapper"),s=e.children(".joms-popup__dropdown");s.toggleClass("joms-popup__dropdown--open")}function N(o){var e=t(o.target).closest(".joms-popup__dropdown--wrapper"),s=e.children(".joms-popup__dropdown");s.removeClass("joms-popup__dropdown--open")}function H(){joms.api.pageShare(l)}function P(){joms.api.videoReport(d,l)}function $(){joms.api.videoFetchThumbnail(u)}function Y(){joms.ajax({func:"profile,ajaxConfirmLinkProfileVideo",data:[u],callback:function(t){t.error?o.alert(S(t.error)):o.confirm(S(t.html))&&joms.ajax({func:"profile,ajaxLinkProfileVideo",data:[u],callback:function(t){t.error?o.alert(S(t.error)):(o.alert(S(t.message)),setTimeout(function(){o.location.reload()},500))}})}})}function Q(o){var e=t(o.currentTarget),s=+e.data("featured");s?joms.api.videoRemoveFeatured(u):joms.api.videoAddFeatured(u)}function F(){joms.api.videoEdit(u)}function B(){joms.ajax({func:"videos,ajaxConfirmRemoveVideo",data:[u],callback:function(t){t.error?o.alert(S(t.error)):o.confirm(S(t.html))&&joms.ajax({func:"videos,ajaxRemoveVideo",data:[u],callback:function(t){t.error?o.alert(S(t.error)):(o.alert(S(t.message)),setTimeout(function(){o.location.reload()},500))}})}})}function D(){var t=s.find(".joms-js--btn-desc-excerpt"),e=s.find(".joms-js--btn-desc-fulltext"),n=s.find(".joms-js--btn-desc-toggle");e.is(":visible")?(e.hide(),t.show(),n.html(o.joms_lang.COM_COMMUNITY_SHOW_MORE)):(t.hide(),e.show(),n.html(o.joms_lang.COM_COMMUNITY_SHOW_LESS))}function q(){s.find(".joms-js--btn-desc-content").hide(),s.find(".joms-js--btn-desc-edit").hide(),s.find(".joms-js--btn-desc-editor").show()}function z(){s.find(".joms-js--btn-desc-editor").hide(),s.find(".joms-js--btn-desc-content").show(),s.find(".joms-js--btn-desc-edit").show()}function G(){var e=s.find(".joms-js--btn-desc-content"),n=s.find(".joms-js--btn-desc-editor"),p=s.find(".joms-js--btn-desc-edit"),i=n.find("textarea"),a=t.trim(i.val());joms.ajax({func:"videos,ajaxSaveDescription",data:[u,a],callback:function(t){var s,i,u,c=p.find("a");t.error?o.alert(t.error):t.success&&(s=e.find(".joms-js--btn-desc-excerpt"),i=e.find(".joms-js--btn-desc-fulltext"),u=e.find(".joms-js--btn-desc-toggle"),t.caption&&t.caption!==t.excerpt?(s.html(t.excerpt).show(),u.html(o.joms_lang.COM_COMMUNITY_SHOW_MORE).show(),i.html(t.caption).hide()):(s.hide(),u.hide(),i.html(t.caption).show()),n.hide(),e.show(),c.html(c.data("lang-"+(a?"edit":"add"))),p.show())}})}return joms._.debounce(function(o){joms.util.popup.prepare(function(t){T(t,o)})},200)}(Ie,Ue),e("popups/video.open",["utils/popup","utils/videotag"],function(){return joms.popup.video.open}),Ee=window,Ae=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.add=function(o,t){var e,s,n,p,i,a;function u(o){o.preventDefault();var e=t(o.currentTarget),n=e.find("[name=videoLinkUrl]"),p=e.find("[name=category_id]"),i=n.val().trim(/^\s+|\s+$/g,""),a=+p.val(),u=e.find("[type=submit]"),c=u.data("lang-linking")||"Linking***";n.siblings("[data-elem=form-warning]")[i?"hide":"show"](),p.siblings("[data-elem=form-warning]")[a?"hide":"show"](),i&&a&&(e.removeAttr("onsubmit"),u.val(c),u.prop("disabled",!0),s.off("submit",".joms-js--form-link"),setTimeout(function(){e.submit()},300))}function c(){r(function(){p.click()})}function r(e){"function"!=typeof e&&(e=function(){}),n?e():joms.util.loadLib("plupload",function(){var s;s=t('<div id="joms-js--videoupload-uploader" aria-hidden="true" style="width:1px; height:1px; overflow:hidden">').appendTo(document.body),t('<button id="joms-js--videoupload-uploader-button">').appendTo(s),(n=new o.plupload.Uploader({url:"index.php?option=com_community&view=videos&task=uploadvideo",filters:[{title:"Video files",extensions:"3g2,3gp,asf,asx,avi,flv,mov,mp4,mpg,rm,swf,vob,wmv,m4v"}],container:"joms-js--videoupload-uploader",browse_button:"joms-js--videoupload-uploader-button",runtimes:"html5,html4",multi_selection:!1})).bind("FilesAdded",m),n.bind("BeforeUpload",d),n.bind("Error",j),n.bind("UploadProgress",f),n.bind("FileUploaded",v),n.bind("uploadComplete",b),n.init(),p=s.find("input[type=file]"),e()})}function m(o,t){if(t&&t.length){for(var e=s.find(".joms-js--select-file"),n=t[0],p="<span>"+n.name+"</span>",i=n.size||0,a="Bytes",u=["KB","MB","GB"];i>=1e3&&u.length;)a=u.shift(),i=Math.ceil(i/1e3);i&&(p+=" <span>("+i+" "+a+")</span>"),e.html(p)}}function l(o){o.preventDefault();var e=t(o.currentTarget),s=e.find("[name=title]"),p=e.find("[name=category_id]"),i=s.val().trim(/^\s+|\s+$/g,""),a=+p.val();if(s.siblings("[data-elem=form-warning]")[i?"hide":"show"](),p.siblings("[data-elem=form-warning]")[a?"hide":"show"](),!i||!a)return!1;e.find(".joms-progressbar__progress").css({width:0}),n.refresh(),n.start()}function d(){var o,t=s.find(".joms-js--form-upload").serializeArray(),e={};for(o=0;o<t.length;o++)e[t[o].name]=t[o].value;n.settings.multipart_params=e}function j(t,e){var p="Undefined error.";e&&e.code&&e.message&&(p="("+e.code+") "+e.message),s.find(".joms-js--select-file").html("&nbsp;"),n.splice(),n.refresh(),o.alert(p)}function f(o,t){var e;e=Math.min(100,Math.floor(t.loaded/t.size*100)),s.find(".joms-js--form-upload").find(".joms-progressbar__progress").stop().animate({width:e+"%"})}function v(t,s,n){var p={};try{p=JSON.parse(n.response)}catch(o){}"success"===p.status?setTimeout(function(){o.alert(p.processing_str),e.close()},1e3):o.alert(p.message||"Undefined error.")}function b(){}return function(o,t){joms.util.popup.prepare(function(n){var p,m,d,j;p=n,m=o,d=t,s&&s.off(),e=p,a=d||!1,j=[],(i=m||!1)&&(j.push(a||""),j.push(i||"")),joms.ajax({func:"videos,ajaxAddVideo",data:j,callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--videoupload">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",t.html?t.html:'<div class="joms-popup__content joms-popup__content--single">'+t.error+"</div>","</div>"].join(""))},e.updateItemHTML(),(s=e.contentContainer).on("submit",".joms-js--form-link",u),s.on("click",".joms-js--select-file",c),s.on("submit",".joms-js--form-upload",l),r()}})})}}(Ee,Ae),e("popups/video.add",["utils/loadlib","utils/popup"],function(){return joms.popup.video.add}),Re=window,joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.edit=function(o){var t,e,s;function n(){e.off(),t.close()}function p(){e.find("form").submit()}return function(i){joms.util.popup.prepare(function(a){var u,c;u=a,c=i,e&&e.off(),t=u,s=c,joms.ajax({func:"videos,ajaxEditVideo",data:[s,o.location.href],callback:function(o){var s;t.items[0]={type:"inline",src:(s=o,s||(s={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--600">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-js--step1',s.error?" joms-popup__hide":"",'">','<div class="joms-popup__content joms-popup__content--single">',s.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',s.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',s.btnSave,"</button>","</div>","</div>",'<div class="joms-js--step2',s.error?"":" joms-popup__hide",'">','<div data-ui-object="popup-step-2"',s.error?"":' class="joms-popup__hide"',">",'<div class="joms-popup__content joms-popup__content--single">',s.error||"","</div>","</div>","</div>"].join(""))},t.updateItemHTML(),(e=t.contentContainer).on("click",".joms-js--button-cancel",n),e.on("click",".joms-js--button-save",p)}})})}}(Re),e("popups/video.edit",["utils/popup"],function(){return joms.popup.video.edit}),Ne=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.fetchThumbnail=(He=Ne,function(o){joms.util.popup.prepare(function(t){var e,s;e=t,s=o,$e&&$e.off(),Pe=e,Ye=s,joms.ajax({func:"videos,ajaxFetchThumbnail",data:[Ye,"myvideos"],callback:function(o){var t;Pe.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',t.message||t.error||"",t.thumbnail?'<div style="padding-top:10px;"><img src="'+t.thumbnail+'" style="max-width:100%;"></div>':"","</div>","</div>"].join(""))},o.success&&(Pe.st.callbacks||(Pe.st.callbacks={}),Pe.st.callbacks.close=function(){He.location.reload()}),Pe.updateItemHTML()}})})}),e("popups/video.fetchthumbnail",["utils/popup"],function(){return joms.popup.video.fetchThumbnail}),Qe=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.linkToProfile=function(o){var t,e,s;function n(){e.off(),t.close()}function p(){joms.ajax({func:"profile,ajaxLinkProfileVideo",data:[s],callback:function(t){e.find(".joms-js--step1").hide(),e.find(".joms-js--step2").show().children().html(t.error||t.message),t.success&&setTimeout(function(){o.location.reload()},1e3)}})}return function(o){joms.util.popup.prepare(function(i){var a,u;a=i,u=o,e&&e.off(),t=a,s=u,joms.ajax({func:"profile,ajaxConfirmLinkProfileVideo",data:[s],callback:function(o){var s;t.items[0]={type:"inline",src:(s=o,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',s.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',s.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',s.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join(""))},t.updateItemHTML(),(e=t.contentContainer).on("click",".joms-js--button-cancel",n),e.on("click",".joms-js--button-save",p)}})})}}(Qe),e("popups/video.linktoprofile",["utils/popup"],function(){return joms.popup.video.linkToProfile}),Fe=window,joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.remove=function(o){var t,e,s;function n(){e.off(),t.close()}function p(t){joms.ajax({func:"videos,ajaxRemoveVideo",data:[s,t.data.redirect],callback:function(t){e.find(".joms-js--step1").hide(),e.find(".joms-js--step2").show().children().html(t.error||t.message),t.success&&setTimeout(function(){t.redirect?o.location=t.redirect:o.location.reload()},1e3)}})}return function(o,i){joms.util.popup.prepare(function(a){var u,c,r;u=a,c=o,r=i,e&&e.off(),t=u,s=c,joms.ajax({func:"videos,ajaxConfirmRemoveVideo",data:[s],callback:function(o){var s;t.items[0]={type:"inline",src:(s=o,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',s.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',s.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',s.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join(""))},t.updateItemHTML(),(e=t.contentContainer).on("click",".joms-js--button-cancel",n),e.on("click",".joms-js--button-save",{redirect:r?1:0},p)}})})}}(Fe),e("popups/video.remove",["utils/popup"],function(){return joms.popup.video.remove}),window,joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.report=function(){var o,t,e,s;function n(o){t.find("textarea").val(o.target.value)}function p(){t.off(),o.close()}function i(){var o;(o=(o=t.find("textarea").val()).replace(/^\s+|\s+$/g,""))?(t.find(".joms-js--error").hide(),joms.ajax({func:"system,ajaxSendReport",data:["videos,reportVideo",s||window.location.href,o,e],callback:function(o){t.find(".joms-js--step1").hide(),t.find(".joms-js--step2").show().children().html(o.error||o.message)}})):t.find(".joms-js--error").show()}return function(a,u){joms.util.popup.prepare(function(c){var r,m,l;r=c,m=a,l=u,t&&t.off(),o=r,e=m,s=l,joms.ajax({func:"system,ajaxReport",data:[],callback:function(e){var s;o.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-js--step1',s.error?" joms-popup__hide":"",'">',s.html,'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',s.btnCancel,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',s.btnSend,"</button>","</div>","</div>",'<div class="joms-js--step2',s.error?"":" joms-popup__hide",'">','<div class="joms-popup__content joms-popup__content--single">',s.error||"","</div>","</div>","</div>"].join(""))},o.updateItemHTML(),(t=o.contentContainer).on("change","select",n),t.on("click",".joms-js--button-cancel",p),t.on("click",".joms-js--button-save",i)}})})}}(),e("popups/video.report",["utils/popup"],function(){return joms.popup.video.report});Be=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.addFeatured=function(o){var t,e,s;function n(n,p){e&&e.off(),t=n,s=p,joms.ajax({func:"videos,ajaxAddFeatured",data:[s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},e.success&&(t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()}),t.updateItemHTML()}})}return function(o){joms.util.popup.prepare(function(t){n(t,o)})}}(Be),e("popups/video.addfeatured",["utils/popup"],function(){return joms.popup.video.addFeatured}),De=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.removeFeatured=function(o){var t,e,s;function n(n,p){e&&e.off(),t=n,s=p,joms.ajax({func:"videos,ajaxRemoveFeatured",data:[s],callback:function(e){var s;t.items[0]={type:"inline",src:(s=e,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-popup__content joms-popup__content--single">',s.html||s.error||"","</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-js--button-close">',o.joms_lang.COM_COMMUNITY_CLOSE_BUTTON,"</button>","</div>","</div>"].join(""))},e.success&&(t.st.callbacks||(t.st.callbacks={}),t.st.callbacks.close=function(){o.location.reload()}),t.updateItemHTML()}})}return function(o){joms.util.popup.prepare(function(t){n(t,o)})}}(De),e("popups/video.removefeatured",["utils/popup"],function(){return joms.popup.video.removeFeatured}),qe=window,joms.jQuery,joms.popup||(joms.popup={}),joms.popup.video||(joms.popup.video={}),joms.popup.video.removeLinkFromProfile=function(o){var t,e,s,n;function p(){e.off(),t.close()}function i(){joms.ajax({func:"profile,ajaxRemoveLinkProfileVideo",data:[n,s],callback:function(t){e.find(".joms-js--step1").hide(),e.find(".joms-js--step2").show().children().html(t.error||t.message),t.success&&setTimeout(function(){o.location.reload()},1e3)}})}return function(o,a){joms.util.popup.prepare(function(u){var c,r,m;c=u,r=o,m=a,e&&e.off(),t=c,s=r,n=m,joms.ajax({func:"profile,ajaxRemoveConfirmLinkProfileVideo",data:[n,s],callback:function(o){var s;t.items[0]={type:"inline",src:(s=o,s||(s={}),['<div class="joms-popup joms-popup--whiteblock">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',s.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',s.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',s.btnNo,"</button> &nbsp;",'<button class="joms-button--primary joms-button--small joms-js--button-save">',s.btnYes,"</button>","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join(""))},t.updateItemHTML(),(e=t.contentContainer).on("click",".joms-js--button-cancel",p),e.on("click",".joms-js--button-save",i)}})})}}(qe),e("popups/video.removelinkfromprofile",["utils/popup"],function(){return joms.popup.video.removeLinkFromProfile}),window,joms.popup||(joms.popup={}),joms.popup.video=(ze=joms.popup.video||{},joms._.extend({},ze)),e("popups/video",["popups/video.open","popups/video.add","popups/video.edit","popups/video.fetchthumbnail","popups/video.linktoprofile","popups/video.remove","popups/video.report","popups/video.addfeatured","popups/video.removefeatured","popups/video.removelinkfromprofile"],function(){return joms.popup.video}),window,Ge=joms.jQuery,joms.view||(joms.view={}),joms.view.cover=function(o,t){var e,s,n,p,i;function a(o){var i,a,c,r,m;i=t(o.target),n.children(".joms-focus__actions--reposition").off("click","input"),"button-save"===i.data("ui-object")?(c=p.position().top,r=n.height(),m=100*c/r,a=(m=Math.round(1e4*m)/1e4)+"%",u(),joms.ajax({func:"photos,ajaxSetPhotoPhosition",data:[e,s,a]})):(p.css({top:p.data("top")}),u())}function u(){n.css("cursor",""),n.children(".joms-focus__actions--reposition").hide(),n.children(".joms-focus__header").show(),n=null,p=null,i=null}return{reposition:function(o,u){var c,r;e=o,s=u,n=t(".joms-focus__cover"),(p=n.children(".joms-js--cover-image").children("img"))&&(n.css("cursor","move"),n.children(".joms-focus__header").hide(),n.children(".joms-focus__actions--reposition").on("click","input",a).show(),p.data("top",p.position().top),i=!0,new joms.Hammer(p[0]).on("dragstart dragup dragdown dragend",function(o){var t;"dragstart"===o.type?(c=p.position().top,r=n.height()-p.height()):"dragend"!==o.type&&(t=Math.min(0,c+o.gesture.deltaY),t=Math.max(r,t),p.css({top:t}))}))},click:function(o,t){i||joms.api.photoOpen(o,t)}}}(0,Ge),e("views/cover",[],function(){return joms.view.cover}),Ve=window,We=joms.jQuery,joms.popup||(joms.popup={}),joms.popup.page||(joms.popup.page={}),joms.popup.page.share=function(o,t){var e,s,n;function p(n){var p,i,a;n.preventDefault(),n.stopPropagation(),p=t(this),i=p.attr("href"),a=p.text(),s.off(),e.close(),o.open(i,a,"top=150, left=150, width=650, height=330, scrollbars=yes")}function i(){s.off(),e.close()}function a(){var o=s.find("form"),t=o.find("[name=bookmarks-email]").val(),e=o.find("[name=bookmarks-message]").val();joms.ajax({func:"bookmarks,ajaxEmailPage",data:[n,t,e],callback:function(o){s.find(".joms-js--step1").hide(),s.find(".joms-js--step2").show().children().html(o.error||o.message)}})}return function(o){joms.util.popup.prepare(function(u){var c,r,m,l,d;c=u,r=o,s&&s.off(),e=c,n=r,t.ajax({url:n,success:function(o){m=(m=o.match(/<meta property="og:title" content="([^"]+)"/i)||!1)&&m[1],l=(l=o.match(/<meta property="og:description" content="([^"]+)"/i)||!1)&&l[1],d=(d=o.match(/<meta property="og:image" content="([^"]+)"/i)||!1)&&d[1]},complete:function(){var o=[n,m||"",l||"",d||""];joms.ajax({func:"bookmarks,ajaxShowBookmarks",data:o,callback:function(o){var t;e.items[0]={type:"inline",src:(t=o,t||(t={}),['<div class="joms-popup joms-popup--whiteblock joms-popup--500">','<div class="joms-popup__title"><button class="mfp-close" type="button" title="Close (Esc)">×</button>',t.title,"</div>",'<div class="joms-js--step1">','<div class="joms-popup__content">',t.html,"</div>",'<div class="joms-popup__action">','<button class="joms-button--neutral joms-button--small joms-left joms-js--button-cancel">',t.btnCancel,"</button>",t.viaEmail?' &nbsp;<button class="joms-button--primary joms-button--small joms-js--button-save">'+t.btnShare+"</button>":"","</div>","</div>",'<div class="joms-popup__hide joms-js--step2">','<div class="joms-popup__content joms-popup__content--single"></div>',"</div>","</div>"].join(""))},e.updateItemHTML(),(s=e.contentContainer).on("click",".joms-bookmarks a",p),s.on("click",".joms-js--button-cancel",i),s.on("click",".joms-js--button-save",a)}})}})})}}(Ve,We),e("popups/page.share",["utils/popup"],function(){return joms.popup.page.share}),window,joms.popup||(joms.popup={}),joms.popup.page=(Ke=joms.popup.page||{},joms._.extend({},Ke)),e("popups/page",["popups/page.share"],function(){return joms.popup.page}),window,Je=joms.jQuery,joms.view||(joms.view={}),joms.view.page=function(o,t){function e(o,e,n,p){t(".joms-js--like-"+e+"-"+n).each(function(){var i,a,u,c,r,m,l,d,j,f,v,b,h=this.tagName.toLowerCase(),_=t(this);"a"===h?_.hasClass("joms-popup__btn-like")?s(_,o,e,n,p):(a=o,u=e,c=n,r=p,(i=_).find("span").html(r),"like"===a?(i.attr("onclick",'joms.view.page.unlike("'+u+'", "'+c+'");'),i.addClass("liked"),(m=i.data("lang-liked"))&&i.find(".joms-js--lang").text(m)):"unlike"===a&&(i.attr("onclick",'joms.view.page.like("'+u+'", "'+c+'");'),i.removeClass("liked"),(m=i.data("lang-like"))&&i.find(".joms-js--lang").text(m))):"button"===h&&(_.hasClass("joms-popup__btn-like")?s(_,o,e,n,p):(l=_,j=e,f=n,v=p,"like"===(d=o)?(l.attr("onclick",'joms.view.page.unlike("'+j+'", "'+f+'");'),l.removeClass("joms-button--neutral"),l.addClass("joms-button--primary"),b=l.data("lang-liked")):"unlike"===d&&(l.attr("onclick",'joms.view.page.like("'+j+'", "'+f+'");'),l.addClass("joms-button--neutral"),l.removeClass("joms-button--primary"),b=l.data("lang-like")),b=b||l.data("lang")||"",(v=+v)>0&&(b+=" ("+v+")"),l.html(b)))})}function s(o,t,e,s,n){var p;"like"===t?(o.attr("onclick",'joms.view.page.unlike("'+e+'", "'+s+'");'),o.addClass("liked"),p=o.data("lang-liked")):"unlike"===t&&(o.attr("onclick",'joms.view.page.like("'+e+'", "'+s+'");'),o.removeClass("liked"),p=o.data("lang-like")),p=p||o.data("lang"),(n=+n)>0&&(p+=" ("+n+")"),o.html('<svg viewBox="0 0 16 16" class="joms-icon"><use xlink:href="#joms-icon-thumbs-up"></use></svg> <span>'+p+"</span>")}return{initialize:function(){},like:function(o,t){joms.ajax({func:"system,ajaxLike",data:[o,t],callback:function(s){s.success&&e("like",o,t,s.likeCount)}})},unlike:function(o,t){joms.ajax({func:"system,ajaxUnlike",data:[o,t],callback:function(s){s.success&&e("unlike",o,t,s.likeCount)}})},share:function(o){joms.popup.page.share(o)}}}(0,Je),e("views/page",["utils/hovercard","popups/page"],function(){return joms.view.page}),window,joms.api={login:function(o){joms.popup.login(o)},userChangeVanityURL:function(o){joms.popup.user.changeVanityURL(o)},userAddFeatured:function(o){joms.popup.user.addFeatured(o)},userRemoveFeatured:function(o){joms.popup.user.removeFeatured(o)},userBan:function(o){joms.popup.user.ban(o)},userUnban:function(o){joms.popup.user.unban(o)},userBlock:function(o){joms.popup.user.block(o)},userUnblock:function(o){joms.popup.user.unblock(o)},userIgnore:function(o){joms.popup.user.ignore(o)},userUnignore:function(o){joms.popup.user.unignore(o)},userReport:function(o){joms.popup.user.report(o)},avatarChange:function(o,t,e){joms.popup.avatar.change(o,t),e&&(e.stopPropagation(),e.preventDefault())},avatarRemove:function(o,t){joms.popup.avatar.remove(o,t)},avatarRotate:function(o,t,e,s){joms.popup.avatar.rotate(o,t,e,s)},coverChange:function(o,t){joms.popup.cover.change(o,t)},coverRemove:function(o,t){joms.popup.cover.remove(o,t)},coverReposition:function(o,t){joms.view.cover.reposition(o,t)},coverClick:function(o,t){joms.view.cover.click(o,t)},eventInvite:function(o,t){joms.popup.event.invite(o,t)},eventJoin:function(o){joms.popup.event.join(o)},eventLeave:function(o){joms.popup.event.leave(o)},eventResponse:function(){joms.popup.event.response.apply(this,arguments)},eventAddFeatured:function(o){joms.popup.event.addFeatured(o)},eventRemoveFeatured:function(o){joms.popup.event.removeFeatured(o)},eventReport:function(o){joms.popup.event.report(o)},eventDelete:function(o){joms.popup.event.delete(o)},eventRejectGuest:function(o,t){joms.popup.event.rejectGuest(o,t)},eventBanMember:function(o,t){joms.popup.event.banMember(o,t)},eventUnbanMember:function(o,t){joms.popup.event.unbanMember(o,t)},eventUnpublish:function(o){joms.popup.event.unpublish(o)},friendAdd:function(o){joms.popup.friend.add(o)},friendAddCancel:function(o){joms.popup.friend.addCancel(o)},friendRemove:function(o){joms.popup.friend.remove(o)},friendResponse:function(o){joms.popup.friend.response(o)},friendApprove:function(o){joms.popup.friend.approve(o)},friendReject:function(o){joms.popup.friend.reject(o)},groupInvite:function(o){joms.popup.group.invite(o,1,1)},groupJoin:function(o){joms.popup.group.join(o)},groupLeave:function(o){joms.popup.group.leave(o)},groupAddFeatured:function(o){joms.popup.group.addFeatured(o)},groupRemoveFeatured:function(o){joms.popup.group.removeFeatured(o)},groupReport:function(o){joms.popup.group.report(o)},groupUnpublish:function(o){joms.popup.group.unpublish(o)},groupDelete:function(o){joms.popup.group.delete(o)},groupApprove:function(o,t){joms.popup.group.approve(o,t)},groupRemoveMember:function(o,t){joms.popup.group.removeMember(o,t)},groupBanMember:function(o,t){joms.popup.group.banMember(o,t)},groupUnbanMember:function(o,t){joms.popup.group.unbanMember(o,t)},notificationGeneral:function(){joms.view.toolbar.notificationGeneral()},notificationFriend:function(){joms.view.toolbar.notificationFriend()},notificationPm:function(){joms.view.toolbar.notificationPm()},photoUpload:function(o,t,e){joms.popup.photo.upload(o,t,e)},photoOpen:function(o,t){joms.popup.photo.open(o,t)},photoRemove:function(o){joms.popup.photo.remove(o)},photoZoom:function(o){joms.popup.photo.zoom(o)},photoSetAvatar:function(o){joms.popup.photo.setAvatar(o)},photoSetCover:function(o,t){joms.popup.photo.setCover(o,t)},photoSetAlbum:function(o){joms.popup.photo.setAlbum(o)},photoReport:function(o,t){joms.popup.photo.report(o,t)},albumRemove:function(o){joms.popup.album.remove(o)},albumAddFeatured:function(o){joms.popup.album.addFeatured(o)},albumRemoveFeatured:function(o){joms.popup.album.removeFeatured(o)},pmSend:function(o){joms.popup.pm.send(o)},videoAdd:function(o,t){joms.popup.video.add(o,t)},videoOpen:function(o){joms.popup.video.open(o)},videoEdit:function(o){joms.popup.video.edit(o)},videoRemove:function(o,t){joms.popup.video.remove(o,t)},videoAddFeatured:function(o){joms.popup.video.addFeatured(o)},videoRemoveFeatured:function(o){joms.popup.video.removeFeatured(o)},videoLinkToProfile:function(o){joms.popup.video.linkToProfile(o)},videoRemoveLinkFromProfile:function(o,t){joms.popup.video.removeLinkFromProfile(o,t)},videoFetchThumbnail:function(o){joms.popup.video.fetchThumbnail(o)},videoReport:function(o,t){joms.popup.video.report(o,t)},locationView:function(o){joms.popup.location.view(o)},streamLike:function(o){joms.view.stream.like(o)},streamUnlike:function(o){joms.view.stream.unlike(o)},streamEdit:function(o,t){joms.view.stream.edit(o,t)},streamEditLocation:function(o){joms.view.stream.editLocation(o)},streamRemove:function(o){joms.view.stream.remove(o)},streamRemoveLocation:function(o){joms.view.stream.removeLocation(o)},streamRemoveMood:function(o){joms.view.stream.removeMood(o)},streamRemoveTag:function(o){joms.view.stream.removeTag(o)},streamSelectPrivacy:function(o){joms.view.stream.selectPrivacy(o)},streamShare:function(o){joms.view.stream.share(o)},streamHide:function(o,t){joms.view.stream.hide(o,t)},streamShowLikes:function(o,t){joms.view.stream.showLikes(o,t)},streamShowComments:function(o,t){joms.view.stream.showComments(o,t)},streamShowOthers:function(o){joms.view.stream.showOthers(o)},streamReport:function(o){joms.view.stream.report(o)},streamToggleText:function(o){joms.view.stream.toggleText(o)},streamAddFeatured:function(o){joms.view.stream.addFeatured(o)},streamRemoveFeatured:function(o){joms.view.stream.removeFeatured(o)},streamsLoadMore:function(){joms.view.streams.loadMore()},commentLike:function(o){joms.view.comment.like(o)},commentUnlike:function(o){joms.view.comment.unlike(o)},commentEdit:function(o,t,e){joms.view.comment.edit(o,t,e)},commentCancel:function(o){joms.view.comment.cancel(o)},commentRemove:function(o,t){joms.view.comment.remove(o,t)},commentRemoveTag:function(o,t){joms.view.comment.removeTag(o,t)},commentRemovePreview:function(o,t){joms.view.comment.removePreview(o,t)},commentRemoveThumbnail:function(o,t){joms.view.comment.removeThumbnail(o,t)},commentShowLikes:function(o){joms.popup.comment.showLikes(o)},commentToggleText:function(o){joms.view.comment.toggleText(o)},appAbout:function(o){joms.popup.app.about(o)},appBrowse:function(o){joms.popup.app.browse(o)},appPrivacy:function(o){joms.popup.app.privacy(o)},appRemove:function(o){joms.popup.app.remove(o)},appSetting:function(o,t){joms.popup.app.setting(o,t)},searchSave:function(o){joms.popup.search.save(o)},pageLike:function(o,t){joms.view.page.like(o,t)},pageUnlike:function(o,t){joms.view.page.unlike(o,t)},pageShare:function(o){joms.view.page.share(o)},invitationAccept:function(o,t){joms.fn.invitation.accept(o,t)},invitationReject:function(o,t){joms.fn.invitation.reject(o,t)},fileUpload:function(o,t){joms.popup.file.upload(o,t)},fileList:function(o,t){joms.popup.file.list(o,t)},fileDownload:function(o,t,e){joms.popup.file.download(o,t,e)},fileRemove:function(o,t){joms.popup.file.remove(o,t)},fileUpdateHit:function(o,t){joms.popup.file.updateHit(o,t)},discussionLock:function(o,t){joms.popup.discussion.lock(o,t)},discussionRemove:function(o,t){joms.popup.discussion.remove(o,t)},announcementEdit:function(o,t){joms.fn.announcement.edit(o,t)},announcementEditCancel:function(o,t){joms.fn.announcement.editCancel(o,t)},announcementRemove:function(o,t){joms.popup.announcement.remove(o,t)},inboxRemove:function(o,t){joms.popup.inbox.remove(o,t)},inboxSetRead:function(o,t){joms.popup.inbox.setRead(o,t)},inboxSetUnread:function(o,t){joms.popup.inbox.setUnread(o,t)},tnc:function(){joms.popup.tnc()},fbcUpdate:function(){joms.popup.fbc.update()}},e("api",["functions/announcement","functions/facebook","functions/invitation","utils/field","popups/info","popups/login","popups/album","popups/announcement","popups/app","popups/avatar","popups/comment","popups/cover","popups/discussion","popups/event","popups/fbc","popups/file","popups/friend","popups/group","popups/inbox","popups/location","popups/notification","popups/photo","popups/pm","popups/search","popups/tnc","popups/user","popups/video","views/cover","views/page","views/stream"],function(){return joms.api}),t(["core","utils/crop","utils/dropdown","utils/hovercard","utils/loadlib","utils/location-autocomplete","utils/popup","utils/tab","utils/tagging","utils/validation","utils/video","utils/wysiwyg","functions/tagging","views/comment","views/customize","views/misc","views/stream","views/streams","views/toolbar","api"],function(){joms.onStart(function(){joms.view.comment.start(),joms.view.page.initialize(),joms.view.stream.start(),joms.view.streams.start(),joms.view.toolbar.start(),joms.view.customize.start(),joms.view.misc.start(),joms.util.dropdown.start(),joms.util.tab.start(),joms.util.validation.start(),joms.util.wysiwyg.start(),joms.util.hovercard.initialize(),+window.joms_my_id&&joms.fn.tagging.fetchFriendsInContext()}),joms.jQuery(function(){joms.start()})}),e("init",function(){}),t.config({deps:["init"]}),e("bundle",function(){})}();