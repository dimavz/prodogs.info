!function t(e,i,n){function o(a,r){if(!i[a]){if(!e[a]){var c="function"==typeof require&&require;if(!r&&c)return c(a,!0);if(s)return s(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var l=i[a]={exports:{}};e[a][0].call(l.exports,function(t){var i=e[a][1][t];return o(i||t)},l,l.exports,t,e,i,n)}return i[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,e,i){(function(e){"use strict";var i,n,o;i=window,o=0,n=setInterval(function(){var s,a,r,c;o++>30?clearInterval(n):i.joms&&i.joms.ajax&&+i.joms_my_id&&(clearInterval(n),a=("undefined"!=typeof window?window.joms:void 0!==e?e.joms:null).Vue,r=t("./components/chatbar"),c=("undefined"!=typeof window?window.joms:void 0!==e?e.joms:null).store,s=new a({store:c,render:function(t){return t(r)},mounted:function(){var t=this.$store,e=+joms.getData("chat_pooling_time_active");this.$nextTick(function(){t.dispatch("chats/fetch").then(function(){!function i(){setTimeout(function(){t.dispatch("chats/check").always(i)},1e3*e)}()})})}}).$mount(),document.body.appendChild(s.$el))},100)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./components/chatbar":6}],2:[function(t,e,i){(function(t){"use strict";var i=("undefined"!=typeof window?window.joms:void 0!==t?t.joms:null).Vue,n=("undefined"!=typeof window?window.joms:void 0!==t?t.joms:null).storage,o=window.joms_plg_jomsocialchatbar||{},s=o.configs||{},a=o.templates||{};e.exports=i.component("chatbar-sidebar",{template:a.chatbar_sidebar,data:function(){var t,e;return t={expanded:!0,fetching:!1,fetchDone:!1},+s.remember_last_state&&(e=n.get("chatbar")||{},_.extend(t,e.sidebar||{})),t},computed:{chats:function(){var t=this.$store.state.chats.info;return _.chain(t).keys().map(function(t){return+t}).reverse().map(function(e){return t[e]}).value()}},methods:{open:function(t){this.$store.dispatch("chats/open",t)},toggle:function(){var t=n.get("chatbar")||{},e=t.sidebar||{};this.expanded=!this.expanded,_.extend(e,{expanded:this.expanded}),_.extend(t,{sidebar:e}),n.set("chatbar",t)},fetch:function(){this.fetching||this.fetchDone||(this.fetching=!0,this.fetchDebounced())},fetchDebounced:function(){var t=this;this.$store.dispatch("chats/fetch").fail(function(){t.fetchDone=!0}).always(function(){t.fetching=!1})},handleScroll:function(t){var e,i=t.currentTarget,n=i.scrollTop,o=t.deltaY;0===n&&o<0?(t.preventDefault(),t.stopPropagation()):(e=i.scrollHeight-i.clientHeight,Math.abs(n-e)<=1&&o>0&&(t.preventDefault(),t.stopPropagation(),this.fetch()))}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(t,e,i){(function(t){"use strict";var i,n,o,s="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null,a="undefined"!=typeof window?window.joms:void 0!==t?t.joms:null,r=("undefined"!=typeof window?window.joms:void 0!==t?t.joms:null).Vue,c=String(window.joms_my_id||""),d=(window.joms_plg_jomsocialchatbar||{}).templates||{};function l(t){return s.Deferred(function(e){var r;(r=e,o=r,s.Deferred(function(t){i?t.resolve(i,n):a.util.loadLib("plupload",function(){setTimeout(function(){var e,r="joms-js--jomsocialchatbar-uploader",c=a.getData("base_url")+"index.php?option=com_community";e=s('<div id="'+r+'" aria-hidden="true" />').css({width:1,height:1,overflow:"hidden"}).appendTo(document.body),s('<button id="'+r+'-button" />').appendTo(e),(i=new window.plupload.Uploader({url:c,container:r,browse_button:r+"-button",runtimes:"html5,html4",multi_selection:!1})).bind("FilesAdded",function(t){setTimeout(function(){t.start(),t.refresh()},1)}),i.bind("Error",function(t,e){window.alert(e&&e.message||"Undefined error.")}),i.bind("FileUploaded",function(t,e,i){var n;try{n=JSON.parse(i.response)}catch(t){}return(n=n||{}).error||n.msg?(window.alert(n.error||n.msg),void o.reject()):n.thumb_url&&n.photo_id||n.id?void o.resolve(e,n):(window.alert("Undefined error."),void o.reject())}),i.init(),n=e.find("input[type=file]"),t.resolve(i,n)})})})).done(function(e,i){e.refresh(),e.settings.url=t.url,e.settings.filters=t.filters,e.settings.max_file_size=t.max_file_size,e.refresh(),i.click()})})}e.exports=r.component("chatbar-window-input",{template:d.chatbar_window_input,props:["chat"],data:function(){return{attachment:!1}},methods:{submit:function(t){var e,i=t.target,n=(new Date).getTime(),o=JSON.parse(JSON.stringify(this.attachment||{}));e={chat_id:this.chat.id,user_id:c,action:"sent",content:i.value,attachment:o,params:{attachment:o},created_at:Math.floor(n/1e3)},i.value="",this.attachment=!1,this.$emit("submit",e)},attachImage:function(t){var e=this;l({url:a.getData("base_url")+"index.php?option=com_community&view=photos&task=ajaxPreviewComment",filters:{mime_types:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}]},max_file_size:void 0}).done(function(t,i){e.attachment={type:"image",id:i.photo_id,url:i.thumb_url}})},attachFile:function(t){var e=this;l({url:a.getData("base_url")+"index.php?option=com_community&view=files&task=multiUpload&type=chat&id"+this.chat.id,filters:{mime_types:[{title:"Document files",extensions:"bmp,csv,doc,gif,ico,jpg,jpeg,odg,odp,ods,odt,pdf,png,ppt,swf,txt,xcf,xls,BMP,CSV,DOC,GIF,ICO,JPG,JPEG,ODG,ODP,ODS,ODT,PDF,PNG,PPT,SWF,TXT,XCF,XLS"}]},max_file_size:void 0}).done(function(t,i){e.attachment={type:"file",id:i.id,url:i.path,name:t.name}})},removeAttachment:function(t){this.attachment=!1}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(t,e,i){(function(t){"use strict";var i=("undefined"!=typeof window?window.joms:void 0!==t?t.joms:null).Vue,n=+(window.joms_my_id||""),o=(window.joms_plg_jomsocialchatbar||{}).templates||{};e.exports=i.component("chatbar-window-search",{template:o.chatbar_window_search,props:["participants"],data:function(){return{inputWidth:10,queryResults:[],selectedIds:[],selectedNames:[]}},computed:{selectedUsers:function(){return _.map(this.selectedIds,function(t,e){return{id:t,name:this.selectedNames[e]}},this)}},mounted:function(){this.$input=this.$el.querySelector(".joms-js-input")},methods:{reset:function(){this.selectedIds=[],this.selectedNames=[]},add:function(){var t=JSON.parse(JSON.stringify(this.selectedIds));this.$emit("done",t),_.each(t,function(t){this.participants.push(t)},this),this.reset()},cancel:function(){this.reset(),this.$emit("hide")},search:function(t){var e=this.$store.getters["users/search"](t),i=this.filterSelected(e);this.queryResults=i},select:function(t){var e;-1===this.selectedIds.indexOf(t)&&(e=this.$store.getters["users/name"](t),this.selectedIds.push(t),this.selectedNames.push(e),this.queryResults=[],this.$input.value="",this.$input.focus())},removeSelected:function(t){var e=this.selectedIds.indexOf(+t);-1!==e&&(this.selectedIds.splice(e,1),this.selectedNames.splice(e,1),this.queryResults=this.filterSelected(this.queryResults))},filterSelected:function(t){var e=this.participants,i=this.selectedIds;return _.filter(t,function(t){var o=+t.id,s=!0;return o===n?s=!1:e.indexOf(o)>-1?s=!1:i.indexOf(o)>-1&&(s=!1),s})},onInputClick:function(t){this.$el.querySelector(".joms-js-input").focus()},onInputKeyup:_.throttle(function(t){this.shadowInput||(this.shadowInput=this.$el.querySelector(".joms-input--shadow")),this.shadowInput.innerHTML=t.target.value,this.inputWidth=this.shadowInput.clientWidth+20,this.search(t.target.value.trim())},50),onSelect:function(t){this.select(+t)}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(t,e,i){(function(i){"use strict";var n="undefined"!=typeof window?window.jQuery:void 0!==i?i.jQuery:null,o=("undefined"!=typeof window?window.joms:void 0!==i?i.joms:null).Vue,s=t("./chatbar-window-search"),a=t("./chatbar-window-input"),r=String(window.joms_my_id||""),c=(window.joms_plg_jomsocialchatbar||{}).templates||{};e.exports=o.component("chatbar-window",{template:c.chatbar_window,components:{ChatbarWindowSearch:s,ChatbarWindowInput:a},props:["chat"],data:function(){var t=JSON.parse(JSON.stringify(this.chat.users));return{setting:!1,adding:!1,loading:!1,myId:r,participants:t,scrollTop:0}},mounted:function(){this.loadOlderMessages()},updated:function(){this.$nextTick(function(){var t,e=this.$el.querySelector(".joms-js-scrollable"),i=this._scrollDirection;e&&(t="top"===i?0:e.scrollHeight,e.scrollTop=t),this._scrollDirection=null})},methods:{add:function(){this.setting=!1,this.adding=!0},leave:function(){this.setting=!1,confirm(Joomla.JText._("PLG_JOMSOCIALCHATBAR_ARE_YOU_SURE_TO_LEAVE_THIS_CONVERSATION"))&&this.$store.dispatch("chats/leave",this.chat.id)},toggle:function(){this.$store.dispatch("chats/toggle",this.chat.id)},close:function(){this.$store.dispatch("chats/close",this.chat.id)},loadOlderMessages:function(t){var e=this,i={id:this.chat.id};if(!this.loading)return this._scrollDirection=t||"bottom",this.loading=!0,jQuery.Deferred(function(t){e.$store.dispatch("chats/messages/fetch",i).then(function(){e.loading=!1,t.resolve()})})},handleScroll:function(t){var e,i=t.currentTarget,n=i.scrollTop,o=t.deltaY;0===n&&o<0?(this.loadOlderMessages("top"),t.preventDefault(),t.stopPropagation()):(e=i.scrollHeight-i.clientHeight,Math.abs(n-e)<=1&&o>0&&(t.preventDefault(),t.stopPropagation()))},replaceLink:function(t){return t.replace(/((http|https):\/\/.*?[^\s]+)/g,'<a target="_blank" style="text-decoration:underline" href="$1">$1</a>')},replaceNewline:function(t){return t.replace(/\\n/g,"<br />").replace(/\r?\n/g,"<br />")},getName:function(t){return this.$store.getters["users/name"](t)},replaceEmoticon:function(t){return _.each({happy2:/(:happy:|:\)\))/g,smiley2:/(:smile:|:\)|:-\))/g,tongue2:/(:tongue:|:p|:P)/g,wink2:/(:wink:|;\))/g,cool2:/(:cool:|B\))/g,angry2:/(:angry:|>:\(|&gt;:\()/g,sad2:/(:sad:|:\()/g,evil2:/(:evil:|>:D|&gt;:D)/g,grin2:/(:grin:|:D)/g,shocked2:/(:shocked:|:o|:O)/g,confused2:/(:confused:|:\?)/g,neutral2:/(:neutral:|:\|)/g,heart:/(:love:|<3|&lt;3)/g},function(e,i){var n='<i class="joms-status-emoticon joms-icon-'+i+'"></i>';t=t.replace(e,n)}),t},photoZoom:function(t){joms.api.photoZoom(t)},addUsers:function(t){var e;this.adding=!1,t&&t.length&&(e={id:this.chat.id,users:t},this.$store.dispatch("chats/addUsers",e))},submit:function(t){this._scrollDirection="bottom",this.$store.dispatch("chats/messages/submit",{id:this.chat.id,data:t})},mute:function(t){var e=t?"chats/mute":"chats/unmute";this.$store.dispatch(e,{id:this.chat.id})},showTooltip:function(t){var e=this,i=n(t.currentTarget);this.timerTooltip=setTimeout(function(){var t=i.data("tooltip"),o=i.offset();e.$tooltip||(e.$tooltip=n('<div class="joms-tooltip joms-js-chat-tooltip" />').appendTo(document.body)),e.$tooltip.html(t).css(o).show(),e.$tooltip.css({left:o.left-e.$tooltip.outerWidth()-10,top:o.top+i.outerHeight()/2,transform:"translateY(-50%)"})},800)},hideTooltip:function(t){clearTimeout(this.timerTooltip),this.$tooltip&&this.$tooltip.hide()}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./chatbar-window-input":3,"./chatbar-window-search":4}],6:[function(t,e,i){(function(i){"use strict";var n=("undefined"!=typeof window?window.joms:void 0!==i?i.joms:null).Vue,o=t("./chatbar-sidebar"),s=t("./chatbar-window"),a=window.joms_plg_jomsocialchatbar||{},r=a.configs||{},c=a.templates||{};e.exports=n.component("chatbar",{template:c.chatbar,components:{ChatbarSidebar:o,ChatbarWindow:s},data:function(){var t={position:"right"};return r.chat_bar_position&&(t.position=r.chat_bar_position),t},computed:{openedChats:function(){var t,e=this.$store,i=e.state.chats.info,o=e.getters["chats/messages/groupedMessages"];return t=_.filter(i,function(t){return t.open}),_.each(t,function(t){n.set(t,"messages",o(t.id))}),t}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./chatbar-sidebar":2,"./chatbar-window":5}]},{},[1]);